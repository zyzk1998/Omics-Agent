# GIBH-AGENT é‡æ„æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®ç°çŠ¶åˆ†æ

### å½“å‰æ¶æ„
- **å•ä½“æ™ºèƒ½ä½“**ï¼š`BioBlendAgent` å¤„ç†æ‰€æœ‰é€»è¾‘
- **ç¡¬ç¼–ç  LLM**ï¼šç›´æ¥ä½¿ç”¨ LangChainï¼Œé…ç½®å†™æ­»åœ¨ä»£ç ä¸­
- **ç¡¬ç¼–ç æç¤ºè¯**ï¼šæç¤ºè¯ç›´æ¥å†™åœ¨ä»£ç é‡Œ
- **å•ä¸€æ¨¡æ€**ï¼šåªæ”¯æŒå•ç»†èƒè½¬å½•ç»„ï¼ˆscRNA-seqï¼‰
- **åŒæ­¥å¤„ç†**ï¼šå¤§æ•°æ®æ–‡ä»¶éœ€è¦å…¨éƒ¨åŠ è½½åˆ°å†…å­˜

### æ ¸å¿ƒé—®é¢˜
1. âŒ æ— æ³•å¤„ç† TB çº§ FASTQ æ–‡ä»¶ï¼ˆå†…å­˜é™åˆ¶ï¼‰
2. âŒ åªæ”¯æŒä¸€ç§ç»„å­¦æ¨¡æ€
3. âŒ LLM é…ç½®ä¸çµæ´»ï¼ˆæ— æ³•åˆ‡æ¢æœ¬åœ°/äº‘ç«¯ï¼‰
4. âŒ æç¤ºè¯ç®¡ç†æ··ä¹±
5. âŒ ç¼ºä¹æ¨¡å—åŒ–ï¼Œéš¾ä»¥æ‰©å±•

## ğŸ¯ é‡æ„ç›®æ ‡

### 1. æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆThe "Brain"ï¼‰

#### 1.1 ç»Ÿä¸€ LLM å®¢æˆ·ç«¯
- **ç›®æ ‡**ï¼šæ”¯æŒæœ¬åœ°ï¼ˆvLLM/Ollamaï¼‰å’Œäº‘ç«¯ï¼ˆDeepSeek-V3/SiliconFlowï¼‰æ— ç¼åˆ‡æ¢
- **å®ç°**ï¼š`core/llm_client.py`
  - ä½¿ç”¨ OpenAI SDK æ ‡å‡†æ¥å£
  - é€šè¿‡ `base_url` å’Œ `api_key` é…ç½®åˆ‡æ¢
  - æ”¯æŒæµå¼å’Œéæµå¼è°ƒç”¨

#### 1.2 æç¤ºç®¡ç†å™¨
- **ç›®æ ‡**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰æç¤ºè¯æ¨¡æ¿
- **å®ç°**ï¼š`core/prompt_manager.py`
  - ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“
  - æ”¯æŒåŠ¨æ€æ³¨å…¥ä¸Šä¸‹æ–‡ï¼ˆæ–‡ä»¶è·¯å¾„ã€ç”¨æˆ·æ„å›¾ç­‰ï¼‰
  - ä¸“å®¶è§’è‰²ï¼ˆExpert Personasï¼‰æ¨¡æ¿åŒ–

### 2. åˆ†å±‚æ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆManager-Specialistï¼‰

#### 2.1 è·¯ç”±æ™ºèƒ½ä½“ï¼ˆRouter Agentï¼‰
- **èŒè´£**ï¼šåˆ†æç”¨æˆ·è‡ªç„¶è¯­è¨€ï¼Œè¯†åˆ«æ„å›¾å’Œç»„å­¦ç±»å‹
- **è¾“å‡º**ï¼šè·¯ç”±åˆ°å¯¹åº”çš„é¢†åŸŸæ™ºèƒ½ä½“
- **å®ç°**ï¼š`agents/router_agent.py`

#### 2.2 7ä¸ªé¢†åŸŸæ™ºèƒ½ä½“ï¼ˆDomain Agentsï¼‰
1. **Transcriptomics Agent** (`rna_agent.py`)
   - å•ç»†èƒè½¬å½•ç»„ï¼ˆscRNA-seqï¼‰
   - Bulk RNA-seq
   - å·¥å…·ï¼šCell Ranger, Scanpy, Seurat

2. **Genomics Agent** (`dna_agent.py`)
   - WGS, WES
   - å·¥å…·ï¼šGATK, BWA, Samtools

3. **Epigenomics Agent** (`epigenomics_agent.py`)
   - ChIP-seq, ATAC-seq
   - å·¥å…·ï¼šMACS2, HOMER

4. **Metabolomics Agent** (`metabolomics_agent.py`)
   - LC-MS, GC-MS
   - å·¥å…·ï¼šXCMS, MetaboAnalyst

5. **Proteomics Agent** (`proteomics_agent.py`)
   - Mass Spectrometry
   - å·¥å…·ï¼šMaxQuant, Proteome Discoverer

6. **Spatial Omics Agent** (`spatial_agent.py`)
   - Spatial Transcriptomics
   - å·¥å…·ï¼šSpatial Transcriptomics, Visium

7. **Imaging Agent** (`imaging_agent.py`)
   - åŒ»å­¦å½±åƒåˆ†æ
   - å·¥å…·ï¼šImageJ, CellProfiler

#### 2.3 é›†æˆæ™ºèƒ½ä½“ï¼ˆIntegration Agentï¼‰
- **èŒè´£**ï¼šå¤„ç†å¤šç»„å­¦æ•°æ®æ•´åˆ
- **å®ç°**ï¼š`agents/integration_agent.py`ï¼ˆæœªæ¥æ‰©å±•ï¼‰

### 3. å¼‚æ­¥ä»»åŠ¡åˆ†å‘å™¨ï¼ˆThe "Hands"ï¼‰

#### 3.1 é—®é¢˜
- TB çº§ FASTQ æ–‡ä»¶æ— æ³•åŠ è½½åˆ°å†…å­˜
- éœ€è¦ HPC/æœåŠ¡å™¨é›†ç¾¤å¤„ç†

#### 3.2 è§£å†³æ–¹æ¡ˆ
- **æ§åˆ¶å¹³é¢**ï¼šæ™ºèƒ½ä½“åªå¤„ç†æ–‡ä»¶è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰
- **æ•°æ®å¹³é¢**ï¼šTaskDispatcher æäº¤è„šæœ¬åˆ° HPC
- **å®ç°**ï¼š`core/dispatcher.py`
  - ç”Ÿæˆ Shell/Slurm è„šæœ¬
  - é€šè¿‡ `subprocess` æˆ– `paramiko` æäº¤
  - ç›‘æ§ä»»åŠ¡çŠ¶æ€

## ğŸ“ æ–°ç›®å½•ç»“æ„

```
gibh_agent/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.yaml          # ç»Ÿä¸€é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ prompts/               # æç¤ºè¯æ¨¡æ¿ç›®å½•
â”‚       â”œâ”€â”€ router.yaml
â”‚       â”œâ”€â”€ rna_expert.yaml
â”‚       â””â”€â”€ ...
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ llm_client.py          # ç»Ÿä¸€ LLM å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ prompt_manager.py       # æç¤ºç®¡ç†å™¨
â”‚   â””â”€â”€ dispatcher.py           # ä»»åŠ¡åˆ†å‘å™¨
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_agent.py           # åŸºç¡€æ™ºèƒ½ä½“ç±»
â”‚   â”œâ”€â”€ router_agent.py         # è·¯ç”±æ™ºèƒ½ä½“
â”‚   â””â”€â”€ specialists/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ rna_agent.py        # è½¬å½•ç»„æ™ºèƒ½ä½“
â”‚       â”œâ”€â”€ dna_agent.py        # åŸºå› ç»„æ™ºèƒ½ä½“
â”‚       â”œâ”€â”€ epigenomics_agent.py
â”‚       â”œâ”€â”€ metabolomics_agent.py
â”‚       â”œâ”€â”€ proteomics_agent.py
â”‚       â”œâ”€â”€ spatial_agent.py
â”‚       â””â”€â”€ imaging_agent.py
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cellranger_tool.py      # Cell Ranger è„šæœ¬ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ scanpy_tool.py          # Scanpy åˆ†æå·¥å…·
â”‚   â””â”€â”€ gatk_tool.py            # GATK å·¥å…·ï¼ˆç¤ºä¾‹ï¼‰
â””â”€â”€ main.py                     # å…¥å£æ–‡ä»¶
```

## ğŸš€ å®æ–½è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆWeek 1-2ï¼‰
- [x] åˆ›å»ºç›®å½•ç»“æ„
- [ ] å®ç° `LLMClient`ï¼ˆæ”¯æŒæœ¬åœ°/äº‘ç«¯åˆ‡æ¢ï¼‰
- [ ] å®ç° `PromptManager`ï¼ˆJinja2 æ¨¡æ¿ï¼‰
- [ ] åˆ›å»ºé…ç½®æ–‡ä»¶ `settings.yaml`

### Phase 2: åŸºç¡€æ™ºèƒ½ä½“æ¡†æ¶ï¼ˆWeek 3-4ï¼‰
- [ ] å®ç° `BaseAgent` æŠ½è±¡ç±»
- [ ] å®ç° `RouterAgent`ï¼ˆæ„å›¾è¯†åˆ«ï¼‰
- [ ] é‡æ„ç°æœ‰ `BioBlendAgent` â†’ `RNAAgent`

### Phase 3: ä»»åŠ¡åˆ†å‘å™¨ï¼ˆWeek 5-6ï¼‰
- [ ] å®ç° `TaskDispatcher`
- [ ] å®ç° `CellRangerTool`ï¼ˆç”Ÿæˆè„šæœ¬ï¼‰
- [ ] é›†æˆ Slurm/Bash æäº¤

### Phase 4: æ‰©å±•é¢†åŸŸæ™ºèƒ½ä½“ï¼ˆWeek 7-8ï¼‰
- [ ] å®ç°å…¶ä»–6ä¸ªé¢†åŸŸæ™ºèƒ½ä½“çš„å ä½ç¬¦
- [ ] é€æ­¥å®Œå–„å„æ™ºèƒ½ä½“çš„å·¥å…·é›†æˆ

## ğŸ”§ æŠ€æœ¯é€‰å‹

- **LLM SDK**: OpenAI SDKï¼ˆæ ‡å‡†æ¥å£ï¼‰
- **æ¨¡æ¿å¼•æ“**: Jinja2
- **ä»»åŠ¡è°ƒåº¦**: Celeryï¼ˆä¿ç•™ï¼‰+ TaskDispatcherï¼ˆæ–°å¢ï¼‰
- **HPC æäº¤**: `subprocess`ï¼ˆæœ¬åœ°ï¼‰+ `paramiko`ï¼ˆè¿œç¨‹ï¼‰
- **é…ç½®ç®¡ç†**: YAML + Pydantic Settings

## ğŸ“ å…³é”®è®¾è®¡åŸåˆ™

1. **æ§åˆ¶å¹³é¢ vs æ•°æ®å¹³é¢åˆ†ç¦»**
   - æ™ºèƒ½ä½“åªå¤„ç†å…ƒæ•°æ®å’Œæ–‡ä»¶è·¯å¾„
   - å¤§æ•°æ®å¤„ç†åœ¨ HPC é›†ç¾¤å®Œæˆ

2. **ç»Ÿä¸€æ¥å£**
   - æ‰€æœ‰æ™ºèƒ½ä½“ç»§æ‰¿ `BaseAgent`
   - ç»Ÿä¸€çš„ LLM è°ƒç”¨æ¥å£
   - ç»Ÿä¸€çš„å·¥å…·è°ƒç”¨æ¥å£

3. **å¯æ‰©å±•æ€§**
   - æ–°å¢ç»„å­¦æ¨¡æ€åªéœ€æ·»åŠ æ–°çš„ Specialist Agent
   - æ–°å¢å·¥å…·åªéœ€å®ç°å¯¹åº”çš„ Tool ç±»

4. **å‘åå…¼å®¹**
   - ä¿ç•™ç°æœ‰ API æ¥å£
   - é€æ­¥è¿ç§»ï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½

