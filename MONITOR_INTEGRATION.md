# 监控脚本整合说明

## 📋 整合概述

已将项目内所有关于 Docker、服务、日志监控等的 `.sh` 文件整合到 `monitor.sh` 中，提供统一的可视化监控运维界面。

## 🔄 已整合的脚本

| 原脚本文件 | 功能 | 在新脚本中的位置 |
|-----------|------|----------------|
| `docker-start.sh` | Docker 服务启动 | 菜单项 2（启动服务） |
| `docker-rebuild.sh` | Docker 镜像重建 | 菜单项 5（重新构建镜像） |
| `fix-502.sh` | 502 错误自动修复 | 菜单项 16（自动修复 502 错误） |
| `diagnose-502.sh` | 502 错误诊断 | 菜单项 15（诊断 502 错误） |
| `check-api-status.sh` | API 状态检查 | 菜单项 6（服务健康检查） |
| `quick-check.sh` | 快速检查 | 菜单项 1（查看服务状态）+ 菜单项 6（健康检查） |
| `run_server.sh` | 启动测试服务器 | 保留原文件（直接运行场景） |

## ✨ 新增功能

1. **可视化输出**：使用颜色和图标美化输出，提升可读性
2. **综合监控面板**：实时刷新显示服务状态、健康度、数据统计、错误日志
3. **数据监控**：统计上传文件、结果文件、磁盘使用情况
4. **LLM JSON 解读**：自动调用 DeepSeek API 解读 JSON 结构化数据
5. **交互式菜单**：统一的菜单界面，方便操作
6. **错误日志分析**：自动筛选和显示错误日志
7. **本地日志文件查看**：查看项目中的日志文件

## 🚀 使用方式

### 基本使用

```bash
# 运行监控脚本
./monitor.sh
```

### 功能模块

#### 1. Docker 服务管理（菜单项 1-5）
- 查看、启动、停止、重启、重建 Docker 服务

#### 2. 健康检查（菜单项 6）
- 检查容器状态、API 响应、端口监听、进程状态

#### 3. 日志监控（菜单项 7-12）
- 实时日志、最近日志、所有服务日志、错误日志、本地日志文件

#### 4. 数据监控（菜单项 13-14）
- 数据状态统计、数据清理

#### 5. 错误诊断（菜单项 15-16）
- 诊断和修复 502 错误

#### 6. 智能分析（菜单项 17）
- LLM 解读 JSON 数据

#### 7. 综合监控（菜单项 18）
- 实时监控面板（每 5 秒刷新）

## 📝 迁移建议

### 保留原脚本
原脚本文件可以保留作为备份，但建议使用新的 `monitor.sh` 进行日常运维。

### 更新文档
如果文档中引用了原脚本，建议更新为使用 `monitor.sh` 的对应菜单项。

### 自动化脚本
如果使用了原脚本的自动化场景，可以：
1. 直接调用 `monitor.sh` 中的函数（如果脚本被 source）
2. 或使用对应的菜单项编号

## 🔧 高级用法

### 直接调用函数

```bash
# Source 脚本后直接调用函数
source monitor.sh

# 调用特定功能
docker_status
health_check
logs_recent "api-server" 50
data_status
```

### 非交互式使用

```bash
# 使用 expect 或类似工具实现非交互式操作
# 或直接修改脚本添加命令行参数支持（未来可扩展）
```

## 📊 功能对比

| 功能 | 原脚本 | monitor.sh | 改进 |
|------|--------|------------|------|
| Docker 管理 | 分散在多个脚本 | 统一菜单 | ✅ 集中管理 |
| 日志查看 | 需要手动执行命令 | 交互式选择 | ✅ 更便捷 |
| 错误诊断 | 需要运行多个脚本 | 一键诊断 | ✅ 自动化 |
| 数据监控 | 无 | 新增 | ✅ 新功能 |
| LLM 解读 | 无 | 新增 | ✅ 新功能 |
| 可视化 | 无 | 彩色输出 | ✅ 更直观 |
| 实时监控 | 无 | 监控面板 | ✅ 新功能 |

## 🎯 最佳实践

1. **日常监控**：使用菜单项 18（实时监控面板）
2. **问题排查**：使用菜单项 15（诊断 502 错误）和 11（错误日志分析）
3. **数据管理**：使用菜单项 13（数据状态）和 14（数据清理）
4. **服务管理**：使用菜单项 1-5 进行 Docker 服务操作
5. **日志查看**：使用菜单项 7-12 查看各种日志

## 📞 支持

如有问题或建议，请查看 `MONITOR_USAGE.md` 获取详细使用说明。

