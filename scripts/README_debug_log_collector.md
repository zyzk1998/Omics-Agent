# ä¸“ä¸šè°ƒè¯•æ—¥å¿—æ”¶é›†å™¨ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`debug_log_collector.py` æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è°ƒè¯•å·¥å…·ï¼Œç”¨äºæ”¶é›†ä»£è°¢ç»„åˆ†æå…¨æµç¨‹ä¸­çš„å…³é”®æ—¥å¿—ï¼Œå¸®åŠ©è¯Šæ–­é—®é¢˜ã€‚

## åŠŸèƒ½

è„šæœ¬ä¼šæ•è·ä»¥ä¸‹ä¸‰ä¸ªå…³é”®è¿‡ç¨‹çš„è¯¦ç»†æ—¥å¿—ï¼š

1. **è§„åˆ’é˜¶æ®µçš„LLMæ•°æ®è¯Šæ–­è¿‡ç¨‹** (`01_diagnosis_planning_*.log`)
   - æ–‡ä»¶æ£€æŸ¥è¿‡ç¨‹
   - æ–‡ä»¶å…ƒæ•°æ®æå–
   - LLMæ•°æ®è¯Šæ–­è°ƒç”¨
   - LLMè¯·æ±‚å‚æ•°å’Œå“åº”

2. **ä»£è°¢ç»„åˆ†æå·¥å…·æ‰§è¡Œè¿‡ç¨‹** (`02_tool_execution_*.log`)
   - å·¥ä½œæµé…ç½®
   - æ¯ä¸ªå·¥å…·çš„å‚æ•°
   - å·¥å…·æ‰§è¡Œç»“æœ
   - é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

3. **LLMç”Ÿæˆåˆ†ææŠ¥å‘Šè¿‡ç¨‹** (`03_llm_report_generation_*.log`)
   - æ­¥éª¤ç»“æœæå–
   - LLMè°ƒç”¨å‚æ•°
   - LLMå“åº”è§£æ
   - æŠ¥å‘Šç”Ÿæˆè¿‡ç¨‹
   - é”™è¯¯å †æ ˆï¼ˆå¦‚æœæœ‰ï¼‰

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```bash
cd /home/ubuntu/GIBH-AGENT-V2
python3 scripts/debug_log_collector.py
```

### å‰ç½®æ¡ä»¶

1. **æµ‹è¯•æ•°æ®æ–‡ä»¶**: ç¡®ä¿ `test_data/` ç›®å½•ä¸­æœ‰CSVæ ¼å¼çš„ä»£è°¢ç»„æ•°æ®æ–‡ä»¶
   ```bash
   # å¦‚æœæ²¡æœ‰æµ‹è¯•æ–‡ä»¶ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶
   ```

2. **ç¯å¢ƒå˜é‡**: ç¡®ä¿ `.env` æ–‡ä»¶ä¸­é…ç½®äº†LLMæœåŠ¡åœ°å€
   ```bash
   LLM_BASE_URL=http://localhost:8000/v1
   LLM_API_KEY=sk-test
   ```

### è¾“å‡ºä½ç½®

æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ `debug_logs/` ç›®å½•ä¸‹ï¼š

```
debug_logs/
â”œâ”€â”€ 01_diagnosis_planning_20260127_111603.log    # è¯Šæ–­æ—¥å¿—
â”œâ”€â”€ 02_tool_execution_20260127_111603.log        # æ‰§è¡Œæ—¥å¿—
â””â”€â”€ 03_llm_report_generation_20260127_111603.log # æŠ¥å‘Šç”Ÿæˆæ—¥å¿—
```

## æ—¥å¿—æ ¼å¼

æ¯ä¸ªæ—¥å¿—æ–‡ä»¶åŒ…å«ï¼š

- **æ—¶é—´æˆ³**: ç²¾ç¡®åˆ°å¾®ç§’
- **æ—¥å¿—çº§åˆ«**: DEBUG, INFO, WARNING, ERROR
- **æ¨¡å—åç§°**: å®Œæ•´çš„Pythonæ¨¡å—è·¯å¾„
- **å‡½æ•°åå’Œè¡Œå·**: ä¾¿äºå®šä½ä»£ç 
- **è¯¦ç»†æ¶ˆæ¯**: åŒ…å«å‚æ•°ã€è¿”å›å€¼ã€é”™è¯¯å †æ ˆç­‰

### ç¤ºä¾‹æ—¥å¿—æ¡ç›®

```
2026-01-27 11:16:04.123456 | INFO     | gibh_agent.core.executor | execute_workflow:923 | ğŸš€ å¼€å§‹æ‰§è¡Œå·¥ä½œæµ: ä»£è°¢ç»„å­¦åˆ†ææµ‹è¯•
```

## æ—¥å¿—å†…å®¹è¯´æ˜

### 1. è¯Šæ–­æ—¥å¿— (`01_diagnosis_planning_*.log`)

åŒ…å«ï¼š
- æ–‡ä»¶æ£€æŸ¥çš„å®Œæ•´å…ƒæ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
- LLMè¯Šæ–­è°ƒç”¨çš„ç³»ç»Ÿæç¤ºå’Œç”¨æˆ·æç¤º
- LLMå“åº”çš„å®Œæ•´å†…å®¹
- è¯Šæ–­æŠ¥å‘Šçš„ç”Ÿæˆè¿‡ç¨‹

**å…³é”®ä¿¡æ¯**:
- æ–‡ä»¶è·¯å¾„ã€å¤§å°ã€ç±»å‹
- æ•°æ®ç»´åº¦ï¼ˆè¡Œæ•°ã€åˆ—æ•°ï¼‰
- ç¼ºå¤±ç‡ç»Ÿè®¡
- åˆ—ååˆ—è¡¨
- LLMè¯Šæ–­æŠ¥å‘Šå†…å®¹

### 2. æ‰§è¡Œæ—¥å¿— (`02_tool_execution_*.log`)

åŒ…å«ï¼š
- å·¥ä½œæµé…ç½®ï¼ˆJSONæ ¼å¼ï¼‰
- æ¯ä¸ªæ­¥éª¤çš„IDã€åç§°ã€å·¥å…·ID
- å·¥å…·è°ƒç”¨çš„å‚æ•°ï¼ˆåŒ…æ‹¬è‡ªåŠ¨æ³¨å…¥çš„å‚æ•°ï¼‰
- å·¥å…·æ‰§è¡Œç»“æœ
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

**å…³é”®ä¿¡æ¯**:
- å·¥å…·æ³¨å†Œè¡¨æŸ¥æ‰¾è¿‡ç¨‹
- å‚æ•°è§£æå’ŒéªŒè¯
- æ–‡ä»¶è·¯å¾„è§£æ
- æ­¥éª¤æ‰§è¡ŒçŠ¶æ€
- è¾“å‡ºæ–‡ä»¶è·¯å¾„

### 3. æŠ¥å‘Šç”Ÿæˆæ—¥å¿— (`03_llm_report_generation_*.log`)

åŒ…å«ï¼š
- æ­¥éª¤ç»“æœçš„æå–è¿‡ç¨‹
- å…³é”®æŒ‡æ ‡çš„æå–ï¼ˆPCAã€å·®å¼‚åˆ†æã€VIPç­‰ï¼‰
- LLMè°ƒç”¨çš„å®Œæ•´å‚æ•°
- LLMå“åº”çš„è§£æè¿‡ç¨‹
- æŠ¥å‘Šç”Ÿæˆçš„æœ€ç»ˆç»“æœ
- é”™è¯¯å †æ ˆï¼ˆå¦‚æœæœ‰ï¼‰

**å…³é”®ä¿¡æ¯**:
- æˆåŠŸ/å¤±è´¥çš„æ­¥éª¤ç»Ÿè®¡
- æå–çš„å…³é”®æŒ‡æ ‡ï¼ˆJSONæ ¼å¼ï¼‰
- LLMè¯·æ±‚æ¶ˆæ¯ï¼ˆsystem + user promptsï¼‰
- LLMå“åº”å†…å®¹
- æŠ¥å‘Šç”Ÿæˆçš„Markdownå†…å®¹

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: LLMè¿æ¥å¤±è´¥

å¦‚æœçœ‹åˆ° `Connection error`ï¼Œæ£€æŸ¥ï¼š
1. LLMæœåŠ¡æ˜¯å¦è¿è¡Œ
2. `.env` æ–‡ä»¶ä¸­çš„ `LLM_BASE_URL` æ˜¯å¦æ­£ç¡®
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

**æ³¨æ„**: å³ä½¿LLMè¿æ¥å¤±è´¥ï¼Œè„šæœ¬ä»ä¼šè®°å½•æ‰€æœ‰å…¶ä»–è¿‡ç¨‹çš„æ—¥å¿—ã€‚

### é—®é¢˜2: å·¥å…·æœªæ‰¾åˆ°

å¦‚æœçœ‹åˆ° `å·¥å…· 'xxx' æœªåœ¨æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°`ï¼Œæ£€æŸ¥ï¼š
1. å·¥å…·æ˜¯å¦æ­£ç¡®æ³¨å†Œ
2. å·¥å…·IDæ˜¯å¦åŒ¹é…
3. å·¥å…·æ¨¡å—æ˜¯å¦æ­£ç¡®å¯¼å…¥

### é—®é¢˜3: æ–‡ä»¶æœªæ‰¾åˆ°

å¦‚æœçœ‹åˆ° `æœªæ‰¾åˆ°æµ‹è¯•æ–‡ä»¶`ï¼Œç¡®ä¿ï¼š
1. `test_data/` ç›®å½•å­˜åœ¨
2. ç›®å½•ä¸­æœ‰CSVæ–‡ä»¶
3. æ–‡ä»¶è·¯å¾„æ­£ç¡®

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«

ä¿®æ”¹è„šæœ¬ä¸­çš„æ—¥å¿—çº§åˆ«è®¾ç½®ï¼š

```python
# åœ¨ LogCollector.setup() ä¸­
self.root_logger.setLevel(logging.DEBUG)  # æ”¹ä¸º INFO æˆ– WARNING
```

### æ·»åŠ æ›´å¤šæ¨¡å—è¿‡æ»¤å™¨

åœ¨ `main()` å‡½æ•°ä¸­æ·»åŠ ï¼š

```python
log_collector.add_module_filter([
    "your.module.name"
], "category")
```

### åªæ”¶é›†ç‰¹å®šé˜¶æ®µçš„æ—¥å¿—

æ³¨é‡Šæ‰ä¸éœ€è¦çš„é˜¶æ®µï¼š

```python
# åªæ”¶é›†è¯Šæ–­æ—¥å¿—
# await test_metabolomics_workflow(log_collector)  # æ³¨é‡Šæ‰æ•´ä¸ªæµ‹è¯•
# æˆ–è€…åªè¿è¡Œç‰¹å®šé˜¶æ®µ
```

## æœ€ä½³å®è·µ

1. **è¿è¡Œå‰æ£€æŸ¥**: ç¡®ä¿æµ‹è¯•æ•°æ®æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
2. **æŸ¥çœ‹æ—¥å¿—**: æŒ‰æ—¶é—´é¡ºåºæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œäº†è§£å®Œæ•´æµç¨‹
3. **å¯¹æ¯”åˆ†æ**: å¯¹æ¯”æˆåŠŸå’Œå¤±è´¥çš„æ—¥å¿—ï¼Œæ‰¾å‡ºå·®å¼‚
4. **é”™è¯¯å®šä½**: ä½¿ç”¨æ—¥å¿—ä¸­çš„å‡½æ•°åå’Œè¡Œå·å¿«é€Ÿå®šä½é—®é¢˜ä»£ç 

## æ³¨æ„äº‹é¡¹

- æ—¥å¿—æ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼ˆç‰¹åˆ«æ˜¯åŒ…å«å®Œæ•´æ•°æ®æ—¶ï¼‰ï¼Œæ³¨æ„ç£ç›˜ç©ºé—´
- æ—¥å¿—æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚APIå¯†é’¥ï¼‰ï¼Œä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- å»ºè®®å®šæœŸæ¸…ç†æ—§çš„æ—¥å¿—æ–‡ä»¶

## ç¤ºä¾‹è¾“å‡º

è¿è¡Œè„šæœ¬åï¼Œä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
================================================================================
ğŸ” è®¾ç½®ä¸“ä¸šè°ƒè¯•æ—¥å¿—æ”¶é›†å™¨
================================================================================
âœ… å·²åˆ›å»ºæ—¥å¿—å¤„ç†å™¨: diagnosis -> 01_diagnosis_planning_20260127_111603.log
âœ… å·²åˆ›å»ºæ—¥å¿—å¤„ç†å™¨: execution -> 02_tool_execution_20260127_111603.log
âœ… å·²åˆ›å»ºæ—¥å¿—å¤„ç†å™¨: report -> 03_llm_report_generation_20260127_111603.log

ğŸ“ æ—¥å¿—æ–‡ä»¶å°†ä¿å­˜åˆ°: /home/ubuntu/GIBH-AGENT-V2/debug_logs
================================================================================

ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®:
   diagnosis   : .../01_diagnosis_planning_20260127_111603.log (49,686 bytes)
   execution   : .../02_tool_execution_20260127_111603.log (7,499 bytes)
   report      : .../03_llm_report_generation_20260127_111603.log (18,669 bytes)
```

## è”ç³»å’Œæ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
