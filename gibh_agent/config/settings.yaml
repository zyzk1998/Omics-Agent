# GIBH-AGENT 配置文件
# 支持本地和云端 LLM 切换

# LLM 配置
llm:
  # 默认使用的 LLM 类型: "local" 或 "cloud"
  # 已改为使用硅基流动 deepseek API
  default: "cloud"
  
  # 注意：使用云端模型需要设置环境变量 SILICONFLOW_API_KEY
  
  # 本地模型配置（vLLM/Ollama）
  local:
    logic:
      base_url: "${VLLM_LOGIC_URL:http://localhost:8001/v1}"
      api_key: "EMPTY"
      model: "${LLM_LOGIC_MODEL:qwen3-coder-awq}"
      temperature: 0.1
      max_tokens: 2048
    
    vision:
      base_url: "${VLLM_VL_URL:http://localhost:8000/v1}"
      api_key: "EMPTY"
      model: "${LLM_VL_MODEL:qwen3-vl}"
      temperature: 0.3
      max_tokens: 2048
  
  # 云端模型配置
  cloud:
    # 硅基流动 deepseek API（默认使用）
    # 注意：模型名称格式为 "deepseek-ai/DeepSeek-R1" 或其他支持的模型
    # 可通过环境变量 SILICONFLOW_MODEL 自定义模型名称
    # 常见模型名称：
    #   - deepseek-ai/DeepSeek-R1（推荐，支持思考过程流式输出）
    #   - Pro/deepseek-ai/DeepSeek-V3.2
    #   - deepseek-ai/DeepSeek-V2.5
    #   - deepseek-ai/DeepSeek-V3
    #   - deepseek-ai/deepseek-chat
    siliconflow:
      base_url: "https://api.siliconflow.cn/v1"
      api_key: "${SILICONFLOW_API_KEY:}"
      model: "${SILICONFLOW_MODEL:deepseek-ai/DeepSeek-R1}"
      temperature: 0.1
      max_tokens: 4096
    
    # DeepSeek 官方 API（备用）
    #deepseek:
      #base_url: "https://api.deepseek.com/v1"
      #api_key: "${DEEPSEEK_API_KEY:}"
      #model: "deepseek-chat"
      #temperature: 0.7
      #max_tokens: 4096

# 数据路径配置
paths:
  upload_dir: "${UPLOAD_DIR:/app/uploads}"
  results_dir: "${RESULTS_DIR:/app/results}"
  hpc_work_dir: "${HPC_WORK_DIR:/scratch/gibh}"

# 文件签名配置（BLAKE3 + Ed25519，异步侧车 .sig）
# 占位：实际密钥从环境变量读取，不在此文件写明文。
# 生成密钥: python scripts/generate_keys.py → 将输出填入 .env
# 依赖: pip install blake3 pynacl
signing:
  private_key_env: "FILE_SIGNING_PRIVATE_KEY"   # Base64 编码的 Ed25519 私钥（32 字节）
  public_key_env: "FILE_SIGNING_PUBLIC_KEY"     # Base64 编码的 Ed25519 公钥（32 字节）

# HPC/任务分发配置
dispatcher:
  # 任务提交方式: "local", "slurm", "ssh"
  type: "local"
  
  # Slurm 配置
  slurm:
    partition: "compute"
    account: "${SLURM_ACCOUNT:}"
    time_limit: "24:00:00"
    memory: "32G"
    cpus: 8
  
  # SSH 远程提交配置
  ssh:
    host: "${SSH_HOST:}"
    username: "${SSH_USER:}"
    key_path: "${SSH_KEY_PATH:~/.ssh/id_rsa}"
    work_dir: "/scratch/gibh"

# Redis 配置（Celery）
redis:
  url: "${REDIS_URL:redis://localhost:6379/0}"

# 工具配置
tools:
  cellranger:
    path: "${CELLRANGER_PATH:/home/ubuntu/cellranger-10.0.0}"  # Cell Ranger 安装路径
    reference: "${CELLRANGER_REF:/home/ubuntu/GIBH-AGENT-V2/test_data/refdata-gex-GRCh38-2024-A}"  # 参考基因组路径
    localcores: 8  # CPU 核心数
    localmem: 32   # 内存（GB）
    create_bam: false  # 是否创建 BAM 文件（Cell Ranger 10.0.0+ 必需参数）
  test_data_dir: "${TEST_DATA_DIR:test_data}"  # 测试数据目录
  
  scanpy:
    python_path: "${PYTHON_PATH:/usr/bin/python3}"
  
  metabolomics:
    output_dir: "${METABOLOMICS_OUTPUT_DIR:results/metabolomics}"  # 代谢组学分析输出目录
  
  gatk:
    path: "${GATK_PATH:/opt/gatk}"
    reference: "${GATK_REF:/data/hg38.fa}"

# 日志配置
logging:
  level: "INFO"
  file: "${LOG_FILE:/var/log/gibh-agent.log}"

