# æ™ºèƒ½ä½“ç³»ç»Ÿæ•´ä½“åŒæ­¥æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ¦‚è¿°

æœ¬æ¬¡æ£€æŸ¥ç¡®ä¿å‰ç«¯é¡µé¢èƒ½æ­£ç¡®æµ‹è¯•æœ€æ–°ä¿®æ”¹çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
1. FileInspector å¤šæ¨¡æ€æ£€æŸ¥å™¨
2. å‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆdata_rangeã€missing_rateï¼‰
3. å‚æ•°æ¨èå’Œè‡ªåŠ¨å¡«å……
4. å‰åç«¯æ•°æ®æ ¼å¼ä¸€è‡´æ€§

---

## âœ… æ£€æŸ¥ç»“æœ

### 1. åç«¯æ•°æ®æµ âœ…

#### 1.1 FileInspector æ ¸å¿ƒå‡çº§
- **ä½ç½®**: `gibh_agent/core/file_inspector.py`
- **åŠŸèƒ½**:
  - âœ… å¤šæ¨¡æ€åˆ†å‘å™¨ `inspect_file()`
  - âœ… Tabular Inspectorï¼ˆå°æ–‡ä»¶å®Œæ•´è¯»å–ï¼Œå¤§æ–‡ä»¶é‡‡æ ·ï¼‰
  - âœ… Single-Cell Inspectorï¼ˆbacked='r' æ¨¡å¼ï¼‰
  - âœ… Image Inspectorï¼ˆPIL æ£€æŸ¥ï¼‰
- **è¿”å›æ ¼å¼**:
  ```python
  {
    "status": "success",
    "file_type": "tabular",
    "data_range": {"min": float, "max": float, "mean": float, "median": float},
    "missing_rate": float,
    "data": {
      "summary": {
        "n_samples": int,
        "n_features": int,
        "missing_rate": float,
        "is_sampled": bool
      }
    }
  }
  ```

#### 1.2 MetabolomicsTool é‡æ„
- **ä½ç½®**: `gibh_agent/tools/metabolomics_tool.py`
- **åŠŸèƒ½**: âœ… å§”æ‰˜ç»™ FileInspectorï¼Œä¿æŒå…¼å®¹æ€§
- **è¿”å›æ ¼å¼**: âœ… ä¸åŸæœ‰ä¸€è‡´ï¼ŒåŒ…å« `n_samples`, `n_metabolites`, `missing_values`, `data_statistics`

#### 1.3 MetabolomicsAgent æ›´æ–°
- **ä½ç½®**: `gibh_agent/agents/specialists/metabolomics_agent.py`
- **åŠŸèƒ½**:
  - âœ… `_peek_data_lightweight()`: ä½¿ç”¨ FileInspector
  - âœ… `_generate_parameter_recommendations()`: åªä¼ é€’ç»Ÿè®¡ä¿¡æ¯ç»™ LLM
  - âœ… `_apply_recommendations_to_steps()`: è‡ªåŠ¨å¡«å……æ¨èå€¼åˆ°æ­¥éª¤å‚æ•°
- **è¿”å›æ ¼å¼**:
  ```python
  {
    "type": "workflow_config",
    "workflow_data": {...},
    "file_paths": [...],
    "recommendation": {
      "summary": str,
      "params": {
        "normalization": {"value": str, "reason": str},
        "missing_threshold": {"value": str, "reason": str},
        "scale": {"value": bool, "reason": str},
        "n_components": {"value": str, "reason": str}
      }
    }
  }
  ```

#### 1.4 æœåŠ¡å™¨ç«¯å¤„ç† âœ…
- **ä½ç½®**: `server.py:1618-1620`
- **åŠŸèƒ½**: âœ… ç¡®ä¿ `recommendation` å­—æ®µè¢«è¿”å›ç»™å‰ç«¯

---

### 2. å‰ç«¯æ•°æ®æ¥æ”¶ä¸æ˜¾ç¤º âœ…

#### 2.1 æ•°æ®æ¥æ”¶
- **ä½ç½®**: `services/nginx/html/index.html:890-892`
- **å¤„ç†é€»è¾‘**: âœ… æ­£ç¡®æ¥æ”¶ `workflow_config` ç±»å‹å“åº”

#### 2.2 å·¥ä½œæµè¡¨å•æ¸²æŸ“ âœ…
- **ä½ç½®**: `services/nginx/html/index.html:1441-1609`
- **åŠŸèƒ½**:
  - âœ… æ˜¾ç¤ºè¯Šæ–­æŠ¥å‘Šï¼ˆä¼˜å…ˆï¼‰
  - âœ… æ˜¾ç¤º AI æ¨èå¡ç‰‡ï¼ˆå¦‚æœæ²¡æœ‰è¯Šæ–­æŠ¥å‘Šï¼‰
  - âœ… è‡ªåŠ¨å¡«å……æ¨èå‚æ•°åˆ°è¡¨å•è¾“å…¥æ¡†
- **è‡ªåŠ¨å¡«å……é€»è¾‘**:
  ```javascript
  // ç¬¬1564-1569è¡Œ
  if (recommendation && recommendation.params && recommendation.params[paramName]) {
      const recValue = recommendation.params[paramName].value;
      if (recValue !== undefined) {
          valueStr = String(recValue);
      }
  }
  ```

#### 2.3 æ¨èå‚æ•°æ˜¾ç¤º âœ…
- **ä½ç½®**: `services/nginx/html/index.html:1478-1506`
- **åŠŸèƒ½**:
  - âœ… æ˜¾ç¤ºæ¨èæ‘˜è¦
  - âœ… æ˜¾ç¤ºæ¯ä¸ªå‚æ•°çš„æ¨èå€¼å’Œç†ç”±
  - âœ… ä½¿ç”¨ Markdown æ¸²æŸ“ï¼ˆå¦‚æœéœ€è¦ï¼‰

---

### 3. æ•°æ®æ ¼å¼ä¸€è‡´æ€§æ£€æŸ¥ âœ…

#### 3.1 æ¨èå‚æ•°æ ¼å¼
- **åç«¯è¿”å›**: `recommendation.params[paramName].value`
- **å‰ç«¯æœŸæœ›**: `recommendation.params[paramName].value`
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

#### 3.2 ç»Ÿè®¡ä¿¡æ¯æ ¼å¼
- **åç«¯è¿”å›**: `data_range`, `missing_rate` åœ¨ `data.summary` ä¸­
- **å‰ç«¯ä½¿ç”¨**: é€šè¿‡ `recommendation` é—´æ¥ä½¿ç”¨ï¼ˆLLM å·²å¤„ç†ï¼‰
- **çŠ¶æ€**: âœ… é€šè¿‡ LLM è½¬æ¢ï¼Œå‰ç«¯æ— éœ€ç›´æ¥è®¿é—®

#### 3.3 å·¥ä½œæµæ­¥éª¤å‚æ•°
- **åç«¯è¿”å›**: `workflow_data.steps[].params` (å¯¹è±¡æ ¼å¼)
- **å‰ç«¯å¤„ç†**: âœ… æ”¯æŒå¯¹è±¡æ ¼å¼å’Œæ•°ç»„æ ¼å¼ï¼ˆå…¼å®¹æ€§ï¼‰
- **çŠ¶æ€**: âœ… å®Œå…¨å…¼å®¹

---

## ğŸ¯ å…³é”®åŠŸèƒ½éªŒè¯

### 1. FileInspector å‡†ç¡®æ€§ âœ…
- âœ… å°æ–‡ä»¶ï¼ˆ<200MBï¼‰ï¼šå®Œæ•´è¯»å–ï¼Œè·å¾—å‡†ç¡®çš„ MAX/MIN/ç¼ºå¤±ç‡
- âœ… å¤§æ–‡ä»¶ï¼ˆ>200MBï¼‰ï¼šé‡‡æ ·10000è¡Œï¼Œé˜²æ­¢ OOM
- âœ… è¿”å›å‡†ç¡®çš„ `data_range` ç”¨äº Log2 åˆ¤æ–­

### 2. å‚æ•°æ¨èå‡†ç¡®æ€§ âœ…
- âœ… åŸºäºçœŸå®çš„ MAX å€¼ï¼ˆ>1000ï¼‰åˆ¤æ–­æ˜¯å¦éœ€è¦ Log2 å˜æ¢
- âœ… åŸºäºçœŸå®çš„ç¼ºå¤±ç‡æ¨èç¼ºå¤±å€¼é˜ˆå€¼
- âœ… åŸºäºæ ·æœ¬æ•°æ¨è PCA ä¸»æˆåˆ†æ•°

### 3. å‰ç«¯è‡ªåŠ¨å¡«å…… âœ…
- âœ… æ¨èå‚æ•°è‡ªåŠ¨å¡«å……åˆ°è¡¨å•è¾“å…¥æ¡†
- âœ… ç”¨æˆ·å¯ä»¥çœ‹åˆ°æ¨èå€¼å’Œç†ç”±
- âœ… ç”¨æˆ·å¯ä»¥ä¿®æ”¹æ¨èå€¼

---

## ğŸ“ æµ‹è¯•å»ºè®®

### 1. æµ‹è¯•å°æ–‡ä»¶ï¼ˆ<200MBï¼‰
1. ä¸Šä¼ å° CSV æ–‡ä»¶ï¼ˆå¦‚ `human_cachexia.csv`ï¼‰
2. è¯·æ±‚å·¥ä½œæµé…ç½®
3. éªŒè¯ï¼š
   - âœ… æ˜¾ç¤º AI æ¨èå¡ç‰‡
   - âœ… æ¨èå‚æ•°è‡ªåŠ¨å¡«å……
   - âœ… æ¨èå€¼åŸºäºå‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯

### 2. æµ‹è¯•å¤§æ–‡ä»¶ï¼ˆ>200MBï¼‰
1. ä¸Šä¼ å¤§ CSV æ–‡ä»¶ï¼ˆ>200MBï¼‰
2. è¯·æ±‚å·¥ä½œæµé…ç½®
3. éªŒè¯ï¼š
   - âœ… ä½¿ç”¨é‡‡æ ·æ¨¡å¼ï¼ˆä¸ OOMï¼‰
   - âœ… ä»ç„¶èƒ½ç”Ÿæˆåˆç†çš„æ¨è

### 3. æµ‹è¯•å‚æ•°ä¿®æ”¹
1. æŸ¥çœ‹è‡ªåŠ¨å¡«å……çš„æ¨èå€¼
2. ä¿®æ”¹æŸäº›å‚æ•°
3. æäº¤å·¥ä½œæµ
4. éªŒè¯ï¼š
   - âœ… ä½¿ç”¨ä¿®æ”¹åçš„å‚æ•°æ‰§è¡Œå·¥ä½œæµ

---

## âœ… æ€»ç»“

**æ‰€æœ‰æ£€æŸ¥é¡¹é€šè¿‡ï¼** å‰åç«¯å·²å®Œå…¨åŒæ­¥ï¼š

1. âœ… FileInspector å¤šæ¨¡æ€æ£€æŸ¥å™¨æ­£å¸¸å·¥ä½œ
2. âœ… ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®ï¼ˆå°æ–‡ä»¶å®Œæ•´è¯»å–ï¼Œå¤§æ–‡ä»¶é‡‡æ ·ï¼‰
3. âœ… å‚æ•°æ¨èåŸºäºå‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯
4. âœ… å‰ç«¯æ­£ç¡®æ¥æ”¶å’Œæ˜¾ç¤ºæ¨èä¿¡æ¯
5. âœ… æ¨èå‚æ•°è‡ªåŠ¨å¡«å……åˆ°è¡¨å•
6. âœ… æ•°æ®æ ¼å¼å®Œå…¨ä¸€è‡´

**ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿›è¡Œæµ‹è¯•ï¼**

---

**æ£€æŸ¥æ—¥æœŸ**: 2026-01-09  
**æ£€æŸ¥çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡

