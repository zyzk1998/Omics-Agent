# Monitor Lite 使用说明

## 📋 概述

`monitor-lite.sh` 是 `monitor.sh` 的简化版本，专注于**智能体逻辑调试**，减少了认知负担，提供更清晰的界面。

## 🎯 设计理念

- **简化菜单**：从 20+ 选项减少到 5 个核心操作
- **专注调试**：核心功能是 Agent Logic Trace，实时监听智能体逻辑流程
- **智能过滤**：自动过滤系统噪音（健康检查、静态文件等），只显示智能体相关的日志

## 🚀 快速开始

```bash
./monitor-lite.sh
```

## 📋 主菜单（5个核心操作）

### 1. 🚀 服务管理
整合了启动、停止、重启、重建等功能：
- 启动服务
- 停止服务
- 重启服务
- 重新构建并启动
- 查看服务状态

### 2. 🕵️ Agent Logic Trace（核心功能）
**实时监听智能体逻辑流程**

这是脚本的核心功能，专门用于调试智能体的执行流程：

**功能特点**：
- 实时监控 API 服务器日志
- 智能过滤：自动排除噪音（健康检查、静态文件请求等）
- 颜色高亮：不同阶段使用不同颜色
  - 🟢 **绿色**：用户查询、处理查询、最终答案
  - 🔵 **青色**：路由决策
  - 🟡 **黄色**：LLM 思考过程
  - 🟣 **紫色**：工具调用、执行步骤
  - 🔵 **蓝色**：工具输出、观察结果
  - 🔴 **红色**：错误信息

**监听的关键词**：
- `User Query` / `Process Query` / `收到聊天请求` / `处理查询`
- `Router` / `路由` / `routing`
- `Thought` / `<think>` / `reasoning`
- `Action` / `Tool Call` / `执行步骤`
- `Observation` / `Tool Output` / `After process_query`
- `Final Answer` / `workflow_config`
- `ERROR` / `Exception` / `❌`

**过滤的噪音**：
- `GET /health`
- `GET /static`
- `200 OK`
- `INFO.*Scanpy`
- `INFO.*设置`
- `INFO.*输出目录`

### 3. 📋 系统日志（原始）
查看原始系统日志，用于深度调试：
- 实时日志（API 服务器）
- 实时日志（Worker）
- 最近日志（50行）
- 错误日志
- 本地日志文件
- Debug 日志（JSON 格式）

### 4. 🛠️ 高级工具
包含其他实用工具：
- 数据清理（上传文件、结果文件）
- 修复 502 错误
- 健康检查
- 查看数据状态
- 查看 JSON 数据

### 5. ❌ 退出

## 🎨 使用示例

### 示例 1：调试智能体逻辑流程

```bash
./monitor-lite.sh
# 选择 2 (Agent Logic Trace)
# 现在在前端发送一个请求，你会看到：
# - 绿色的用户查询
# - 青色的路由决策
# - 黄色的 LLM 思考过程
# - 紫色的工具调用
# - 蓝色的工具输出
# - 绿色的最终答案
```

### 示例 2：启动服务并开始调试

```bash
./monitor-lite.sh
# 选择 1 (服务管理)
# 选择 1 (启动服务)
# 等待服务启动后，选择 2 (Agent Logic Trace)
```

### 示例 3：查看最近的错误

```bash
./monitor-lite.sh
# 选择 3 (系统日志)
# 选择 4 (错误日志)
```

## 🔍 Agent Logic Trace 工作原理

1. **实时监控**：使用 `docker compose logs -f api-server` 实时获取日志
2. **智能过滤**：使用 Python 脚本过滤噪音日志
3. **颜色高亮**：根据关键词自动着色
4. **降级处理**：如果 Docker 不可用，自动降级到本地日志文件

## 💡 提示

1. **最佳实践**：
   - 在调试时，先启动 Agent Logic Trace
   - 然后在前端发送请求
   - 观察完整的执行流程

2. **颜色含义**：
   - 绿色 = 用户输入/最终输出
   - 青色 = 路由决策
   - 黄色 = LLM 思考
   - 紫色 = 工具调用
   - 蓝色 = 工具输出
   - 红色 = 错误

3. **退出**：
   - 在 Agent Logic Trace 模式下，按 `Ctrl+C` 退出
   - 返回主菜单后，选择 0 退出脚本

## 🔄 与 monitor.sh 的关系

- `monitor.sh`：完整版本，包含所有功能（20+ 选项）
- `monitor-lite.sh`：简化版本，专注于智能体调试（5 个核心操作）

两个脚本可以共存，根据需求选择使用。

## 📞 支持

如有问题或建议，请查看项目文档或联系维护人员。

