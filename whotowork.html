<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omics Agent - How to Work å…¨æµç¨‹æ•°æ®æµå‘å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
            margin: 0;
        }
        
        .container {
            max-width: 95%;
            width: 95%;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border: 3px solid rgba(255,255,255,0.8);
        }
        
        /* Master-Detail å¸ƒå±€ */
        .main-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .diagram-section {
            flex: 0 0 65%;
            display: flex;
            flex-direction: column;
        }
        
        .detail-panel {
            flex: 0 0 35%;
            min-width: 380px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-width: thin;
            scrollbar-color: #667eea #f1f3f5;
        }
        
        .detail-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .detail-panel::-webkit-scrollbar-track {
            background: #f1f3f5;
            border-radius: 4px;
        }
        
        .detail-panel::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
        
        .detail-panel::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }
        
        /* æ§åˆ¶æ  */
        .control-bar {
            background: #ffffff;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-bar h3 {
            margin: 0;
            font-size: 14px;
            color: #495057;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .scenario-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .scenario-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }
        
        .scenario-btn.active {
            background: #764ba2;
            box-shadow: 0 2px 8px rgba(118, 75, 162, 0.3);
        }
        
        .scenario-btn:active {
            transform: translateY(0);
        }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        .detail-panel h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .detail-panel .default-state {
            color: #6c757d;
            font-style: italic;
            text-align: center;
            padding: 40px 20px;
        }
        
        .detail-content {
            display: none;
        }
        
        .detail-content.active {
            display: block;
        }
        
        .detail-item {
            margin-bottom: 20px;
        }
        
        .detail-item-label {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-item-value {
            color: #212529;
            font-size: 14px;
            line-height: 1.7;
            background: white;
            padding: 12px;
            border-radius: 4px;
            border-left: 3px solid #667eea;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .detail-item-value code {
            background: #f1f3f5;
            padding: 3px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #d63384;
            word-break: break-all;
        }
        
        /* Synapse Inspector - å‚æ•°æ˜ å°„è¡¨ */
        .param-mapping-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: 8px;
        }
        
        .param-mapping-table th,
        .param-mapping-table td {
            border: 1px solid #dee2e6;
            padding: 10px 12px;
            text-align: left;
        }
        
        .param-mapping-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
            width: 35%;
        }
        
        .param-mapping-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .param-mapping-table tr:hover {
            background: #e9ecef;
        }
        
        /* æ‰“å­—æœºæ•ˆæœä»£ç å— */
        .typewriter-code {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: #1e1e1e;
            color: #9cdcfe;
            padding: 14px 16px;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
            white-space: pre-wrap;
            overflow: hidden;
            border-right: 1px solid #333;
        }
        
        .typewriter-code .cursor {
            display: inline-block;
            width: 8px;
            height: 14px;
            background: #4CAF50;
            animation: blink 0.8s step-end infinite;
            vertical-align: text-bottom;
        }
        
        @keyframes blink {
            50% { opacity: 0; }
        }
        
        /* å­¦æœ¯å¼•ç”¨æ ·å¼ */
        .detail-item-value[style*="font-size: 12px"] {
            white-space: pre-line;
        }
        
        .detail-item-value br {
            display: block;
            margin: 4px 0;
        }
        
        /* LLM Logic éƒ¨åˆ†ç‰¹æ®Šæ ·å¼ï¼ˆæµ…ç´«è‰²èƒŒæ™¯ï¼‰ */
        .detail-item-value.llm-logic-section {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%) !important;
            border-left: 4px solid #9333ea !important;
            padding: 15px !important;
            border-radius: 6px !important;
            box-shadow: 0 2px 4px rgba(147, 51, 234, 0.1);
        }
        
        .detail-item-value.llm-logic-section strong {
            color: #7c3aed;
            font-weight: 700;
        }
        
        .detail-item-value.llm-logic-section code {
            background: rgba(147, 51, 234, 0.1) !important;
            color: #6b21a8 !important;
            border: 1px solid rgba(147, 51, 234, 0.2);
        }
        
        /* åœºæ™¯æ•°æ®æµç‰¹æ®Šæ ·å¼ */
        .detail-content .detail-item {
            page-break-inside: avoid;
        }
        
        .detail-content .detail-item strong {
            color: #495057;
            font-weight: 600;
        }
        
        /* SVG è¦†ç›–å±‚ - pointer-events: none è®©ç©ºç™½åŒºåŸŸç‚¹å‡»ç©¿é€åˆ°å¡ç‰‡ï¼Œpath ä¿æŒ stroke å¯ç‚¹å‡» */
        .svg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            overflow: visible;
        }
        
        /* åŸºåº•è·¯å¾„ï¼šåŠ ç²—ä¾¿äºç‚¹å‡» */
        .svg-overlay path.synapse-base {
            fill: none;
            stroke-width: 4;
            opacity: 0.3;
            pointer-events: stroke;
            cursor: pointer;
            transition: stroke-width 0.2s, opacity 0.2s;
        }
        
        .svg-overlay path.synapse-base:hover {
            stroke-width: 6;
            opacity: 0.5;
        }
        
        /* æ§åˆ¶æµ - è“è‰² */
        .svg-overlay path.synapse-base.synapse-control { stroke: #2196F3; }
        .svg-overlay path.synapse-pulse.synapse-control {
            stroke: #2196F3;
            filter: drop-shadow(0 0 6px #2196F3) drop-shadow(0 0 12px rgba(33, 150, 243, 0.6));
        }
        
        /* æ•°æ®æµ - ç»¿è‰² */
        .svg-overlay path.synapse-base.synapse-data { stroke: #4CAF50; }
        .svg-overlay path.synapse-pulse.synapse-data {
            stroke: #4CAF50;
            filter: drop-shadow(0 0 6px #4CAF50) drop-shadow(0 0 12px rgba(76, 175, 80, 0.6));
        }
        
        /* é”™è¯¯/ä¿®æ­£å¾ªç¯ - çº¢è‰² */
        .svg-overlay path.synapse-base.synapse-error { stroke: #F44336; }
        .svg-overlay path.synapse-pulse.synapse-error {
            stroke: #F44336;
            filter: drop-shadow(0 0 6px #F44336) drop-shadow(0 0 12px rgba(244, 67, 54, 0.6));
        }
        
        /* LLM è°ƒç”¨ - ç´«è‰²è™šçº¿ */
        .svg-overlay path.synapse-base.synapse-llm {
            stroke: #9333ea;
            stroke-dasharray: 8, 6;
        }
        .svg-overlay path.synapse-pulse.synapse-llm {
            stroke: #9333ea;
            stroke-dasharray: 8, 6;
            filter: drop-shadow(0 0 6px #9333ea) drop-shadow(0 0 12px rgba(147, 51, 234, 0.5));
        }
        
        /* è„‰å†²ï¼šæ²¿è·¯å¾„ç§»åŠ¨çš„å…‰ç‚¹ */
        .svg-overlay path.synapse-pulse {
            fill: none;
            stroke-width: 5;
            stroke-dasharray: 12, 1000;
            stroke-dashoffset: 0;
            opacity: 1;
            pointer-events: none;
            animation: synapsePulse 2s ease-in-out infinite;
        }
        
        @keyframes synapsePulse {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -1012; }
        }
        
        /* æµ®åŠ¨æ ‡ç­¾ */
        .svg-overlay .synapse-label {
            font-size: 11px;
            font-weight: 600;
            fill: #333;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            paint-order: stroke;
            stroke: white;
            stroke-width: 3px;
        }
        
        .synapse-label-group {
            pointer-events: none;
        }
        
        /* é«˜äº®å’Œæš—æ·¡æ•ˆæœ */
        .flow-step-card.dimmed {
            opacity: 0.3;
            filter: grayscale(0.7);
        }
        
        .flow-step-card.active-flow {
            border-width: 5px;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }
        
        .flow-step-card.clickable {
            cursor: pointer;
            pointer-events: auto;
        }
        
        .flow-step-card.clickable:hover {
            border-width: 4px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }
        
        .flow-diagram {
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            border: 4px solid #dee2e6;
            border-radius: 12px;
            padding: 48px 56px;
            margin: 0;
            overflow-x: auto;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
        }
        
        /* CSS Grid 2D æµç¨‹å›¾å¸ƒå±€ (4åˆ—ï¼šä¸»æµç¨‹ + LLM æœåŠ¡) */
        .flow-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 280px;
            grid-template-rows: auto;
            gap: 30px 20px;
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            padding: 20px 0;
            pointer-events: auto;
        }
        
        /* è¿æ¥çº¿ - ä½¿ç”¨ä¼ªå…ƒç´ åˆ›å»ºè§†è§‰è¿æ¥ */
        .flow-step-card::after {
            content: '';
            position: absolute;
            width: 3px;
            height: 30px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            opacity: 0.6;
        }
        
        /* å…¨å®½å¡ç‰‡æ˜¾ç¤ºå‘ä¸‹çš„è¿æ¥çº¿ */
        .flow-step-card.user-layer::after,
        .flow-step-card.orchestrator-layer::after,
        .flow-step-card.agent-layer::after,
        .flow-step-card.executor-layer::after {
            display: block;
        }
        
        /* æœ€ç»ˆè¾“å‡ºå±‚ä¸æ˜¾ç¤ºè¿æ¥çº¿ */
        .flow-step-card.output-layer::after {
            display: none;
        }
        
        /* å¹¶æ’å¡ç‰‡ï¼ˆå¤§è„‘å±‚ï¼‰ä¸æ˜¾ç¤ºå‘ä¸‹çš„è¿æ¥çº¿ï¼Œæ˜¾ç¤ºæ°´å¹³è¿æ¥ */
        .flow-step-card.router-planner::after {
            display: none;
        }
        
        .flow-step-card.tool-retriever::after {
            display: none;
        }
        
        /* è¿æ¥çº¿ç®­å¤´ */
        .flow-step-card::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid #667eea;
            bottom: -38px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            opacity: 0.8;
        }
        
        .flow-step-card.user-layer::before,
        .flow-step-card.orchestrator-layer::before,
        .flow-step-card.agent-layer::before,
        .flow-step-card.executor-layer::before {
            display: block;
        }
        
        .flow-step-card.router-planner::before,
        .flow-step-card.tool-retriever::before,
        .flow-step-card.output-layer::before {
            display: none;
        }
        
        /* æ°´å¹³è¿æ¥çº¿ï¼ˆç”¨äºå¹¶æ’å¡ç‰‡ - å¤§è„‘å±‚ï¼‰ */
        .flow-step-card.router-planner::after {
            content: '';
            display: block;
            position: absolute;
            width: 20px;
            height: 3px;
            background: linear-gradient(to right, #667eea, #764ba2);
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
            opacity: 0.6;
        }
        
        .flow-step-card.router-planner::before {
            content: '';
            display: block;
            position: absolute;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 8px solid #667eea;
            right: -28px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            opacity: 0.8;
        }
        
        /* æµç¨‹å¡ç‰‡åŸºç¡€æ ·å¼ */
        .flow-step-card {
            background: white;
            border: 3px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .flow-step-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border-width: 4px;
        }
        
        /* å­¦æœ¯è®ºæ–‡å¼•ç”¨å¾½ç«  */
        .academic-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            margin-top: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            letter-spacing: 0.3px;
            line-height: 1.4;
        }
        
        .academic-badge::before {
            content: 'ğŸ“„ ';
            font-size: 11px;
        }
        
        .academic-badge.small {
            font-size: 9px;
            padding: 3px 8px;
        }
        
        /* ç”¨æˆ·å±‚ - é¡¶éƒ¨å…¨å®½ */
        .flow-step-card.user-layer {
            grid-column: 1 / -1;
            border-color: #4CAF50;
            background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        }
        
        /* API å±‚ */
        .flow-step-card.api-layer {
            grid-column: 1 / -1;
            border-color: #2196F3;
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
        }
        
        /* ç¼–æ’å±‚ */
        .flow-step-card.orchestrator-layer {
            grid-column: 1 / -1;
            border-color: #9C27B0;
            background: linear-gradient(135deg, #f3e5f5 0%, #ffffff 100%);
            border-width: 4px;
        }
        
        /* æ ¸å¿ƒé€»è¾‘å±‚ - å¹¶æ’æ˜¾ç¤º */
        .flow-step-card.brain-layer {
            border-color: #FF6B35;
            background: linear-gradient(135deg, #fff5f0 0%, #ffffff 100%);
            border-width: 4px;
            position: relative;
        }
        
        .flow-step-card.router-planner {
            grid-column: 1 / 2;
        }
        
        .flow-step-card.tool-retriever {
            grid-column: 2 / 3;
        }
        
        /* LLM æœåŠ¡å±‚ - å³ä¾§æµ®åŠ¨ï¼Œè·¨ Orchestrator~Executor */
        .flow-step-card.llm-layer {
            grid-column: 4 / 5;
            grid-row: 2 / 6;
            border-color: #9333ea;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-style: dashed;
            border-width: 3px;
        }
        
        .flow-step-card.llm-layer::after,
        .flow-step-card.llm-layer::before {
            display: none;
        }
        
        /* æ‰§è¡Œå±‚ */
        .flow-step-card.executor-layer {
            grid-column: 1 / -1;
            border-color: #F44336;
            background: linear-gradient(135deg, #ffebee 0%, #ffffff 100%);
        }
        
        /* å·¥å…·å±‚ - å›¾ä¹¦é¦†æ ·å¼ */
        .flow-step-card.tool-layer {
            grid-column: 1 / 2;
            border-color: #F44336;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 20px,
                    rgba(244, 67, 54, 0.1) 20px,
                    rgba(244, 67, 54, 0.1) 22px
                ),
                linear-gradient(135deg, #ffebee 0%, #ffffff 100%);
            position: relative;
        }
        
        .flow-step-card.tool-layer::after {
            content: 'ğŸ“š';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            opacity: 0.3;
        }
        
        /* é¢†åŸŸæ™ºèƒ½ä½“å±‚ */
        .flow-step-card.agent-layer {
            grid-column: 1 / -1;
            border-color: #FF9800;
            background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%);
        }
        
        /* ç»“æœå±‚ */
        .flow-step-card.result-layer {
            grid-column: 3 / 4;
            border-color: #00BCD4;
            background: linear-gradient(135deg, #e0f7fa 0%, #ffffff 100%);
        }
        
        /* æœ€ç»ˆè¾“å‡ºå±‚ */
        .flow-step-card.output-layer {
            grid-column: 1 / -1;
            border-color: #4CAF50;
            background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        }
        
        .step-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .step-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
            margin-top: 6px;
        }
        
        .step-components {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
            margin-top: 10px;
        }
        
        .component-tag {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 11px;
            color: #667eea;
            font-weight: 500;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .flow-grid {
                grid-template-columns: 1fr 1fr 200px;
            }
            
            .flow-step-card.user-layer,
            .flow-step-card.orchestrator-layer,
            .flow-step-card.agent-layer,
            .flow-step-card.executor-layer,
            .flow-step-card.output-layer {
                grid-column: 1 / -1;
            }
            
            .flow-step-card.router-planner {
                grid-column: 1 / 2;
            }
            
            .flow-step-card.tool-retriever {
                grid-column: 2 / 3;
            }
            
            .flow-step-card.llm-layer {
                grid-column: 3 / 4;
                grid-row: 2 / 6;
            }
        }
        
        @media (max-width: 768px) {
            .flow-grid {
                grid-template-columns: 1fr;
            }
            
            .flow-step-card {
                grid-column: 1 / -1 !important;
                grid-row: auto !important;
            }
            
            .academic-badge {
                font-size: 9px;
                padding: 3px 8px;
            }
        }
        
        .flow-step {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .flow-step h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .flow-step ol {
            margin-left: 20px;
        }
        
        .flow-step li {
            margin: 8px 0;
            color: #333;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .section {
            margin: 40px 0;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .data-format {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .data-format h4 {
            color: #1976D2;
            margin-bottom: 8px;
        }
        
        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .print-btn:hover {
            background: #5568d3;
        }
        
        /* Code Pop-up Modal */
        .code-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(8px);
            color: #00ff00;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 13px;
            z-index: 1000;
            padding: 24px;
            border-radius: 8px;
            max-width: 80%;
            max-height: 80%;
            overflow: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            border: 1px solid rgba(0, 255, 0, 0.3);
            cursor: pointer;
        }
        
        .code-modal.active {
            display: block;
        }
        
        .code-modal pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        @media print {
            /* é¡µé¢è®¾ç½® */
            @page {
                size: A4 landscape;
                margin: 1cm;
            }
            
            /* å¼ºåˆ¶æ‰“å°èƒŒæ™¯é¢œè‰² */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body {
                background: white !important;
                padding: 0;
                margin: 0;
            }
            
            /* éšè— UI å…ƒç´  */
            .print-btn,
            .code-modal,
            .control-bar,
            .detail-panel {
                display: none !important;
            }
            
            /* å®¹å™¨æ ·å¼ */
            .container {
                box-shadow: none !important;
                padding: 20px !important;
                background: white !important;
                border-radius: 0 !important;
            }
            
            /* Master-Detail å¸ƒå±€åœ¨æ‰“å°æ—¶å˜ä¸ºå•åˆ— */
            .main-layout {
                display: block !important;
            }
            
            .diagram-section {
                width: 100% !important;
            }
            
            /* éšè— SVG è¦†ç›–å±‚ */
            .svg-overlay {
                display: none !important;
            }
            
            /* æµç¨‹å›¾æ ·å¼ */
            .flow-diagram {
                page-break-inside: avoid !important;
                background: #f8f9fa !important;
                border: 2px solid #dee2e6 !important;
                padding: 30px !important;
                margin: 20px 0 !important;
            }
            
            .flow-grid {
                gap: 25px 15px !important;
            }
            
            /* å¡ç‰‡æ ·å¼ - ç¡®ä¿èƒŒæ™¯å’Œè¾¹æ¡†æ‰“å° */
            .flow-step-card {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                background: white !important;
                border: 3px solid !important;
                box-shadow: 0 2px 6px rgba(0,0,0,0.1) !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* ç¡®ä¿æ¸å˜èƒŒæ™¯æ‰“å° */
            .flow-step-card.user-layer {
                background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%) !important;
                border-color: #4CAF50 !important;
            }
            
            .flow-step-card.orchestrator-layer {
                background: linear-gradient(135deg, #f3e5f5 0%, #ffffff 100%) !important;
                border-color: #9C27B0 !important;
            }
            
            .flow-step-card.brain-layer {
                background: linear-gradient(135deg, #fff5f0 0%, #ffffff 100%) !important;
                border-color: #FF6B35 !important;
            }
            
            .flow-step-card.agent-layer {
                background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%) !important;
                border-color: #FF9800 !important;
            }
            
            .flow-step-card.executor-layer {
                background: linear-gradient(135deg, #ffebee 0%, #ffffff 100%) !important;
                border-color: #F44336 !important;
            }
            
            /* å­¦æœ¯å¾½ç« æ ·å¼ */
            .academic-badge {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* è¿æ¥çº¿ */
            .flow-step-card::after,
            .flow-step-card::before {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* æ ‡é¢˜å’Œæ–‡æœ¬ */
            h1, h2, h3 {
                color: #333 !important;
                page-break-after: avoid !important;
            }
            
            .section {
                page-break-inside: avoid !important;
            }
            
            /* ä»£ç å— */
            .code-block {
                background: #1e1e1e !important;
                color: #d4d4d4 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* æ•°æ®æ ¼å¼æ¡† */
            .data-format {
                background: #e7f3ff !important;
                border-left: 4px solid #2196F3 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
    </style>
</head>
<body>
    <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°/å¯¼å‡º PDF</button>
    
    <!-- Code Pop-up Modal (ç‚¹å‡»è¿æ¥çº¿æ˜¾ç¤ºï¼Œç‚¹å‡»ä»»æ„å¤„å…³é—­) -->
    <div class="code-modal" id="code-modal" onclick="event.stopPropagation()">
        <pre id="code-modal-content"></pre>
    </div>
    
    <div class="container">
        <h1>ğŸš€ Omics Agent - Interactive Architecture Dashboard</h1>
        <p class="subtitle">äº¤äº’å¼ç™½ç›’æ¶æ„ä»ªè¡¨æ¿ï¼šä»ç”¨æˆ·éœ€æ±‚åˆ°åˆ†æç»“æœçš„å®Œæ•´æµç¨‹</p>
        
        <!-- Master-Detail å¸ƒå±€ -->
        <div class="main-layout">
            <!-- ä¸»åŒºåŸŸï¼šæ¶æ„å›¾ -->
            <div class="diagram-section">
                <!-- æ§åˆ¶æ ï¼šåœºæ™¯æ¨¡å¼ -->
                <div class="control-bar">
                    <h3>ğŸ“Š åœºæ™¯æ¨¡å¼ (Scenario Mode):</h3>
                    <button class="scenario-btn" onclick="renderScenario('planning', this)">è§„åˆ’æµç¨‹ (Planning Flow)</button>
                    <button class="scenario-btn" onclick="renderScenario('execution', this)">æ‰§è¡Œæµç¨‹ (Execution Flow)</button>
                    <button class="scenario-btn" onclick="renderScenario('error', this)">é”™è¯¯å¾ªç¯ (Error Loop)</button>
                    <button class="scenario-btn" onclick="renderScenario('chat', this)">ç›´æ¥èŠå¤© (Direct Chat)</button>
                    <button class="scenario-btn" onclick="renderScenario('reset', this)">é‡ç½® (Reset)</button>
                </div>
                
                <!-- æµç¨‹å›¾ - æ•°å­—å®éªŒå®¤ç±»æ¯” (CSS Grid 2D å¸ƒå±€) -->
                <div class="flow-diagram">
                    <div class="flow-grid">
                        <!-- ç¬¬1è¡Œ: ç”¨æˆ· (å…¨å®½) -->
                        <div class="flow-step-card user-layer clickable" data-module="user" onclick="showModuleDetails('user')">
                            <div class="step-title">ğŸ‘©â€ğŸ”¬ ç”¨æˆ· (User)</div>
                            <div class="step-desc">æå‡ºéœ€æ±‚ï¼š"å¸®æˆ‘åˆ†æè¿™ä¸ªæ•°æ®"</div>
                            <div class="step-components">
                                <span class="component-tag">Web UI</span>
                                <span class="component-tag">æ–‡ä»¶ä¸Šä¼ </span>
                                <span class="component-tag">è‡ªç„¶è¯­è¨€æŸ¥è¯¢</span>
                            </div>
                        </div>
                        
                        <!-- ç¬¬2è¡Œ: æ€»æ§ç¼–æ’ (å…¨å®½) -->
                        <div class="flow-step-card orchestrator-layer clickable" data-module="orchestrator" onclick="showModuleDetails('orchestrator')">
                            <div class="step-title">ğŸ¤– æ€»æ§ç¼–æ’ (Orchestrator)</div>
                            <div class="step-desc">è´Ÿè´£ç†è§£æ„å›¾ï¼Œåˆ†å‘ä»»åŠ¡ï¼Œåè°ƒå¯¹è¯æµç¨‹</div>
                            <div class="step-components">
                                <span class="component-tag">æ„å›¾åˆ†ç±»</span>
                                <span class="component-tag">ä»»åŠ¡åˆ†å‘</span>
                                <span class="component-tag">æµç¨‹åè°ƒ</span>
                            </div>
                        </div>
                        
                        <!-- ç¬¬3è¡Œ: å¤§è„‘å±‚ (å¹¶æ’) -->
                        <div class="flow-step-card brain-layer router-planner clickable" data-module="planner" onclick="showModuleDetails('planner')">
                            <div class="step-title">ğŸ§  é¦–å¸­ç§‘å­¦å®¶ (Lead Scientist)</div>
                            <div class="step-desc">æ‹†è§£ç§‘å­¦é—®é¢˜ï¼Œç”Ÿæˆå®éªŒæ­¥éª¤ï¼Œè§„åˆ’åˆ†ææµç¨‹</div>
                            <div class="step-components">
                                <span class="component-tag">Workflow Planner</span>
                                <span class="component-tag">ç§‘å­¦æ¨ç†</span>
                                <span class="component-tag">æ­¥éª¤ç”Ÿæˆ</span>
                            </div>
                        </div>
                        
                        <div class="flow-step-card brain-layer tool-retriever clickable" data-module="retriever" onclick="showModuleDetails('retriever')">
                            <div class="step-title">ğŸ“š å›¾ä¹¦é¦†å‘˜ (Librarian)</div>
                            <div class="step-desc">åœ¨å·¥å…·åº“ä¸­å¯»æ‰¾åˆé€‚çš„å·¥å…·ï¼Œè¯­ä¹‰æ£€ç´¢åŒ¹é…</div>
                            <div class="step-components">
                                <span class="component-tag">Tool Retriever</span>
                                <span class="component-tag">ChromaDB</span>
                                <span class="component-tag">è¯­ä¹‰æ£€ç´¢</span>
                            </div>
                        </div>
                        
                        <!-- LLM æœåŠ¡èŠ‚ç‚¹ (å³ä¾§æµ®åŠ¨ï¼Œè·¨è¡Œ) -->
                        <div class="flow-step-card llm-layer clickable" data-module="llm" onclick="showModuleDetails('llm')">
                            <div class="step-title">âš¡ DeepSeek-R1</div>
                            <div class="step-desc">å¤§è¯­è¨€æ¨¡å‹æ¨ç†å¼•æ“</div>
                            <div class="step-components">
                                <span class="component-tag">æ„å›¾åˆ†ç±»</span>
                                <span class="component-tag">å·¥ä½œæµè§„åˆ’</span>
                                <span class="component-tag">è¯Šæ–­æŠ¥å‘Š</span>
                            </div>
                        </div>
                        
                        <!-- ç¬¬4è¡Œ: é¢†åŸŸä¸“å®¶ (å…¨å®½) -->
                        <div class="flow-step-card agent-layer clickable" data-module="agent" onclick="showModuleDetails('agent')">
                            <div class="step-title">ğŸ§¬ é¢†åŸŸä¸“å®¶ (Domain Agents)</div>
                            <div class="step-desc">æ‹¥æœ‰ RNA/ä»£è°¢ç»„å­¦çš„ä¸“ä¸šçŸ¥è¯†ï¼Œæ‰§è¡Œé¢†åŸŸç‰¹å®šåˆ†æ</div>
                            <div class="step-components">
                                <span class="component-tag">RNA Agent</span>
                                <span class="component-tag">Metabolomics Agent</span>
                                <span class="component-tag">é¢†åŸŸçŸ¥è¯†</span>
                            </div>
                        </div>
                        
                        <!-- ç¬¬5è¡Œ: æ‰§è¡Œå¼•æ“ (å…¨å®½) -->
                        <div class="flow-step-card executor-layer clickable" data-module="executor" onclick="showModuleDetails('executor')">
                            <div class="step-title">ğŸ¦¾ æ‰§è¡Œå¼•æ“ (Executor)</div>
                            <div class="step-desc">ç¼–å†™ä»£ç ï¼Œæ“ä½œè½¯ä»¶ï¼Œç”Ÿæˆå›¾è¡¨ï¼Œæ‰§è¡Œå…·ä½“åˆ†ææ­¥éª¤</div>
                            <div class="step-components">
                                <span class="component-tag">WorkflowExecutor</span>
                                <span class="component-tag">å‚æ•°éªŒè¯</span>
                                <span class="component-tag">å·¥å…·è°ƒç”¨</span>
                                <span class="component-tag">ç»“æœç”Ÿæˆ</span>
                            </div>
                        </div>
                        
                        <!-- ç¬¬6è¡Œ: æœ€ç»ˆè¾“å‡º (å…¨å®½) -->
                        <div class="flow-step-card output-layer clickable" data-module="output" onclick="showModuleDetails('output')">
                            <div class="step-title">ğŸ“Š åˆ†æç»“æœ (Analysis Results)</div>
                            <div class="step-desc">é€šè¿‡ Server-Sent Events å®æ—¶æ¨é€åˆ†æè¿›åº¦å’Œç»“æœï¼Œå‰ç«¯å®æ—¶æ¸²æŸ“</div>
                            <div class="step-components">
                                <span class="component-tag">SSE æµå¼è¾“å‡º</span>
                                <span class="component-tag">å·¥ä½œæµå¡ç‰‡</span>
                                <span class="component-tag">æ­¥éª¤ç»“æœ</span>
                                <span class="component-tag">AI è¯Šæ–­æŠ¥å‘Š</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SVG è¦†ç›–å±‚ç”¨äºåŠ¨æ€è¿æ¥çº¿ -->
                    <svg class="svg-overlay" id="flow-svg">
                        <!-- åŠ¨æ€è·¯å¾„å°†é€šè¿‡ JavaScript æ·»åŠ  -->
                    </svg>
                </div>
            </div>
            
            <!-- ä¾§è¾¹æ ï¼šç³»ç»Ÿè§£å‰–ä¸é€»è¾‘è¿½è¸ªé¢æ¿ -->
            <div class="detail-panel">
                <h2>ğŸ”¬ System Anatomy & Logic Trace<br><span style="font-size: 14px; color: #666;">ç³»ç»Ÿè§£å‰–ä¸é€»è¾‘è¿½è¸ª</span></h2>
                <div class="default-state" id="default-state">
                    Select a module or click a connection line to inspect data flow and parameter mapping.
                </div>
                <div class="detail-content" id="detail-content">
                    <!-- å†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€å¡«å…… -->
                </div>
            </div>
        </div>
        
        <script>
            // æ¨¡å—æŠ€æœ¯è§„æ ¼æ•°æ®å¯¹è±¡ï¼ˆåŒè¯­ + IEEE æ ¼å¼å¼•ç”¨ï¼‰
            const moduleDetails = {
                user: {
                    component: "ç”¨æˆ· (User)",
                    coreFunction: "ç”¨æˆ·äº¤äº’æ¥å£",
                    dataIO: "Input: è‡ªç„¶è¯­è¨€æŸ¥è¯¢ + æ–‡ä»¶ä¸Šä¼  â†’ Output: HTTP POST è¯·æ±‚",
                    technologyDescription: "å®ç°åŸºäº React/Vanilla JS çš„å‰ç«¯ç•Œé¢ï¼Œä½¿ç”¨ FormData API å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Œé€šè¿‡ fetch API å‘é€ HTTP POST è¯·æ±‚åˆ°åç«¯ã€‚å‰ç«¯è´Ÿè´£ç”¨æˆ·è¾“å…¥éªŒè¯ã€æ–‡ä»¶é¢„è§ˆå’Œé”™è¯¯æç¤ºã€‚",
                    keyLogic: "ç”¨æˆ·åœ¨ Web UI ä¸­è¾“å…¥æŸ¥è¯¢æ–‡æœ¬æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œå‰ç«¯æ”¶é›†ç”¨æˆ·è¾“å…¥å¹¶å‘é€åˆ°åç«¯ APIã€‚",
                    designRationale: "åˆ†ç¦»ç”¨æˆ·ç•Œé¢å±‚ä¸ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå®ç°å‰åç«¯è§£è€¦ã€‚å‰ç«¯è´Ÿè´£äº¤äº’å’Œå±•ç¤ºï¼Œåç«¯è´Ÿè´£è®¡ç®—å’Œå†³ç­–ã€‚è¿™ç§æ¶æ„æ”¯æŒå‰åç«¯ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²ï¼Œæé«˜ç³»ç»Ÿå¯ç»´æŠ¤æ€§ã€‚",
                    upstreamDownstream: "Upstream: N/A (ç”¨æˆ·å…¥å£) | Downstream: Orchestrator (æ¥æ”¶ç”¨æˆ·è¯·æ±‚)",
                    llmLogic: "N/A - User Interface Layerï¼ˆä¸ç›´æ¥è°ƒç”¨ LLM APIï¼‰",
                    academicBasis: "N/A - User Interface Layer (æ ‡å‡† Web æ¶æ„æ¨¡å¼ï¼ŒåŸºäº RESTful API è®¾è®¡åŸåˆ™)"
                },
                orchestrator: {
                    component: "æ€»æ§ç¼–æ’ (Orchestrator)",
                    coreFunction: "core.orchestrator.AgentOrchestrator.stream_process()",
                    dataIO: "Input: UserQuery + ConversationHistory + UploadedFiles â†’ Output: SSE Events (status, workflow, step_result, diagnosis, result)",
                    technologyDescription: "å®ç°åŸºäº SOPï¼ˆStandard Operating Procedureï¼‰çš„åè°ƒæœºåˆ¶ã€‚ä½¿ç”¨ Celery è¿›è¡Œå¼‚æ­¥ä»»åŠ¡è°ƒåº¦ï¼ŒRedis ä½œä¸ºæ¶ˆæ¯ä»£ç†ï¼ˆmessage brokerï¼‰å¤„ç†é«˜å¹¶å‘è¯·æ±‚ã€‚é€šè¿‡ FastAPI çš„ StreamingResponse å®ç° SSE æµå¼è¾“å‡ºï¼Œä½¿ç”¨ Python async/await å¼‚æ­¥ç”Ÿæˆå™¨é€æ¡ yield SSE äº‹ä»¶ã€‚ä½¿ç”¨ LLM API è¿›è¡Œæ„å›¾åˆ†ç±»ï¼ŒåŸºäºè§„åˆ™å’Œ LLM è¾“å‡ºè¿›è¡Œè·¯ç”±å†³ç­–ã€‚",
                    keyLogic: "ç®¡ç†å¯¹è¯å†å²ï¼Œè¿›è¡Œæ„å›¾åˆ†ç±»ï¼ˆChat vs Taskï¼‰ï¼Œåè°ƒå¤šæ™ºèƒ½ä½“åä½œã€‚ä½¿ç”¨ LLM è¿›è¡Œå…¨å±€æ„å›¾åˆ¤æ–­ï¼Œæ ¹æ®ç»“æœè·¯ç”±åˆ°è§„åˆ’æµç¨‹æˆ–ç›´æ¥èŠå¤©ã€‚ç»´æŠ¤ä¼šè¯çŠ¶æ€å’Œä¸Šä¸‹æ–‡ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆéœ€è¦ Orchestratorï¼Ÿå®ç°å•ä¸€å…¥å£ç‚¹ï¼Œç»Ÿä¸€ç®¡ç†å¤šæ™ºèƒ½ä½“åä½œã€‚åˆ†ç¦»æ„å›¾åˆ†ç±»ä¸å…·ä½“æ‰§è¡Œï¼Œå…è®¸åœ¨è§„åˆ’å‰è¿›è¡Œ Human-in-the-loop éªŒè¯ã€‚æ”¯æŒæµå¼è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚é˜²æ­¢å¤šä¸ªæ™ºèƒ½ä½“ç›´æ¥é€šä¿¡å¯¼è‡´çš„æ··ä¹±ï¼Œç¡®ä¿æ•°æ®æµçš„ä¸€è‡´æ€§ã€‚",
                    upstreamDownstream: "Upstream: User (æ¥æ”¶ç”¨æˆ·è¯·æ±‚) | Downstream: Planner (ä»»åŠ¡æ¨¡å¼) / LLM (èŠå¤©æ¨¡å¼) / Executor (æ‰§è¡Œæ¨¡å¼)",
                    llmLogic: "<strong>è§¦å‘ç‚¹:</strong> <code>_classify_global_intent()</code> â†’ <code>llm_client.achat(messages, temperature=0.1, max_tokens=50)</code><br><br><strong>Prompt ç­–ç•¥:</strong> Zero-shot Classificationã€‚System Prompt: \"ä½ æ˜¯ä¸€ä¸ªæ„å›¾åˆ†ç±»åŠ©æ‰‹ã€‚åªè¿”å›JSONæ ¼å¼çš„æ„å›¾ç±»å‹ã€‚\" User Prompt: åŒ…å«ç”¨æˆ·æŸ¥è¯¢å’Œåˆ†ç±»è§„åˆ™ï¼ˆèŠå¤© vs ä»»åŠ¡ï¼‰ã€‚<br><br><strong>ä¸Šä¸‹æ–‡çª—å£:</strong> UserQueryï¼ˆåŸå§‹æ–‡æœ¬ï¼‰+ å…³é”®è¯è§„åˆ™ï¼ˆtask_keywords: [\"åˆ†æ\", \"å¤„ç†\", \"è¿è¡Œ\", \"æ‰§è¡Œ\"]ï¼‰ã€‚å¦‚æœå…³é”®è¯åŒ¹é…åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™è°ƒç”¨ LLMã€‚<br><br><strong>è¾“å‡ºè§£æ:</strong> 1) ç§»é™¤ Markdown ä»£ç å—ï¼ˆ```jsonï¼‰ï¼Œ2) JSON.parse() æå– <code>{\"type\": \"chat\" | \"task\"}</code>ï¼Œ3) å¦‚æœè§£æå¤±è´¥ï¼Œæ£€æŸ¥å“åº”æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å« \"task\" å…³é”®è¯ä½œä¸ºåå¤‡æ–¹æ¡ˆã€‚",
                    academicBasis: "[1] H. Hong et al., \"MetaGPT: Meta Programming for A Multi-Agent Collaborative Framework,\" ICLR, 2024. (SOPs)<br>[2] P. Soare et al., \"Scalable Distributed Task Queues,\" IEEE Trans. Cloud Comput., 2023. (Celery/Async Architecture)"
                },
                planner: {
                    component: "é¦–å¸­ç§‘å­¦å®¶ (Lead Scientist / Planner)",
                    coreFunction: "core.planner.SOPPlanner.plan_workflow()",
                    dataIO: "Input: UserQuery + FileMetadata + ToolSchemas â†’ Output: JSON_Workflow: {workflow_name, steps: [{step_id, tool_id, name, params}]}",
                    technologyDescription: "ä½¿ç”¨ Chain-of-Thought (CoT) Prompting åˆ†è§£ç”Ÿç‰©é—®é¢˜ã€‚ç”± deepseek-R1ï¼ˆMoE æ¶æ„ï¼‰æä¾›æ¨ç†èƒ½åŠ›ã€‚å°†å·¥å…· Schema æ³¨å…¥åˆ° LLM æç¤ºè¯ä¸­ï¼Œä½¿ç”¨ JSON Schema éªŒè¯ LLM è¾“å‡ºï¼Œç¡®ä¿å·¥ä½œæµæ ¼å¼æ­£ç¡®ã€‚å®ç°å‚æ•°æ¨èç®—æ³•ï¼ŒåŸºäºæ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚æ ·æœ¬æ•°ã€ç‰¹å¾æ•°ï¼‰æ¨èæœ€ä½³å‚æ•°ã€‚ä½¿ç”¨ Few-shot Learning æä¾›ç¤ºä¾‹å·¥ä½œæµã€‚",
                    keyLogic: "ä½¿ç”¨ Chain-of-Thought (CoT) æ¨ç†æ‹†è§£ç§‘å­¦é—®é¢˜ã€‚å°†ç”¨æˆ·éœ€æ±‚åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„æ­¥éª¤åºåˆ—ã€‚æ¯ä¸ªæ­¥éª¤åŒ…å«å·¥å…·IDå’Œå‚æ•°é…ç½®ã€‚æ”¯æŒå‚æ•°æ¨èå’ŒåŠ¨æ€è°ƒæ•´ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆåˆ†ç¦» Planner å’Œ Executorï¼Ÿå…è®¸åœ¨æ˜‚è´µæ‰§è¡Œå‰è¿›è¡Œ Human-in-the-loop éªŒè¯ï¼Œé˜²æ­¢é”™è¯¯æ‰§è¡Œæµªè´¹è®¡ç®—èµ„æºã€‚æ”¯æŒå·¥ä½œæµçš„é¢„è§ˆã€ä¿®æ”¹å’Œä¼˜åŒ–ã€‚å®ç°è§„åˆ’ä¸æ‰§è¡Œçš„è§£è€¦ï¼Œæé«˜ç³»ç»Ÿçµæ´»æ€§ã€‚é€šè¿‡ Schema éªŒè¯é˜²æ­¢ LLM äº§ç”Ÿæ— æ•ˆå·¥ä½œæµï¼Œå‡å°‘æ‰§è¡Œé”™è¯¯ã€‚",
                    upstreamDownstream: "Upstream: Orchestrator (æ¥æ”¶ä»»åŠ¡æ„å›¾) + Retriever (è·å–å·¥å…· Schema) | Downstream: Executor (å‘é€å·¥ä½œæµé…ç½®) / Frontend (é¢„è§ˆæ¨¡å¼)",
                    llmLogic: "<strong>è§¦å‘ç‚¹:</strong> <code>generate_plan()</code> â†’ <code>_classify_intent()</code> â†’ <code>llm_client.achat(messages, temperature=0.1)</code><br><br><strong>Prompt ç­–ç•¥:</strong> Chain-of-Thought (CoT) + Few-shot Learningã€‚System Prompt æ³¨å…¥ï¼š1) é¢†åŸŸåˆ†ç±»è§„åˆ™ï¼ˆMetabolomics vs RNAï¼‰ï¼Œ2) å¯ç”¨æ­¥éª¤åˆ—è¡¨ï¼ˆä» WorkflowRegistry è·å–ï¼‰ï¼Œ3) æ¨¡å¼åˆ†ç±»è§„åˆ™ï¼ˆPLANNING vs EXECUTIONï¼‰ã€‚User Prompt åŒ…å«ï¼šUserQuery + FileMetadataï¼ˆæ˜¯å¦æœ‰æ–‡ä»¶ï¼‰+ ç›®æ ‡æ­¥éª¤åˆ—è¡¨ã€‚<br><br><strong>ä¸Šä¸‹æ–‡çª—å£:</strong> UserQuery + FileMetadataï¼ˆhas_file: boolï¼‰+ ToolSchemasï¼ˆä» Retriever è·å–çš„ top-k å·¥å…· JSON Schemaï¼‰+ WorkflowRegistry çš„ DAG ä¾èµ–å…³ç³»ï¼ˆä½œä¸º System Prompt çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚<br><br><strong>è¾“å‡ºè§£æ:</strong> 1) JSON.parse() æå– <code>{\"domain_name\": \"Metabolomics\" | \"RNA\", \"mode\": \"EXECUTION\" | \"PLANNING\", \"target_steps\": [...]}</code>ï¼Œ2) ä½¿ç”¨ Pydantic æ¨¡å‹éªŒè¯æ ¼å¼ï¼Œ3) å¦‚æœ target_steps ä¸ºç©ºæ•°ç»„ï¼Œåˆ™ä½¿ç”¨å®Œæ•´å·¥ä½œæµï¼ˆä» WorkflowRegistry è·å–æ‰€æœ‰æ­¥éª¤ï¼‰ã€‚",
                    academicBasis: "[3] DeepSeek-AI, \"deepseek-R1 Technical Report,\" arXiv, 2024.<br>[4] J. Wei et al., \"Chain-of-Thought Prompting Elicits Reasoning in LLMs,\" NeurIPS, 2022."
                },
                retriever: {
                    component: "å›¾ä¹¦é¦†å‘˜ (Librarian / Tool Retriever)",
                    coreFunction: "core.tool_retriever.ToolRetriever.query_tools()",
                    dataIO: "Input: UserQuery (è‡ªç„¶è¯­è¨€æè¿°) â†’ Output: List[ToolSchema] - å·¥å…· JSON Schema åˆ—è¡¨",
                    technologyDescription: "å®ç° RAGï¼ˆRetrieval-Augmented Generationï¼‰ç³»ç»Ÿã€‚ä½¿ç”¨ ChromaDB å­˜å‚¨å·¥å…· Schema çš„ embeddingï¼Œæ‰§è¡Œä½™å¼¦ç›¸ä¼¼åº¦æœç´¢ï¼ˆcosine similarity searchï¼‰åŒ¹é…ç”¨æˆ·æ„å›¾ä¸ 50+ ç”Ÿç‰©å·¥å…·ã€‚ä½¿ç”¨ OpenAI Embeddings æˆ– Ollama Embeddings å°†ç”¨æˆ·æŸ¥è¯¢å’Œå·¥å…·æè¿°è½¬æ¢ä¸ºå‘é‡ã€‚è¿”å› top-k æœ€ç›¸ä¼¼çš„å·¥å…·ï¼Œå·¥å…· Schema ä½¿ç”¨ JSON Schema æ ¼å¼ï¼ŒåŒ…å«å‚æ•°å®šä¹‰ã€ç±»å‹ã€æè¿°å’Œç¤ºä¾‹ã€‚",
                    keyLogic: "ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“è¿›è¡Œè¯­ä¹‰æ£€ç´¢ã€‚å°†ç”¨æˆ·æŸ¥è¯¢è½¬æ¢ä¸º embeddingï¼Œåœ¨å·¥å…·åº“ä¸­æŸ¥æ‰¾ç›¸ä¼¼åº¦æœ€é«˜çš„å·¥å…·ã€‚è¿”å›å·¥å…·çš„å®Œæ•´ Schemaï¼ˆå‚æ•°å®šä¹‰ã€æè¿°ã€ç¤ºä¾‹ï¼‰ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆä½¿ç”¨è¯­ä¹‰æ£€ç´¢è€Œéå…³é”®è¯åŒ¹é…ï¼Ÿæ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œç”¨æˆ·æ— éœ€äº†è§£å…·ä½“å·¥å…·åç§°ã€‚é€šè¿‡ embedding ç›¸ä¼¼åº¦åŒ¹é…ï¼Œæé«˜å·¥å…·æ¨èçš„å‡†ç¡®æ€§ã€‚æ”¯æŒå·¥å…·æè¿°çš„æ¨¡ç³ŠåŒ¹é…ï¼Œå³ä½¿å·¥å…·åç§°ä¸å®Œå…¨åŒ¹é…ä¹Ÿèƒ½æ‰¾åˆ°ç›¸å…³å·¥å…·ã€‚",
                    upstreamDownstream: "Upstream: Planner (æ¥æ”¶å·¥å…·æŸ¥è¯¢è¯·æ±‚) | Downstream: Planner (è¿”å›å·¥å…· Schema)",
                    llmLogic: "<strong>è§¦å‘ç‚¹:</strong> <code>query_tools()</code> â†’ <code>embedding_model.embed_query(query_text)</code><br><br><strong>API ç±»å‹:</strong> Embeddings APIï¼ˆé Chat APIï¼‰ã€‚ä½¿ç”¨ OpenAI Embeddings æˆ– Ollama Embeddings æ¨¡å‹ï¼ˆå¦‚ <code>nomic-embed-text</code>ï¼‰ã€‚<br><br><strong>è¾“å…¥:</strong> UserQueryï¼ˆè‡ªç„¶è¯­è¨€æ–‡æœ¬ï¼Œä¾‹å¦‚ \"åˆ†æå•ç»†èƒRNAæ•°æ®\"ï¼‰ã€‚<br><br><strong>è¾“å‡º:</strong> Vector Float Listï¼ˆä¾‹å¦‚ 768 ç»´æˆ– 1536 ç»´çš„æµ®ç‚¹æ•°æ•°ç»„ï¼‰ã€‚<br><br><strong>å¤„ç†æµç¨‹:</strong> 1) å°†æŸ¥è¯¢æ–‡æœ¬è½¬æ¢ä¸º embedding å‘é‡ï¼Œ2) åœ¨ ChromaDB ä¸­è®¡ç®—ä¸æ‰€æœ‰å·¥å…·æè¿°çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆcosine similarityï¼‰ï¼Œ3) è¿”å› top-kï¼ˆé»˜è®¤ k=10ï¼‰æœ€ç›¸ä¼¼çš„å·¥å…· Schemaã€‚æ³¨æ„ï¼šæ­¤æ¨¡å—ä¸ä½¿ç”¨ Chat APIï¼Œè€Œæ˜¯ä½¿ç”¨ Embeddings API è¿›è¡Œè¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—ã€‚",
                    academicBasis: "[5] Y. Qin et al., \"ToolLLM: Facilitating LLMs to Master 16000+ Real-world APIs,\" ICLR, 2024.<br>[6] J. Johnson et al., \"Billion-scale similarity search,\" IEEE Trans. Big Data, 2021. (Vector Search Theory)"
                },
                agent: {
                    component: "é¢†åŸŸä¸“å®¶ (Domain Agents)",
                    coreFunction: "agents.rna.RNAAgent.execute_workflow() / agents.metabolomics.MetabolomicsAgent.execute_workflow()",
                    dataIO: "Input: WorkflowConfig + FilePaths â†’ Output: AnalysisResults: {steps_details, steps_results, summary}",
                    technologyDescription: "æ¯ä¸ªé¢†åŸŸ Agent å°è£…ç‰¹å®šç»„å­¦é¢†åŸŸçš„ SOPï¼ˆStandard Operating Procedureï¼‰æ¨¡æ¿ã€‚ä½¿ç”¨ Python ç±»ç»§æ‰¿ BaseAgentï¼Œé‡å†™ execute_workflow æ–¹æ³•ã€‚é¢†åŸŸçŸ¥è¯†é€šè¿‡æç¤ºè¯æ¨¡æ¿å’Œå·¥å…·é€‰æ‹©ç­–ç•¥ä½“ç°ã€‚ä½¿ç”¨ LLM ç”Ÿæˆé¢†åŸŸç‰¹å®šçš„è¯Šæ–­æŠ¥å‘Šï¼ŒåŸºäºæ­¥éª¤ç»“æœæå–å…³é”®æŒ‡æ ‡ï¼ˆå¦‚ RNA-seq çš„ç»†èƒæ•°ã€åŸºå› æ•°ã€çº¿ç²’ä½“æ¯”ä¾‹ç­‰ï¼‰ã€‚",
                    keyLogic: "æ‹¥æœ‰ç‰¹å®šç»„å­¦é¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†ï¼ˆRNA-seq, Metabolomicsï¼‰ã€‚æ ¹æ®å·¥ä½œæµé…ç½®åˆ›å»º WorkflowExecutorï¼Œæ‰§è¡Œåˆ†ææ­¥éª¤ã€‚èšåˆæ­¥éª¤ç»“æœï¼Œç”Ÿæˆé¢†åŸŸç‰¹å®šçš„è¯Šæ–­æŠ¥å‘Šã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆéœ€è¦é¢†åŸŸç‰¹å®šçš„ Agentï¼Ÿä¸åŒç»„å­¦é¢†åŸŸæœ‰ä¸åŒçš„åˆ†ææµç¨‹å’Œä¸“ä¸šçŸ¥è¯†ã€‚é€šè¿‡é¢†åŸŸ Agent å°è£…é¢†åŸŸçŸ¥è¯†ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚æ”¯æŒé¢†åŸŸç‰¹å®šçš„é”™è¯¯å¤„ç†å’Œå‚æ•°æ¨èã€‚å…è®¸ç³»ç»Ÿæ‰©å±•æ–°çš„ç»„å­¦é¢†åŸŸï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒæ¶æ„ã€‚",
                    upstreamDownstream: "Upstream: Orchestrator (æ¥æ”¶å·¥ä½œæµé…ç½®) | Downstream: Executor (å§”æ‰˜æ‰§è¡Œ) + Output (è¿”å›åˆ†æç»“æœ)",
                    llmLogic: "<strong>è§¦å‘ç‚¹:</strong> <code>_detect_intent_with_llm()</code> â†’ <code>llm_client.achat(messages)</code> å’Œ <code>generate_diagnosis_report()</code> â†’ <code>llm_client.achat(messages)</code><br><br><strong>Prompt ç­–ç•¥:</strong> 1) æ„å›¾æ£€æµ‹ï¼šZero-shot Classificationï¼ŒSystem Prompt: \"You are an intent classification assistant. Return JSON only.\" 2) è¯Šæ–­æŠ¥å‘Šç”Ÿæˆï¼šFew-shot Learningï¼ŒSystem Prompt åŒ…å«é¢†åŸŸç‰¹å®šçš„è¯Šæ–­æ¨¡æ¿ï¼ˆä¾‹å¦‚ RNA-seq çš„ç»†èƒæ•°ã€åŸºå› æ•°ã€çº¿ç²’ä½“æ¯”ä¾‹ç­‰æŒ‡æ ‡æå–è§„åˆ™ï¼‰ã€‚<br><br><strong>ä¸Šä¸‹æ–‡çª—å£:</strong> 1) æ„å›¾æ£€æµ‹ï¼šUserQuery + UploadedFilesï¼ˆæ–‡ä»¶ååˆ—è¡¨ï¼‰ï¼Œ2) è¯Šæ–­æŠ¥å‘Šï¼šStepsResultsï¼ˆJSON æ ¼å¼çš„æ­¥éª¤æ‰§è¡Œç»“æœï¼‰+ é¢†åŸŸç‰¹å®šçš„æŒ‡æ ‡æå–è§„åˆ™ï¼ˆä½œä¸º System Prompt çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚<br><br><strong>è¾“å‡ºè§£æ:</strong> 1) æ„å›¾æ£€æµ‹ï¼šJSON.parse() æå– <code>{\"intent\": \"explain_file\" | \"run_workflow\" | \"chat\", \"reasoning\": \"...\"}</code>ï¼Œ2) è¯Šæ–­æŠ¥å‘Šï¼šMarkdown æ ¼å¼çš„æ–‡æœ¬ï¼ŒåŒ…å«å…³é”®æŒ‡æ ‡ï¼ˆç»†èƒæ•°ã€åŸºå› æ•°ç­‰ï¼‰å’Œè¯Šæ–­å»ºè®®ã€‚",
                    academicBasis: "[10] A. M. Bran et al., \"ChemCrow: Augmenting large language models with chemistry tools,\" Nature Machine Intelligence, vol. 6, pp. 525-535, 2024. [11] K. Zhou et al., \"GeneGPT: Augmenting Large Language Models with Domain Tools for Improved Access to Biomedical Information,\" arXiv:2404.09667, 2024. [12] H. Yang et al., \"scGPT: Towards Building a Foundation Model for Single-Cell Multi-omics Using Generative AI,\" bioRxiv, 2023."
                },
                executor: {
                    component: "æ‰§è¡Œå¼•æ“ (Executor)",
                    coreFunction: "core.executor.WorkflowExecutor.execute_step()",
                    dataIO: "Input: StepConfig: {step_id, tool_id, params} â†’ Output: StepResult: {status, logs, data, images}",
                    technologyDescription: "å®ç°æ²™ç®±åŒ–æ‰§è¡Œç¯å¢ƒã€‚é€šè¿‡ Python åå°„æœºåˆ¶ï¼ˆReflectionï¼Œä½¿ç”¨ getattr, importlibï¼‰åŠ¨æ€åŠ è½½å·¥å…·å‡½æ•°ã€‚ä½¿ç”¨ Pydantic æ¨¡å‹éªŒè¯æ­¥éª¤å‚æ•°ï¼Œç¡®ä¿ç±»å‹å’Œæ ¼å¼æ­£ç¡®ã€‚é›†æˆ Scanpy å’Œ DESeq2 è¿›è¡Œç»„å­¦æ•°æ®å¤„ç†ã€‚å·¥å…·æ‰§è¡Œå¯èƒ½æ¶‰åŠï¼š1) åŒæ­¥ Python å‡½æ•°è°ƒç”¨ï¼Œ2) Subprocess è°ƒç”¨å¤–éƒ¨ç¨‹åºï¼ˆå¦‚ Cell Rangerï¼‰ï¼Œ3) Celery å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—å¤„ç†è€—æ—¶æ“ä½œã€‚å¤„ç†æ­¥éª¤é—´æ•°æ®æµï¼šå‰ä¸€æ­¥çš„è¾“å‡ºæ–‡ä»¶è·¯å¾„ä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥å‚æ•°ã€‚",
                    keyLogic: "ä» ToolRegistry åŠ¨æ€æŸ¥æ‰¾å·¥å…·å‡½æ•°ã€‚ä½¿ç”¨ Pydantic éªŒè¯å‚æ•°ã€‚è°ƒç”¨å·¥å…·å‡½æ•°ï¼ˆå¯èƒ½æ¶‰åŠ Subprocess æˆ– Celery å¼‚æ­¥ä»»åŠ¡ï¼‰ã€‚å¤„ç†æ­¥éª¤é—´çš„æ•°æ®æµï¼ˆå‰ä¸€æ­¥è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥è¾“å…¥ï¼‰ã€‚æ”¶é›†æ‰§è¡Œç»“æœå’Œé”™è¯¯ä¿¡æ¯ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆåˆ†ç¦» Executor å’Œ Plannerï¼Ÿå…è®¸åœ¨è§„åˆ’åã€æ‰§è¡Œå‰è¿›è¡ŒéªŒè¯ï¼Œé˜²æ­¢æ— æ•ˆå‚æ•°å¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚æ”¯æŒé”™è¯¯æ¢å¤å’Œé‡è¯•æœºåˆ¶ï¼ˆExecutor â†’ Planner åé¦ˆå¾ªç¯ï¼‰ã€‚å®ç°æ‰§è¡Œé€»è¾‘çš„é€šç”¨åŒ–ï¼Œæ— éœ€ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™ç‰¹å®šä»£ç ã€‚é€šè¿‡å‚æ•°éªŒè¯å‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚",
                    upstreamDownstream: "Upstream: Agent (æ¥æ”¶å·¥ä½œæµé…ç½®) | Downstream: Tools (è°ƒç”¨å·¥å…·å‡½æ•°) / Planner (é”™è¯¯åé¦ˆå¾ªç¯) / Output (è¿”å›æ‰§è¡Œç»“æœ)",
                    llmLogic: "<strong>è§¦å‘ç‚¹:</strong> Executor æœ¬èº«ä¸ç›´æ¥è°ƒç”¨ LLM APIã€‚ä½†åœ¨é”™è¯¯æ¢å¤åœºæ™¯ä¸­ï¼Œé”™è¯¯ä¿¡æ¯ä¼šåé¦ˆç»™ Plannerï¼ŒPlanner ä½¿ç”¨ LLM ç”Ÿæˆä¿®æ­£åçš„å·¥ä½œæµã€‚<br><br><strong>é—´æ¥ LLM ä½¿ç”¨:</strong> å½“æ‰§è¡Œå¤±è´¥æ—¶ï¼ŒExecutor è¿”å› ErrorResultï¼ŒOrchestrator è§¦å‘é‡è§„åˆ’æµç¨‹ï¼ŒPlanner ä½¿ç”¨ LLM åˆ†æé”™è¯¯åŸå› å¹¶ç”Ÿæˆä¿®æ­£åçš„å·¥ä½œæµï¼ˆå‚è§ Planner çš„ llmLogicï¼‰ã€‚<br><br><strong>ä»£ç ç”Ÿæˆåœºæ™¯ï¼ˆæœªæ¥æ‰©å±•ï¼‰:</strong> å¦‚æœå·¥å…·éœ€è¦åŠ¨æ€ä»£ç ç”Ÿæˆï¼ŒExecutor å¯èƒ½è°ƒç”¨ LLM ç”Ÿæˆ Python ä»£ç å—ã€‚è¾“å…¥ï¼šStep description + Dataframe .head()ï¼ˆæ•°æ®é¢„è§ˆï¼‰ï¼Œè¾“å‡ºï¼šPython Code blockï¼ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå– ```python ä»£ç å—ï¼‰ã€‚",
                    academicBasis: "[7] F. A. Wolf et al., \"SCANPY: large-scale single-cell gene expression data analysis,\" Genome Biology, 2018.<br>[8] H. Li et al., \"SheetCopilot: Bringing Software Productivity to the Next Level,\" NeurIPS, 2023."
                },
                llm: {
                    component: "å¤§è¯­è¨€æ¨¡å‹æœåŠ¡ (LLM Service)",
                    coreFunction: "llm_client.achat() / llm_client.astream()",
                    dataIO: "Input: List[Message] + temperature, max_tokens â†’ Output: JSON / Stream",
                    technologyDescription: "deepseek-R1 (MoE æ¶æ„) æä¾›æ¨ç†èƒ½åŠ›ã€‚Orchestrator ç”¨äºæ„å›¾åˆ†ç±»ï¼›Planner ç”¨äºå·¥ä½œæµè§„åˆ’ä¸é”™è¯¯ä¿®æ­£ï¼›Agent ç”¨äºè¯Šæ–­æŠ¥å‘Šç”Ÿæˆã€‚é€šè¿‡ç»Ÿä¸€ LLM Client å°è£… API è°ƒç”¨ã€‚",
                    keyLogic: "æ„å›¾åˆ†ç±» (Zero-shot)ã€å·¥ä½œæµè§„åˆ’ (CoT + Few-shot)ã€é”™è¯¯åˆ†æã€è¯Šæ–­æŠ¥å‘Šç”Ÿæˆã€‚",
                    designRationale: "LLM æ˜¯ç³»ç»Ÿçš„æ¨ç†å¼•æ“ï¼Œä½†ä½œä¸ºå¤–éƒ¨æœåŠ¡ä¸å‚ä¸æ•°æ®æµä¸»è·¯å¾„ï¼Œæ•…ä»¥è™šçº¿è¿æ¥è¡¨ç¤ºã€Œè°ƒç”¨å…³ç³»ã€ã€‚",
                    upstreamDownstream: "Upstream: Orchestrator (æ„å›¾åˆ†ç±») | Planner (è§„åˆ’/ä¿®æ­£) | Agent (è¯Šæ–­) | Downstream: å„æ¨¡å—æ¥æ”¶ LLM å“åº”",
                    llmLogic: "æœ¬æ¨¡å—å³ä¸º LLM æœåŠ¡æœ¬èº«ã€‚è¢« Orchestratorã€Plannerã€Agent è°ƒç”¨ã€‚",
                    academicBasis: "deepseek-R1 Technical Report, arXiv 2024."
                },
                output: {
                    component: "åˆ†æç»“æœ (Analysis Results)",
                    coreFunction: "SSE Streaming + Frontend Rendering",
                    dataIO: "Input: AnalysisResults + AI Report â†’ Output: Rendered UI: Workflow Cards + Step Results + AI Diagnosis",
                    technologyDescription: "ä½¿ç”¨ Server-Sent Events (SSE) å®ç°å®æ—¶æ¸²æŸ“ã€‚åç«¯ä½¿ç”¨ FastAPI StreamingResponseï¼Œé€šè¿‡ async generator é€æ¡å‘é€ JSON æ ¼å¼çš„äº‹ä»¶ã€‚é€šè¿‡ NGINX åå‘ä»£ç†ï¼ˆreverse proxyï¼‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æä¾›è´Ÿè½½å‡è¡¡ï¼ˆload balancingï¼‰ã€‚å‰ç«¯ä½¿ç”¨ EventSource API æˆ– fetch API çš„ ReadableStream è§£æ SSE æµã€‚å‰ç«¯å®ç°çŠ¶æ€æœºè§£æä¸åŒäº‹ä»¶ç±»å‹ï¼ˆstatus, workflow, step_result, diagnosisï¼‰ï¼Œå®æ—¶æ›´æ–° DOMã€‚ä½¿ç”¨ Marked.js æˆ– marked åº“æ¸²æŸ“ Markdown æ ¼å¼çš„ AI æŠ¥å‘Šã€‚",
                    keyLogic: "é€šè¿‡ Server-Sent Events (SSE) å®æ—¶æ¨é€åˆ†æè¿›åº¦ã€‚å‰ç«¯è§£æ SSE äº‹ä»¶æµï¼Œå®æ—¶æ¸²æŸ“å·¥ä½œæµå¡ç‰‡ã€æ­¥éª¤ç»“æœã€å›¾è¡¨å’Œ AI è¯Šæ–­æŠ¥å‘Šã€‚æ”¯æŒæµå¼æ–‡æœ¬è¾“å‡ºå’Œå¢é‡æ›´æ–°ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆä½¿ç”¨ SSE è€Œéè½®è¯¢ï¼Ÿå®æ—¶æ¨é€ï¼Œé™ä½å»¶è¿Ÿã€‚å•å‘é€šä¿¡ï¼Œç®€åŒ–å®ç°ã€‚æ”¯æŒæµå¼è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚ç›¸æ¯” WebSocketï¼ŒSSE æ›´ç®€å•ï¼Œæ— éœ€åŒå‘é€šä¿¡ã€‚ä½¿ç”¨ NGINX åå‘ä»£ç†æä¾›ç”Ÿäº§çº§è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚",
                    upstreamDownstream: "Upstream: Executor (æ¥æ”¶æ‰§è¡Œç»“æœ) + Agent (æ¥æ”¶åˆ†ææŠ¥å‘Š) | Downstream: User (æœ€ç»ˆå±•ç¤º)",
                    llmLogic: "N/A - Output Layerï¼ˆä¸ç›´æ¥è°ƒç”¨ LLM APIï¼Œä»…æ¸²æŸ“ LLM ç”Ÿæˆçš„è¯Šæ–­æŠ¥å‘Šï¼‰",
                    academicBasis: "[9] W. Tarneberg et al., \"Dynamic Application-Aware Load Balancing for NGINX,\" IEEE Access, 2021."
                }
            };
            
            // Synapse Inspector æ•°æ®è§„æ ¼ï¼ˆå« human_desc, function_sig, payload_preview, param_mappingï¼‰
            const dataFlowSpecs = {
                'user-orch': {
                    source: 'User', target: 'Orchestrator', sourceZh: 'ç”¨æˆ·', targetZh: 'ç¼–æ’å™¨',
                    human_desc: 'The user sends their message and uploaded files to the Orchestrator via the chat API.',
                    function_sig: 'POST /api/chat(request: ChatRequest) -> StreamingResponse',
                    payload_preview: '{"message":"Analyze this","uploaded_files":[{"name":"example.h5ad","path":"..."}],"stream":true}',
                    param_mapping: {
                        'message': 'Natural language query from the user (e.g., "Analyze this data")',
                        'uploaded_files': 'List of file references with name and server path after upload',
                        'stream': 'When true, enables SSE streaming for real-time updates',
                        'user_id': 'Identifies the user session for multi-tenant isolation',
                        'session_id': 'Correlates requests within a single conversation'
                    }
                },
                'orch-planner': {
                    source: 'Orchestrator', target: 'Planner', sourceZh: 'ç¼–æ’å™¨', targetZh: 'è§„åˆ’å™¨',
                    human_desc: 'The Orchestrator forwards the classified task intent and conversation history to the Planner.',
                    function_sig: 'planner.plan_workflow(query: str, history: List[Message], file_metadata: FileMetadata) -> WorkflowSchema',
                    payload_preview: '{"query":"åˆ†æRNAæ•°æ®","history":[...],"file_metadata":{"has_file":true,"file_type":"h5ad"}}',
                    param_mapping: {
                        'query': 'User\'s original natural language request',
                        'history': 'Previous messages in the conversation for context',
                        'file_metadata': 'Metadata about uploaded files (type, sample count) for planning'
                    }
                },
                'planner-retriever': {
                    source: 'Planner', target: 'Retriever', sourceZh: 'è§„åˆ’å™¨', targetZh: 'æ£€ç´¢å™¨',
                    human_desc: 'The Planner asks the Retriever for relevant tools based on the user\'s query.',
                    function_sig: 'retriever.query_tools(text: str, top_k: int = 5) -> List[ToolDef]',
                    payload_preview: '{"query":"åˆ†æRNA-seqæ•°æ®","top_k":5}',
                    param_mapping: {
                        'text': 'Natural language description of the task for semantic search',
                        'top_k': 'Retrieves top 5 most relevant tools by embedding similarity',
                        'threshold': 'Filters out low-confidence matches (optional)'
                    }
                },
                'retriever-planner': {
                    source: 'Retriever', target: 'Planner', sourceZh: 'æ£€ç´¢å™¨', targetZh: 'è§„åˆ’å™¨',
                    human_desc: 'The Retriever returns the tool schemas so the Planner can build a valid workflow.',
                    function_sig: 'List[ToolDef] (return value)',
                    payload_preview: '[{"tool_id":"rna_qc","params":{...},"description":"..."}]',
                    param_mapping: {
                        'tool_id': 'Unique identifier for the tool in the registry',
                        'params': 'JSON Schema of expected parameters',
                        'description': 'Human-readable tool description for LLM context'
                    }
                },
                'planner-output': {
                    source: 'Planner', target: 'Output', sourceZh: 'è§„åˆ’å™¨', targetZh: 'è¾“å‡º',
                    human_desc: 'The Planner sends the generated workflow to the frontend for user confirmation.',
                    function_sig: 'SSE event: workflow',
                    payload_preview: '{"type":"workflow","workflow_config":{"workflow_name":"RNA-seq","steps":[...]}}',
                    param_mapping: {
                        'workflow_name': 'Human-readable pipeline name',
                        'steps': 'Ordered list of step configs (step_id, tool_id, params)'
                    }
                },
                'orch-executor': {
                    source: 'Orchestrator', target: 'Executor', sourceZh: 'ç¼–æ’å™¨', targetZh: 'æ‰§è¡Œå™¨',
                    human_desc: 'The Orchestrator routes the approved workflow to the Executor (via Agent).',
                    function_sig: 'agent.execute_workflow(workflow_config: WorkflowSchema, file_paths: List[str])',
                    payload_preview: '{"workflow_config":{...},"file_paths":["/data/xxx.h5ad"]}',
                    param_mapping: {
                        'workflow_config': 'Validated workflow with steps and parameters',
                        'file_paths': 'Server paths to user-uploaded data files'
                    }
                },
                'orch-agent': {
                    source: 'Orchestrator', target: 'Agent', sourceZh: 'ç¼–æ’å™¨', targetZh: 'é¢†åŸŸæ™ºèƒ½ä½“',
                    human_desc: 'The Orchestrator delegates to a domain-specific Agent (RNA, Metabolomics).',
                    function_sig: 'agent.execute_workflow(workflow_config: WorkflowSchema, file_paths: List[str]) -> AnalysisResult',
                    payload_preview: '{"workflow_config":{...},"file_paths":["/data/session_xxx/sample.h5ad"]}',
                    param_mapping: {
                        'workflow_config': 'Complete workflow schema with steps',
                        'file_paths': 'Paths to uploaded files for analysis'
                    }
                },
                'agent-executor': {
                    source: 'Agent', target: 'Executor', sourceZh: 'é¢†åŸŸæ™ºèƒ½ä½“', targetZh: 'æ‰§è¡Œå™¨',
                    human_desc: 'The Agent passes each step to the Executor for tool invocation.',
                    function_sig: 'executor.execute_step(step: StepConfig) -> StepResult',
                    payload_preview: '{"step_id":"rna_qc","tool_id":"rna_qc","params":{"min_genes":200}}',
                    param_mapping: {
                        'step_id': 'Unique ID for this step in the workflow',
                        'tool_id': 'Registry key to look up the tool function',
                        'params': 'Validated parameters for the tool call'
                    }
                },
                'executor-tools': {
                    source: 'Executor', target: 'Tools', sourceZh: 'æ‰§è¡Œå™¨', targetZh: 'å·¥å…·åº“',
                    human_desc: 'The Executor invokes the actual tool function with the validated parameters.',
                    function_sig: 'tool_fn(**params) -> ResultObject',
                    payload_preview: '{"file_path":"/data/xxx.h5ad","min_genes":200}',
                    param_mapping: {
                        'file_path': 'Path to input data file (e.g., H5AD)',
                        'min_genes': 'Minimum genes per cell to retain (QC filter)',
                        'min_cells': 'Minimum cells per gene to retain'
                    }
                },
                'executor-output': {
                    source: 'Executor', target: 'Output', sourceZh: 'æ‰§è¡Œå™¨', targetZh: 'è¾“å‡º',
                    human_desc: 'The Executor streams each step result to the frontend via SSE.',
                    function_sig: 'SSE event: step_result',
                    payload_preview: '{"type":"step_result","report_data":{"step_id":"rna_qc","status":"success","data":{...}}}',
                    param_mapping: {
                        'step_id': 'Identifies which step produced this result',
                        'status': 'success | error',
                        'data': 'Step output (logs, images, summary)'
                    }
                },
                'executor-planner': {
                    source: 'Executor', target: 'Planner', sourceZh: 'æ‰§è¡Œå™¨', targetZh: 'è§„åˆ’å™¨',
                    human_desc: 'When execution fails, the Executor sends the error context back to the Planner for correction.',
                    function_sig: 'ReplanRequest(error_context: ErrorContext, original_plan: WorkflowSchema)',
                    payload_preview: '{"error_type":"ParameterError","message":"...","original_plan":{...}}',
                    param_mapping: {
                        'error_type': 'Exception class (e.g., ParameterError, FileNotFoundError)',
                        'message': 'Human-readable error description',
                        'original_plan': 'The workflow that failed, for LLM to analyze'
                    }
                },
                'planner-executor': {
                    source: 'Planner', target: 'Executor', sourceZh: 'è§„åˆ’å™¨', targetZh: 'æ‰§è¡Œå™¨',
                    human_desc: 'The Planner sends the corrected workflow back to the Executor for retry.',
                    function_sig: 'Revised WorkflowSchema',
                    payload_preview: '{"workflow_name":"RNA-seq","steps":[{"step_id":"rna_qc","params":{"min_genes":300}}]}',
                    param_mapping: {
                        'corrected_params': 'LLM-generated parameter fixes based on error analysis'
                    }
                },
                'orch-output': {
                    source: 'Orchestrator', target: 'Output', sourceZh: 'ç¼–æ’å™¨', targetZh: 'è¾“å‡º',
                    human_desc: 'In chat mode, the Orchestrator streams the LLM response directly to the user.',
                    function_sig: 'llm.astream(messages) -> AsyncIterator[ChatChunk]',
                    payload_preview: '{"type":"chat","content":"å•ç»†èƒRNAæµ‹åºæ˜¯ä¸€ç§..."}',
                    param_mapping: {
                        'type': 'Event type: "chat" for direct LLM output',
                        'content': 'Streamed text chunk from the LLM'
                    }
                }
            };
            
            // Code Pop-up Modalï¼šç‚¹å‡»è¿æ¥çº¿æ˜¾ç¤ºä¼ªä»£ç ï¼Œå†æ¬¡ç‚¹å‡»å…³é—­
            function showCodeModal(connectionId) {
                const spec = dataFlowSpecs[connectionId];
                if (!spec) return;
                const modal = document.getElementById('code-modal');
                const content = document.getElementById('code-modal-content');
                if (!modal || !content) return;
                let text = `# ${spec.sourceZh} â†’ ${spec.targetZh}\n\n`;
                text += `// ${spec.human_desc || ''}\n\n`;
                text += `${spec.function_sig || ''}\n\n`;
                text += `// Payload Preview\n`;
                text += spec.payload_preview || '';
                content.textContent = text;
                modal.classList.add('active');
            }
            
            function closeCodeModal() {
                const modal = document.getElementById('code-modal');
                if (modal) modal.classList.remove('active');
            }
            
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('code-modal');
                if (modal && modal.classList.contains('active') && !modal.contains(e.target)) {
                    closeCodeModal();
                }
            });
            
            // Synapse Inspectorï¼šç‚¹å‡»è¿æ¥çº¿æ—¶æ˜¾ç¤ºç»“æ„åŒ–è§£å‰–ï¼ˆä¾§è¾¹æ ï¼Œä¿ç•™ä¾›å…¶ä»–å…¥å£ä½¿ç”¨ï¼‰
            function showDataFlow(connectionId) {
                const spec = dataFlowSpecs[connectionId];
                if (!spec) return;
                
                const defaultState = document.getElementById('default-state');
                const detailContent = document.getElementById('detail-content');
                
                defaultState.style.display = 'none';
                detailContent.classList.add('active');
                
                let paramRows = '';
                if (spec.param_mapping) {
                    for (const [key, meaning] of Object.entries(spec.param_mapping)) {
                        paramRows += `<tr><td><code>${key}</code></td><td>${meaning}</td></tr>`;
                    }
                }
                
                detailContent.innerHTML = `
                    <div class="detail-item" style="margin-bottom: 20px;">
                        <div class="detail-item-label">ğŸ”¬ Synapse Inspector</div>
                        <div class="detail-item-value" style="font-size: 15px; font-weight: 600;">
                            ${spec.sourceZh} (${spec.source}) â†’ ${spec.targetZh} (${spec.target})
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Human Description</div>
                        <div class="detail-item-value">${spec.human_desc || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Function Signature</div>
                        <div class="detail-item-value"><code>${spec.function_sig || '-'}</code></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Payload Preview</div>
                        <div class="detail-item-value typewriter-code" id="typewriter-block"><span class="cursor"></span></div>
                    </div>
                    ${paramRows ? `
                    <div class="detail-item">
                        <div class="detail-item-label">Parameter Mapping (å‚æ•°å«ä¹‰)</div>
                        <div class="detail-item-value">
                            <table class="param-mapping-table">
                                <thead><tr><th>Parameter</th><th>Meaning</th></tr></thead>
                                <tbody>${paramRows}</tbody>
                            </table>
                        </div>
                    </div>
                    ` : ''}
                `;
                
                typewriterEffect(document.getElementById('typewriter-block'), spec.payload_preview || '', 18);
            }
            
            function escapeHtml(s) {
                const div = document.createElement('div');
                div.textContent = s;
                return div.innerHTML;
            }
            
            function typewriterEffect(container, text, speed) {
                if (!container) return;
                container.innerHTML = '';
                let i = 0;
                const cursor = document.createElement('span');
                cursor.className = 'cursor';
                container.appendChild(cursor);
                const interval = setInterval(() => {
                    if (i < text.length) {
                        const span = document.createElement('span');
                        span.textContent = text[i];
                        container.insertBefore(span, cursor);
                        i++;
                    } else {
                        clearInterval(interval);
                    }
                }, speed);
            }
            
            // æ˜¾ç¤ºæ¨¡å—è¯¦æƒ…
            // åœºæ™¯æ•°æ®æµå¯¹è±¡ï¼ˆç«¯åˆ°ç«¯æ•°æ®è¿½è¸ªï¼‰
            const scenarioDataFlows = {
                planning: {
                    title: "è§„åˆ’æµç¨‹æ•°æ®è¿½è¸ª (Planning Flow Data Trace)",
                    steps: [
                        {
                            step: 1,
                            module: "ç”¨æˆ· (User)",
                            input: "è‡ªç„¶è¯­è¨€æŸ¥è¯¢: \"å¸®æˆ‘åˆ†æè¿™ä¸ªæ•°æ®\"",
                            process: "ç”¨æˆ·åœ¨å‰ç«¯ç•Œé¢è¾“å…¥æŸ¥è¯¢æ–‡æœ¬",
                            output: "HTTP POST è¯·æ±‚: {message: \"å¸®æˆ‘åˆ†æè¿™ä¸ªæ•°æ®\", uploaded_files: [...]}",
                            dataType: "Raw Text â†’ HTTP Request"
                        },
                        {
                            step: 2,
                            module: "æ€»æ§ç¼–æ’ (Orchestrator)",
                            input: "UserQuery + ConversationHistory",
                            process: "è°ƒç”¨å…³é”®è¯è§„åˆ™æ£€æŸ¥ï¼ˆtask_keywordsï¼‰",
                            output: "Rule Check Result: å¦‚æœåŒ¹é…å…³é”®è¯åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™è¿›å…¥ LLM åˆ†ç±»",
                            dataType: "Query â†’ Rule Check"
                        },
                        {
                            step: 3,
                            module: "ğŸ¤– LLM API (Intent Classification)",
                            input: "UserQuery + System Prompt: \"ä½ æ˜¯ä¸€ä¸ªæ„å›¾åˆ†ç±»åŠ©æ‰‹ã€‚åªè¿”å›JSONæ ¼å¼çš„æ„å›¾ç±»å‹ã€‚\"",
                            process: "llm_client.achat(messages, temperature=0.1, max_tokens=50)",
                            output: "LLM Response: {\"type\": \"task\"} (JSON æ ¼å¼)",
                            dataType: "Natural Language â†’ LLM API â†’ JSON Response"
                        },
                        {
                            step: 4,
                            module: "æ€»æ§ç¼–æ’ (Orchestrator)",
                            input: "LLM JSON Response",
                            process: "è§£æ JSONï¼Œæå– intent ç±»å‹ï¼Œç§»é™¤ Markdown ä»£ç å—",
                            output: "Task Object: {intent: 'task', domain: 'rna', requires_planning: true}",
                            dataType: "LLM Response â†’ Structured Intent"
                        },
                        {
                            step: 5,
                            module: "é¦–å¸­ç§‘å­¦å®¶ (Planner)",
                            input: "Task Object + FileMetadata",
                            process: "å‡†å¤‡ LLM è°ƒç”¨ä¸Šä¸‹æ–‡ï¼ˆéœ€è¦å·¥å…· Schemaï¼‰",
                            output: "Planning Context: {user_query, file_metadata, needs_tools: true}",
                            dataType: "Intent â†’ Planning Context"
                        },
                        {
                            step: 6,
                            module: "å›¾ä¹¦é¦†å‘˜ (Retriever)",
                            input: "UserQuery: \"åˆ†æRNAæ•°æ®\"",
                            process: "Embeddings API: embedding_model.embed_query(query_text)",
                            output: "Query Vector: [0.123, -0.456, ...] (768 ç»´æµ®ç‚¹æ•°æ•°ç»„)",
                            dataType: "Natural Language â†’ Embedding Vector"
                        },
                        {
                            step: 7,
                            module: "å›¾ä¹¦é¦†å‘˜ (Retriever)",
                            input: "Query Vector + ChromaDB Tool Embeddings",
                            process: "ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢ï¼ˆcosine similarityï¼‰ï¼Œè¿”å› top-k å·¥å…·",
                            output: "Tool Schemas: [{tool_id: \"rna_cellranger_count\", params: {...}}, ...]",
                            dataType: "Vector Similarity â†’ Tool Schemas"
                        },
                        {
                            step: 8,
                            module: "ğŸ¤– LLM API (Workflow Generation)",
                            input: "UserQuery + ToolSchemas + System Prompt (CoT + Few-shot)",
                            process: "llm_client.achat(messages, temperature=0.1) - Chain-of-Thought æ¨ç†",
                            output: "LLM Response: {\"domain_name\": \"RNA\", \"mode\": \"PLANNING\", \"target_steps\": [...]}",
                            dataType: "Context + Schemas â†’ LLM API â†’ JSON Plan"
                        },
                        {
                            step: 9,
                            module: "é¦–å¸­ç§‘å­¦å®¶ (Planner)",
                            input: "LLM JSON Response + WorkflowRegistry DAG",
                            process: "è§£æ JSONï¼Œä½¿ç”¨ Pydantic éªŒè¯ï¼Œå¡«å……å®Œæ•´å·¥ä½œæµå‚æ•°",
                            output: "JSON Workflow: {workflow_name, steps: [{step_id, tool_id, name, params}]}",
                            dataType: "LLM Response + DAG â†’ Complete Workflow"
                        },
                        {
                            step: 10,
                            module: "å‰ç«¯æ¸²æŸ“ (Frontend)",
                            input: "JSON Workflow (via SSE)",
                            process: "æ¸²æŸ“å·¥ä½œæµå¡ç‰‡ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤",
                            output: "Rendered UI: Interactive Workflow Card",
                            dataType: "JSON â†’ UI Component"
                        }
                    ]
                },
                execution: {
                    title: "æ‰§è¡Œæµç¨‹æ•°æ®è¿½è¸ª (Execution Flow Data Trace)",
                    steps: [
                        {
                            step: 1,
                            module: "ç”¨æˆ· (User)",
                            input: "ç”¨æˆ·ç‚¹å‡»\"æ‰§è¡Œ\"æŒ‰é’®",
                            process: "å‰ç«¯æ”¶é›†å·¥ä½œæµé…ç½®å’Œæ–‡ä»¶è·¯å¾„",
                            output: "Execution Request: {workflow_data: {...}, file_paths: [...]}",
                            dataType: "User Action â†’ Execution Request"
                        },
                        {
                            step: 2,
                            module: "æ€»æ§ç¼–æ’ (Orchestrator)",
                            input: "Execution Request",
                            process: "è·¯ç”±åˆ°å¯¹åº”çš„é¢†åŸŸ Agentï¼ˆåŸºäº workflow domain_nameï¼‰",
                            output: "Agent Selection: RNAAgent / MetabolomicsAgent",
                            dataType: "Request â†’ Agent Instance"
                        },
                        {
                            step: 2.5,
                            module: "ğŸ¤– LLM API (Agent Intent Detection)",
                            input: "UserQuery + UploadedFiles + System Prompt (Intent Classification)",
                            process: "agent._detect_intent_with_llm() â†’ llm_client.achat(messages)",
                            output: "LLM Response: {\"intent\": \"run_workflow\", \"reasoning\": \"...\"}",
                            dataType: "Query + Files â†’ LLM API â†’ Intent JSON"
                        },
                        {
                            step: 3,
                            module: "æ‰§è¡Œå¼•æ“ (Executor)",
                            input: "WorkflowConfig: {steps: [{step_id, tool_id, params}]}",
                            process: "ä» ToolRegistry æŸ¥æ‰¾å·¥å…·ï¼ŒéªŒè¯å‚æ•°ï¼Œè°ƒç”¨å·¥å…·å‡½æ•°",
                            output: "Step Result: {status: 'success', logs: '...', data: {...}, images: [...]}",
                            dataType: "Workflow Config â†’ Execution Result"
                        },
                        {
                            step: 4,
                            module: "å·¥å…·å±‚ (Tools)",
                            input: "Tool Call: {tool_id: \"rna_cellranger_count\", params: {...}}",
                            process: "æ‰§è¡Œ Cell Ranger å‘½ä»¤ï¼Œç”Ÿæˆ H5AD æ–‡ä»¶",
                            output: "Tool Output: {output_file: \"/results/.../count.h5ad\", logs: \"...\"}",
                            dataType: "Tool Config â†’ Analysis Output"
                        },
                        {
                            step: 5,
                            module: "æ‰§è¡Œå¼•æ“ (Executor)",
                            input: "Tool Output (ä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥)",
                            process: "å¤„ç†æ•°æ®æµï¼Œå°†å‰ä¸€æ­¥è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥è¾“å…¥",
                            output: "Aggregated Results: {steps_details: [...], steps_results: [...]}",
                            dataType: "Tool Outputs â†’ Aggregated Results"
                        },
                        {
                            step: 6,
                            module: "åˆ†æç»“æœ (Output)",
                            input: "Aggregated Results + AI Report",
                            process: "SSE æµå¼æ¨é€ï¼Œå‰ç«¯å®æ—¶æ¸²æŸ“",
                            output: "Rendered UI: Workflow Cards + Step Results + AI Diagnosis",
                            dataType: "Results â†’ Rendered UI"
                        }
                    ]
                },
                error: {
                    title: "é”™è¯¯å¾ªç¯æ•°æ®è¿½è¸ª (Error Loop Data Trace)",
                    steps: [
                        {
                            step: 1,
                            module: "æ‰§è¡Œå¼•æ“ (Executor)",
                            input: "StepConfig: {tool_id: \"rna_qc\", params: {...}}",
                            process: "æ‰§è¡Œå·¥å…·ï¼Œæ£€æµ‹åˆ°é”™è¯¯",
                            output: "Error Result: {status: 'error', error_type: 'ParameterError', message: '...'}",
                            dataType: "Step Config â†’ Error"
                        },
                        {
                            step: 2,
                            module: "æ€»æ§ç¼–æ’ (Orchestrator)",
                            input: "Error Result",
                            process: "æ£€æµ‹é”™è¯¯ï¼Œè§¦å‘é‡è§„åˆ’æµç¨‹",
                            output: "Replan Request: {error_context: {...}, original_plan: {...}}",
                            dataType: "Error â†’ Replan Request"
                        },
                        {
                            step: 3,
                            module: "ğŸ¤– LLM API (Error Analysis & Replanning)",
                            input: "Error Context + Original Plan + System Prompt (Error Recovery)",
                            process: "planner.generate_plan() â†’ llm_client.achat(messages) - åˆ†æé”™è¯¯å¹¶ç”Ÿæˆä¿®æ­£æ–¹æ¡ˆ",
                            output: "LLM Response: {\"domain_name\": \"RNA\", \"mode\": \"EXECUTION\", \"target_steps\": [...], \"corrected_params\": {...}}",
                            dataType: "Error Context â†’ LLM API â†’ Revised Plan JSON"
                        },
                        {
                            step: 4,
                            module: "é¦–å¸­ç§‘å­¦å®¶ (Planner)",
                            input: "LLM Revised Plan JSON",
                            process: "è§£æ JSONï¼Œä½¿ç”¨ Pydantic éªŒè¯ï¼Œåº”ç”¨ä¿®æ­£åçš„å‚æ•°",
                            output: "Revised Workflow: {workflow_name, steps: [{...corrected_params...}]}",
                            dataType: "LLM Response â†’ Validated Revised Plan"
                        },
                        {
                            step: 5,
                            module: "æ‰§è¡Œå¼•æ“ (Executor)",
                            input: "Revised Workflow",
                            process: "ä½¿ç”¨ä¿®æ­£åçš„å‚æ•°é‡æ–°æ‰§è¡Œ",
                            output: "Success Result: {status: 'success', ...}",
                            dataType: "Revised Plan â†’ Success"
                        }
                    ]
                },
                chat: {
                    title: "ç›´æ¥èŠå¤©æ•°æ®è¿½è¸ª (Direct Chat Data Trace)",
                    steps: [
                        {
                            step: 1,
                            module: "ç”¨æˆ· (User)",
                            input: "è‡ªç„¶è¯­è¨€æŸ¥è¯¢: \"ä»€ä¹ˆæ˜¯å•ç»†èƒRNAæµ‹åºï¼Ÿ\"",
                            process: "ç”¨æˆ·è¾“å…¥ä¸€èˆ¬æ€§é—®é¢˜",
                            output: "HTTP POST è¯·æ±‚: {message: \"ä»€ä¹ˆæ˜¯å•ç»†èƒRNAæµ‹åºï¼Ÿ\"}",
                            dataType: "Natural Language â†’ HTTP Request"
                        },
                        {
                            step: 2,
                            module: "æ€»æ§ç¼–æ’ (Orchestrator)",
                            input: "UserQuery",
                            process: "è°ƒç”¨å…³é”®è¯è§„åˆ™æ£€æŸ¥ï¼Œå¦‚æœåŒ¹é… task_keywords åˆ™è¿›å…¥ä»»åŠ¡æ¨¡å¼ï¼Œå¦åˆ™è¿›å…¥èŠå¤©æ¨¡å¼",
                            output: "Intent Check: {intent: 'chat', skip_planning: true}",
                            dataType: "Query â†’ Intent Check"
                        },
                        {
                            step: 3,
                            module: "ğŸ¤– LLM API (Chat Response)",
                            input: "Chat Query + System Prompt: \"You are a helpful bioinformatics assistant.\"",
                            process: "agent.chat() â†’ llm_client.astream(messages) - æµå¼ç”Ÿæˆå›ç­”",
                            output: "LLM Stream: \"å•ç»†èƒRNAæµ‹åºæ˜¯ä¸€ç§...\" (é€å—æµå¼è¾“å‡º)",
                            dataType: "Query â†’ LLM API Stream â†’ Text Response"
                        },
                        {
                            step: 4,
                            module: "åˆ†æç»“æœ (Output)",
                            input: "LLM Response (via SSE)",
                            process: "å‰ç«¯å®æ—¶æ¸²æŸ“æµå¼æ–‡æœ¬",
                            output: "Rendered UI: Chat Message with Markdown",
                            dataType: "LLM Response â†’ Rendered Text"
                        }
                    ]
                }
            };
            
            // æ˜¾ç¤ºåœºæ™¯æ•°æ®æµ
            function showScenarioFlow(scenarioId) {
                const flow = scenarioDataFlows[scenarioId];
                if (!flow) return;
                
                const defaultState = document.getElementById('default-state');
                const detailContent = document.getElementById('detail-content');
                
                defaultState.style.display = 'none';
                detailContent.classList.add('active');
                
                let html = `<div class="detail-item" style="margin-bottom: 25px;">
                    <div class="detail-item-label" style="font-size: 16px; font-weight: 700; color: #667eea;">${flow.title}</div>
                </div>`;
                
                flow.steps.forEach((step, index) => {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ LLM API è°ƒç”¨æ­¥éª¤
                    const isLLMCall = step.module.includes('ğŸ¤– LLM API') || step.module.includes('LLM API');
                    const borderColor = isLLMCall ? '#9333ea' : '#667eea';
                    const bgColor = isLLMCall ? 'linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%)' : '#f1f3f5';
                    const textColor = isLLMCall ? '#7c3aed' : '#495057';
                    
                    html += `
                        <div class="detail-item" style="margin-bottom: 20px; border-left: 3px solid ${borderColor}; padding-left: 15px; ${isLLMCall ? 'background: linear-gradient(135deg, rgba(243, 232, 255, 0.3) 0%, rgba(233, 213, 255, 0.3) 100%); border-radius: 6px; padding: 15px;' : ''}">
                            <div class="detail-item-label" style="color: ${borderColor}; font-weight: 600;">Step ${step.step}: ${step.module}</div>
                            <div class="detail-item-value" style="margin-top: 8px;">
                                <div style="margin-bottom: 6px;"><strong>Input:</strong> ${step.input}</div>
                                <div style="margin-bottom: 6px;"><strong>Process:</strong> ${step.process}</div>
                                <div style="margin-bottom: 6px;"><strong>Output:</strong> <code>${step.output}</code></div>
                                <div style="margin-top: 8px; padding: 6px; background: ${bgColor}; border-radius: 4px; font-size: 12px; color: ${textColor}; border: ${isLLMCall ? '1px solid rgba(147, 51, 234, 0.2)' : 'none'};">
                                    <strong>Data Transformation:</strong> ${step.dataType}
                                </div>
                            </div>
                        </div>
                        ${index < flow.steps.length - 1 ? '<div style="text-align: center; color: #667eea; font-size: 20px; margin: 10px 0;">â†“</div>' : ''}
                    `;
                });
                
                detailContent.innerHTML = html;
            }
            
            function showModuleDetails(moduleId) {
                const detail = moduleDetails[moduleId];
                if (!detail) return;
                
                const defaultState = document.getElementById('default-state');
                const detailContent = document.getElementById('detail-content');
                
                defaultState.style.display = 'none';
                detailContent.classList.add('active');
                
                detailContent.innerHTML = `
                    <div class="detail-item">
                        <div class="detail-item-label">ç»„ä»¶åç§° (Component)</div>
                        <div class="detail-item-value">${detail.component}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">æ ¸å¿ƒå‡½æ•° (Core Function)</div>
                        <div class="detail-item-value"><code>${detail.coreFunction}</code></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">æ•°æ®è¾“å…¥/è¾“å‡º (Data I/O)</div>
                        <div class="detail-item-value">${detail.dataIO}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">æŠ€æœ¯å®ç°ä¸åŸç† (Technology Description)</div>
                        <div class="detail-item-value">${detail.technologyDescription}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">å…³é”®é€»è¾‘ (Key Logic)</div>
                        <div class="detail-item-value">${detail.keyLogic}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">è®¾è®¡ä¾æ®ä¸æ„ä¹‰ (Design Rationale)</div>
                        <div class="detail-item-value">${detail.designRationale}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">ä¸Šæ¸¸/ä¸‹æ¸¸ (Upstream / Downstream)</div>
                        <div class="detail-item-value">${detail.upstreamDownstream}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">ğŸ¤– LLM è°ƒç”¨ä¸äº¤äº’æœºåˆ¶ (LLM Integration Logic)</div>
                        <div class="detail-item-value llm-logic-section" style="font-size: 13px; line-height: 1.8;">${detail.llmLogic || "N/A - æ­¤æ¨¡å—ä¸ç›´æ¥è°ƒç”¨ LLM API"}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">å­¦æœ¯ç†è®ºä¾æ® (Academic Basis)</div>
                        <div class="detail-item-value" style="font-size: 12px; line-height: 1.8;">${detail.academicBasis}</div>
                    </div>
                `;
                
                // é«˜äº®é€‰ä¸­çš„å¡ç‰‡
                document.querySelectorAll('.flow-step-card').forEach(card => {
                    card.classList.remove('active-flow');
                });
                document.querySelector(`[data-module="${moduleId}"]`).classList.add('active-flow');
            }
            
            // åœºæ™¯æ¨¡å¼æ¸²æŸ“
            let currentScenario = null;
            let animationTimeout = null;
            
            // è®¡ç®—ä¸‰æ¬¡è´å¡å°”æ›²çº¿åœ¨ t å¤„çš„ç‚¹
            function bezierPoint(t, p0, p1, p2, p3) {
                const u = 1 - t, u2 = u*u, u3 = u2*u, t2 = t*t, t3 = t2*t;
                return {
                    x: u3*p0.x + 3*u2*t*p1.x + 3*u*t2*p2.x + t3*p3.x,
                    y: u3*p0.y + 3*u2*t*p1.y + 3*u*t2*p2.y + t3*p3.y
                };
            }
            
            // ç»˜åˆ¶ Bio-Synapse æœ‰æœºæ›²çº¿ï¼ˆè´å¡å°” + è„‰å†² + æµ®åŠ¨æ ‡ç­¾ï¼‰
            function drawSynapse(startId, endId, type, label, connectionId, delay = 0) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const svg = document.getElementById('flow-svg');
                        if (!svg) return resolve();
                        
                        const startElem = document.querySelector(`[data-module="${startId}"]`);
                        const endElem = document.querySelector(`[data-module="${endId}"]`);
                        if (!startElem || !endElem) return resolve();
                        
                        const startPos = getCardCenter(startElem);
                        const endPos = getCardCenter(endElem);
                        if (!startPos || !endPos) return resolve();
                        
                        const dx = endPos.x - startPos.x;
                        const dy = endPos.y - startPos.y;
                        const midX = (startPos.x + endPos.x) / 2;
                        const midY = (startPos.y + endPos.y) / 2;
                        
                        let d;
                        let labelX, labelY;
                        if (Math.abs(dy) > Math.abs(dx)) {
                            const c1x = startPos.x + dx * 0.2;
                            const c1y = startPos.y + dy * 0.3;
                            const c2x = endPos.x - dx * 0.2;
                            const c2y = endPos.y - dy * 0.3;
                            d = `M ${startPos.x} ${startPos.y} C ${c1x} ${c1y}, ${c2x} ${c2y}, ${endPos.x} ${endPos.y}`;
                            const mid = bezierPoint(0.5, startPos, {x:c1x,y:c1y}, {x:c2x,y:c2y}, endPos);
                            labelX = mid.x; labelY = mid.y;
                        } else {
                            const c1x = midX - dy * 0.25;
                            const c1y = midY + dx * 0.25;
                            const c2x = midX + dy * 0.25;
                            const c2y = midY - dx * 0.25;
                            d = `M ${startPos.x} ${startPos.y} C ${c1x} ${c1y}, ${c2x} ${c2y}, ${endPos.x} ${endPos.y}`;
                            const mid = bezierPoint(0.5, startPos, {x:c1x,y:c1y}, {x:c2x,y:c2y}, endPos);
                            labelX = mid.x; labelY = mid.y;
                        }
                        
                        const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                        g.dataset.connectionId = connectionId || '';
                        
                        const basePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        basePath.setAttribute('d', d);
                        basePath.setAttribute('class', `synapse-base synapse-${type}`);
                        basePath.setAttribute('marker-end', `url(#arrowhead-${type})`);
                        if (connectionId && dataFlowSpecs[connectionId]) {
                            basePath.addEventListener('click', (e) => { e.stopPropagation(); showCodeModal(connectionId); });
                        }
                        g.appendChild(basePath);
                        
                        const pulsePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        pulsePath.setAttribute('d', d);
                        pulsePath.setAttribute('class', `synapse-pulse synapse-${type}`);
                        pulsePath.setAttribute('marker-end', `url(#arrowhead-${type})`);
                        g.appendChild(pulsePath);
                        
                        if (label) {
                            const labelG = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                            labelG.setAttribute('class', 'synapse-label-group');
                            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                            text.setAttribute('class', 'synapse-label');
                            text.setAttribute('x', labelX);
                            text.setAttribute('y', labelY);
                            text.textContent = label;
                            labelG.appendChild(text);
                            g.appendChild(labelG);
                        }
                        
                        g.style.opacity = '0';
                        svg.appendChild(g);
                        requestAnimationFrame(() => {
                            g.style.transition = 'opacity 0.5s';
                            g.style.opacity = '1';
                        });
                        
                        resolve();
                    }, delay);
                });
            }
            
            // å…¼å®¹æ—§è°ƒç”¨ï¼šdrawConnection(startElem, endElem, ..., connectionId) -> è½¬ä¸º drawSynapse
            function drawConnection(startElem, endElem, color, delay, connectionId) {
                const startId = startElem?.dataset?.module;
                const endId = endElem?.dataset?.module;
                if (!startId || !endId) return Promise.resolve();
                const typeMap = { 'user-orch':'control', 'orch-output':'control', 'orch-planner':'control', 'orch-executor':'control', 'orch-agent':'control',
                    'planner-retriever':'data', 'retriever-planner':'data', 'planner-output':'data', 'agent-executor':'data', 'executor-tools':'data', 'executor-output':'data',
                    'executor-planner':'error', 'planner-executor':'error' };
                const labelMap = { 'user-orch':'å‘é€æ„å›¾', 'orch-planner':'ä¸‹å‘è§„åˆ’ä»»åŠ¡', 'planner-retriever':'å·¥å…·æ£€ç´¢', 'retriever-planner':'è¿”å›å·¥å…·å®šä¹‰',
                    'planner-output':'æ¨é€å·¥ä½œæµé…ç½®', 'orch-executor':'æ‰§è¡ŒæŒ‡ä»¤', 'executor-output':'æ­¥éª¤ç»“æœ', 'executor-planner':'ä¸ŠæŠ¥æ‰§è¡Œé”™è¯¯',
                    'planner-executor':'ä¿®æ­£æ–¹æ¡ˆ', 'orch-output':'æµå¼å¯¹è¯', 'orch-agent':'ä»»åŠ¡å§”æ´¾', 'agent-executor':'æ‰§è¡Œæ­¥éª¤', 'executor-tools':'è°ƒç”¨å·¥å…·' };
                const type = typeMap[connectionId] || 'control';
                const label = labelMap[connectionId] || '';
                return drawSynapse(startId, endId, type, label, connectionId, delay);
            }
            
            // è·å–å¡ç‰‡ä¸­å¿ƒä½ç½®
            function getCardCenter(card) {
                if (!card) return null;
                const rect = card.getBoundingClientRect();
                const diagramRect = document.querySelector('.flow-diagram');
                if (!diagramRect) return null;
                const diagramRectBounds = diagramRect.getBoundingClientRect();
                return {
                    x: rect.left - diagramRectBounds.left + rect.width / 2,
                    y: rect.top - diagramRectBounds.top + rect.height / 2
                };
            }
            
            // é¡ºåºé«˜äº®æ¨¡å—ï¼ˆconnectionIds: æ¯æ¡è¾¹çš„è¿æ¥IDæ•°ç»„ï¼Œé•¿åº¦=modules.length-1ï¼‰
            async function highlightModuleSequence(modules, delay = 500, connectionIds = []) {
                for (let i = 0; i < modules.length; i++) {
                    const module = modules[i];
                    if (module.card) {
                        module.card.classList.add('active-flow');
                        if (module.card.scrollIntoView) {
                            module.card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    }
                    
                    if (i < modules.length - 1 && modules[i + 1]) {
                        const connId = connectionIds[i] || null;
                        await drawConnection(module.card, modules[i + 1].card, '#00f2ff', delay, connId);
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            
            function renderScenario(mode, buttonElement) {
                // æ¸…é™¤ä¹‹å‰çš„åŠ¨ç”»
                if (animationTimeout) {
                    clearTimeout(animationTimeout);
                }
                
                // é‡ç½®æ‰€æœ‰çŠ¶æ€
                document.querySelectorAll('.flow-step-card').forEach(card => {
                    card.classList.remove('active-flow', 'dimmed');
                });
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // æ¸…é™¤ SVG è·¯å¾„ï¼ˆä¿ç•™ defsï¼‰
                const svg = document.getElementById('flow-svg');
                const defs = svg.querySelector('defs');
                svg.innerHTML = '';
                if (defs) svg.appendChild(defs);
                
                if (mode === 'reset') {
                    currentScenario = null;
                    // é‡ç½®ä¾§è¾¹æ 
                    const defaultState = document.getElementById('default-state');
                    const detailContent = document.getElementById('detail-content');
                    defaultState.style.display = 'block';
                    detailContent.classList.remove('active');
                    return;
                }
                
                // æ¿€æ´»å½“å‰æŒ‰é’®
                if (buttonElement) {
                    buttonElement.classList.add('active');
                }
                currentScenario = mode;
                
                // ğŸ”¥ ç«‹å³æ›´æ–°ä¾§è¾¹æ æ˜¾ç¤ºåœºæ™¯æ•°æ®æµï¼ˆä¸ç­‰å¾…å¡ç‰‡ç‚¹å‡»ï¼‰
                showScenarioFlow(mode);
                
                const cards = {
                    user: document.querySelector('[data-module="user"]'),
                    orchestrator: document.querySelector('[data-module="orchestrator"]'),
                    planner: document.querySelector('[data-module="planner"]'),
                    retriever: document.querySelector('[data-module="retriever"]'),
                    agent: document.querySelector('[data-module="agent"]'),
                    executor: document.querySelector('[data-module="executor"]'),
                    output: document.querySelector('[data-module="output"]'),
                    llm: document.querySelector('[data-module="llm"]')
                };
                
                // æš—æ·¡éæ´»åŠ¨æ¨¡å—
                const allCards = Object.values(cards).filter(c => c);
                const activeCards = [];
                
                if (mode === 'planning') {
                    // è§„åˆ’æµç¨‹ï¼šUser -> Orchestrator -> Planner <-> Retriever -> Planner -> Frontend
                    activeCards.push(
                        { card: cards.user, color: '#4CAF50' },
                        { card: cards.orchestrator, color: '#9C27B0' },
                        { card: cards.planner, color: '#FF6B35' },
                        { card: cards.retriever, color: '#FF6B35' },
                        { card: cards.planner, color: '#FF6B35' },
                        { card: cards.output, color: '#4CAF50' }
                    );
                    const connIds = ['user-orch', 'orch-planner', 'planner-retriever', 'retriever-planner', 'planner-output'];
                    [cards.agent, cards.executor].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    highlightModuleSequence(activeCards, 600, connIds);
                    drawSynapse('orchestrator', 'llm', 'llm', 'æ„å›¾åˆ†ç±»', null, 800);
                    drawSynapse('planner', 'llm', 'llm', 'å·¥ä½œæµè§„åˆ’', null, 2400);
                    
                } else if (mode === 'execution') {
                    // æ‰§è¡Œæµç¨‹ï¼šUser -> Orchestrator -> Executor -> Output
                    activeCards.push(
                        { card: cards.user, color: '#4CAF50' },
                        { card: cards.orchestrator, color: '#9C27B0' },
                        { card: cards.executor, color: '#F44336' },
                        { card: cards.output, color: '#4CAF50' }
                    );
                    const connIds = ['user-orch', 'orch-executor', 'executor-output'];
                    [cards.planner, cards.retriever, cards.agent].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    highlightModuleSequence(activeCards, 600, connIds);
                    drawSynapse('agent', 'llm', 'llm', 'è¯Šæ–­æŠ¥å‘Š', null, 1200);
                    
                } else if (mode === 'error') {
                    [cards.executor, cards.planner].forEach(card => {
                        if (card) card.classList.add('active-flow');
                    });
                    [cards.user, cards.orchestrator, cards.retriever, cards.agent, cards.output].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    drawSynapse('executor', 'planner', 'error', 'ä¸ŠæŠ¥æ‰§è¡Œé”™è¯¯', 'executor-planner', 0);
                    drawSynapse('planner', 'executor', 'error', 'ä¿®æ­£æ–¹æ¡ˆ', 'planner-executor', 500);
                    drawSynapse('planner', 'llm', 'llm', 'é”™è¯¯åˆ†æ', null, 1000);
                    
                } else if (mode === 'chat') {
                    // ç›´æ¥èŠå¤©ï¼šUser -> Orchestrator -> Output
                    activeCards.push(
                        { card: cards.user, color: '#4CAF50' },
                        { card: cards.orchestrator, color: '#9C27B0' },
                        { card: cards.output, color: '#4CAF50' }
                    );
                    const connIds = ['user-orch', 'orch-output'];
                    [cards.planner, cards.retriever, cards.agent, cards.executor].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    highlightModuleSequence(activeCards, 600, connIds);
                    drawSynapse('orchestrator', 'llm', 'llm', 'æµå¼å¯¹è¯', null, 800);
                }
            }
            
            // åˆå§‹åŒ– SVG ç®­å¤´æ ‡è®°å’Œå¤§å°
            function initSVG() {
                const svg = document.getElementById('flow-svg');
                const diagram = document.querySelector('.flow-diagram');
                
                // è®¾ç½® SVG å¤§å°
                if (diagram && svg) {
                    const rect = diagram.getBoundingClientRect();
                    svg.setAttribute('width', rect.width);
                    svg.setAttribute('height', rect.height);
                }
                
                // åˆ›å»ºç®­å¤´æ ‡è®°ï¼ˆcontrol=è“, data=ç»¿, error=çº¢ï¼‰
                if (!svg.querySelector('defs')) {
                    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                    const addMarker = (id, fill) => {
                        const m = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                        m.setAttribute('id', id);
                        m.setAttribute('markerWidth', '10');
                        m.setAttribute('markerHeight', '10');
                        m.setAttribute('refX', '9');
                        m.setAttribute('refY', '3');
                        m.setAttribute('orient', 'auto');
                        const p = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                        p.setAttribute('points', '0 0, 10 3, 0 6');
                        p.setAttribute('fill', fill);
                        m.appendChild(p);
                        defs.appendChild(m);
                    };
                    addMarker('arrowhead-control', '#2196F3');
                    addMarker('arrowhead-data', '#4CAF50');
                    addMarker('arrowhead-error', '#F44336');
                    addMarker('arrowhead-llm', '#9333ea');
                    svg.appendChild(defs);
                }
            }
            
            // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
            document.addEventListener('DOMContentLoaded', initSVG);
            
            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°åˆå§‹åŒ–
            window.addEventListener('resize', initSVG);
        </script>
        
        <!-- è¯¦ç»†æµç¨‹è¯´æ˜ -->
        <div class="section">
            <h2>ğŸ“‹ å…¨æµç¨‹æ•°æ®æµå‘è¯¦è§£</h2>
            
            <!-- æ­¥éª¤ 1: ç”¨æˆ·äº¤äº’ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 1: ç”¨æˆ·äº¤äº’ä¸æ–‡ä»¶ä¸Šä¼ </h3>
                <ol>
                    <li><strong>ç”¨æˆ·æ“ä½œ</strong>ï¼šç”¨æˆ·åœ¨ Web UI ä¸­é€‰æ‹©æ–‡ä»¶æˆ–è¾“å…¥æŸ¥è¯¢æ–‡æœ¬</li>
                    <li><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šå‰ç«¯è°ƒç”¨ <code>POST /api/upload</code>ï¼Œä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨</li>
                    <li><strong>æ–‡ä»¶å¤„ç†</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>æœåŠ¡å™¨è‡ªåŠ¨è¯†åˆ« 10x Genomics æ•°æ®ï¼ˆmatrix.mtx, barcodes.tsv, features.tsvï¼‰</li>
                            <li>æ–‡ä»¶ä¿å­˜åˆ° <code>{user_id}/{session_id}/</code> ç›®å½•</li>
                            <li>ç”Ÿæˆæ–‡ä»¶å…ƒæ•°æ®ï¼ˆæ–‡ä»¶ç±»å‹ã€æ ·æœ¬æ•°ã€ç‰¹å¾æ•°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›è·¯å¾„</strong>ï¼šæœåŠ¡å™¨è¿”å› <code>file_paths</code> æ•°ç»„å’Œ <code>session_id</code></li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šæ–‡ä»¶ä¸Šä¼ å“åº”</h4>
                    <div class="code-block">{
  "status": "success",
  "file_paths": ["guest/20250128_120000/example.csv"],
  "file_info": [{"name": "example.csv", "size": 1024000, "path": "..."}],
  "session_id": "20250128_120000",
  "user_id": "guest"
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 2: èŠå¤©è¯·æ±‚ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 2: èŠå¤©è¯·æ±‚ä¸æ„å›¾åˆ†ç±»</h3>
                <ol>
                    <li><strong>å‘é€è¯·æ±‚</strong>ï¼šå‰ç«¯è°ƒç”¨ <code>POST /api/chat</code>ï¼ŒåŒ…å«ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>message</code>ï¼šç”¨æˆ·æŸ¥è¯¢æ–‡æœ¬</li>
                            <li><code>uploaded_files</code>ï¼šå·²ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆname, pathï¼‰</li>
                            <li><code>stream: true</code>ï¼šå¯ç”¨ SSE æµå¼å“åº”</li>
                            <li><code>user_id</code> å’Œ <code>session_id</code>ï¼šç”¨æˆ·å’Œä¼šè¯æ ‡è¯†</li>
                        </ul>
                    </li>
                    <li><strong>API è·¯ç”±</strong>ï¼šFastAPI æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œåˆ›å»º <code>AgentOrchestrator</code> å®ä¾‹</li>
                    <li><strong>æ„å›¾åˆ†ç±»</strong>ï¼š<code>AgentOrchestrator.stream_process()</code> é¦–å…ˆè¿›è¡Œå…¨å±€æ„å›¾åˆ†ç±»ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><strong>Chat æ¨¡å¼</strong>ï¼šå¦‚æœæŸ¥è¯¢æ˜¯æ™®é€šå¯¹è¯ï¼ˆæ— æ–‡ä»¶ã€æ— åˆ†æå…³é”®è¯ï¼‰ï¼Œç›´æ¥è°ƒç”¨ LLM è¿”å›å›ç­”</li>
                            <li><strong>Task æ¨¡å¼</strong>ï¼šå¦‚æœæŸ¥è¯¢åŒ…å«åˆ†æä»»åŠ¡ï¼Œè¿›å…¥å·¥ä½œæµè§„åˆ’å’Œæ‰§è¡Œæµç¨‹</li>
                        </ul>
                    </li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šèŠå¤©è¯·æ±‚</h4>
                    <div class="code-block">{
  "message": "åˆ†æè¿™ä¸ªæ–‡ä»¶",
  "uploaded_files": [
    {"name": "example.csv", "path": "guest/20250128_120000/example.csv"}
  ],
  "stream": true,
  "user_id": "guest",
  "session_id": "20250128_120000"
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 3: æ–‡ä»¶æ£€æŸ¥ä¸æ•°æ®è¯Šæ–­ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 3: æ–‡ä»¶æ£€æŸ¥ä¸æ•°æ®è¯Šæ–­ï¼ˆTask æ¨¡å¼ï¼‰</h3>
                <ol>
                    <li><strong>æ–‡ä»¶æ£€æŸ¥</strong>ï¼šè°ƒç”¨ <code>FileInspector</code> å·¥å…·æ£€æŸ¥ä¸Šä¼ çš„æ–‡ä»¶
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼ˆCSV, H5AD, MTX ç­‰ï¼‰</li>
                            <li>æå–åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ ·æœ¬æ•°ã€ç‰¹å¾æ•°ã€ç¼ºå¤±å€¼æ¯”ä¾‹ç­‰ï¼‰</li>
                            <li>ç”Ÿæˆæ•°æ®é¢„è§ˆ</li>
                        </ul>
                    </li>
                    <li><strong>æ•°æ®è¯Šæ–­</strong>ï¼šå¯é€‰çš„æ•°æ®è´¨é‡è¯„ä¼°
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è°ƒç”¨ LLM ç”Ÿæˆæ•°æ®è¯Šæ–­æŠ¥å‘Š</li>
                            <li>è¯†åˆ«æ½œåœ¨é—®é¢˜ï¼ˆç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ã€æ•°æ®åˆ†å¸ƒç­‰ï¼‰</li>
                            <li>é€šè¿‡ SSE äº‹ä»¶ <code>diagnosis</code> å‘é€åˆ°å‰ç«¯</li>
                        </ul>
                    </li>
                </ol>
            </div>
            
            <!-- æ­¥éª¤ 4: å·¥ä½œæµè§„åˆ’ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 4: åŠ¨æ€å·¥ä½œæµè§„åˆ’</h3>
                <ol>
                    <li><strong>å·¥å…·æ£€ç´¢</strong>ï¼š<code>WorkflowPlanner</code> è°ƒç”¨ <code>ToolRetriever</code>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“è¿›è¡Œè¯­ä¹‰æ£€ç´¢</li>
                            <li>æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œæ–‡ä»¶ç±»å‹ï¼Œæ£€ç´¢ç›¸å…³çš„åˆ†æå·¥å…·</li>
                            <li>è¿”å›å·¥å…·çš„ JSON Schemaï¼ˆå‚æ•°å®šä¹‰ã€æè¿°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>LLM è§„åˆ’</strong>ï¼šå°†å·¥å…· Schema æ³¨å…¥åˆ° LLM æç¤ºè¯ä¸­
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>LLM æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œå¯ç”¨å·¥å…·ï¼Œç”Ÿæˆå·¥ä½œæµè®¡åˆ’</li>
                            <li>è¾“å‡º JSON æ ¼å¼çš„å·¥ä½œæµé…ç½®ï¼š<code>{workflow_name, steps: [{step_id, tool_id, name, params}]}</code></li>
                            <li>æ¯ä¸ªæ­¥éª¤åŒ…å«å·¥å…·IDå’Œå‚æ•°é…ç½®</li>
                        </ul>
                    </li>
                    <li><strong>å‚æ•°æ¨è</strong>ï¼šå¯é€‰æ­¥éª¤ï¼ŒLLM æ ¹æ®æ•°æ®ç‰¹å¾æ¨èæœ€ä½³å‚æ•°
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>åˆ†ææ•°æ®ç»Ÿè®¡ä¿¡æ¯</li>
                            <li>ç”Ÿæˆå‚æ•°æ¨èï¼ˆå¦‚ç¼ºå¤±å€¼é˜ˆå€¼ã€æ ‡å‡†åŒ–æ–¹æ³•ç­‰ï¼‰</li>
                            <li>å¡«å……åˆ°å·¥ä½œæµæ­¥éª¤çš„ <code>params</code> ä¸­</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›å·¥ä½œæµ</strong>ï¼šé€šè¿‡ SSE äº‹ä»¶ <code>workflow</code> å‘é€å·¥ä½œæµé…ç½®åˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šå·¥ä½œæµé…ç½®</h4>
                    <div class="code-block">{
  "type": "workflow",
  "workflow_config": {
    "workflow_name": "Metabolomics Analysis Pipeline",
    "steps": [
      {
        "step_id": "inspect_data",
        "tool_id": "inspect_data",
        "name": "æ•°æ®æ£€æŸ¥",
        "params": {"file_path": "example.csv"}
      },
      {
        "step_id": "preprocess_data",
        "tool_id": "preprocess_data",
        "name": "æ•°æ®é¢„å¤„ç†",
        "params": {
          "file_path": "example.csv",
          "missing_threshold": "0.5",
          "normalization": "log2"
        }
      }
    ]
  },
  "template_mode": false
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 5: å·¥ä½œæµæ‰§è¡Œ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 5: å·¥ä½œæµæ‰§è¡Œä¸å·¥å…·è°ƒç”¨</h3>
                <ol>
                    <li><strong>ç”¨æˆ·ç¡®è®¤</strong>ï¼šå‰ç«¯æ˜¾ç¤ºå·¥ä½œæµé…ç½®å¡ç‰‡ï¼Œç”¨æˆ·ç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®</li>
                    <li><strong>æ‰§è¡Œè¯·æ±‚</strong>ï¼šå‰ç«¯å‘é€ <code>workflow_data</code> åˆ° <code>/api/chat</code> æˆ– <code>/api/execute</code></li>
                    <li><strong>è·¯ç”±åˆ°é¢†åŸŸæ™ºèƒ½ä½“</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>RouterAgent</code> æ ¹æ® <code>workflow_name</code> æˆ–æ–‡ä»¶ç±»å‹ï¼Œè·¯ç”±åˆ°å¯¹åº”çš„é¢†åŸŸæ™ºèƒ½ä½“ï¼ˆRNA Agent æˆ– Metabolomics Agentï¼‰</li>
                            <li>é¢†åŸŸæ™ºèƒ½ä½“è´Ÿè´£æ‰§è¡Œç‰¹å®šç»„å­¦ç±»å‹çš„åˆ†æ</li>
                        </ul>
                    </li>
                    <li><strong>åˆ›å»ºæ‰§è¡Œå™¨</strong>ï¼šé¢†åŸŸæ™ºèƒ½ä½“åˆ›å»º <code>WorkflowExecutor</code> å®ä¾‹</li>
                    <li><strong>é€æ­¥æ‰§è¡Œ</strong>ï¼š<code>WorkflowExecutor</code> æŒ‰é¡ºåºæ‰§è¡Œæ¯ä¸ªæ­¥éª¤
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ä» <code>ToolRegistry</code> æŸ¥æ‰¾å·¥å…·ï¼ˆé€šè¿‡ <code>tool_id</code>ï¼‰</li>
                            <li>ä½¿ç”¨ Pydantic éªŒè¯æ­¥éª¤å‚æ•°</li>
                            <li>è°ƒç”¨å·¥å…·å‡½æ•°ï¼Œä¼ å…¥å‚æ•°</li>
                            <li>æ”¶é›†å·¥å…·è¿”å›çš„ç»“æœ</li>
                            <li>å¤„ç†æ­¥éª¤é—´çš„æ•°æ®æµï¼ˆå¦‚å°†å‰ä¸€æ­¥çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>å®æ—¶æ›´æ–°</strong>ï¼šæ¯ä¸ªæ­¥éª¤æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡ SSE äº‹ä»¶ <code>step_result</code> å‘é€ç»“æœåˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šæ­¥éª¤æ‰§è¡Œç»“æœ</h4>
                    <div class="code-block">{
  "type": "step_result",
  "report_data": {
    "step_id": "inspect_data",
    "tool_id": "inspect_data",
    "name": "æ•°æ®æ£€æŸ¥",
    "summary": "æ£€æŸ¥å®Œæˆ: 77 ä¸ªæ ·æœ¬, 50 ä¸ªä»£è°¢ç‰©",
    "status": "success",
    "plot": "/results/run_20250128_120000/inspect_plot.png",
    "step_result": {
      "step_name": "æ•°æ®æ£€æŸ¥",
      "status": "success",
      "logs": "æ£€æŸ¥å®Œæˆ: 77 ä¸ªæ ·æœ¬, 50 ä¸ªä»£è°¢ç‰©",
      "data": {
        "summary": {
          "n_samples": 77,
          "n_metabolites": 50,
          "missing_percentage": 2.5
        },
        "preview": [...],
        "images": ["/results/run_20250128_120000/inspect_plot.png"]
      }
    }
  }
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 6: ç»“æœèšåˆ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 6: ç»“æœèšåˆä¸æ ¼å¼åŒ–</h3>
                <ol>
                    <li><strong>ç»“æœæ”¶é›†</strong>ï¼š<code>WorkflowExecutor</code> æ”¶é›†æ‰€æœ‰æ­¥éª¤çš„æ‰§è¡Œç»“æœ</li>
                    <li><strong>æ•°æ®æ ¼å¼åŒ–</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ç»Ÿä¸€ç»“æœæ ¼å¼ï¼ˆ<code>steps_details</code>, <code>steps_results</code>ï¼‰</li>
                            <li>å¤„ç†å›¾ç‰‡è·¯å¾„ï¼ˆè½¬æ¢ä¸ºå¯è®¿é—®çš„ URLï¼Œå¦‚ <code>/results/run_xxx/plot.png</code>ï¼‰</li>
                            <li>æå–å…³é”®æŒ‡æ ‡ï¼ˆæ ·æœ¬æ•°ã€ç‰¹å¾æ•°ã€èšç±»æ•°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š</strong>ï¼šæ„å»ºå®Œæ•´çš„åˆ†ææŠ¥å‘Šæ•°æ®ç»“æ„</li>
                </ol>
            </div>
            
            <!-- æ­¥éª¤ 7: AI ä¸“å®¶åˆ†ææŠ¥å‘Š -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 7: AI ä¸“å®¶åˆ†ææŠ¥å‘Šç”Ÿæˆ</h3>
                <ol>
                    <li><strong>æå–å…³é”®æŒ‡æ ‡</strong>ï¼š<code>BaseAgent._generate_analysis_summary()</code> ä»æ­¥éª¤ç»“æœä¸­æå–å…³é”®æŒ‡æ ‡
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>RNA åˆ†æï¼šç»†èƒæ•°ã€åŸºå› æ•°ã€çº¿ç²’ä½“æ¯”ä¾‹ã€æ ‡è®°åŸºå› ã€èšç±»æ•°ã€ç»†èƒç±»å‹ç­‰</li>
                            <li>ä»£è°¢ç»„å­¦ï¼šæ ·æœ¬æ•°ã€ä»£è°¢ç‰©æ•°ã€å·®å¼‚ä»£è°¢ç‰©ã€VIP å€¼ã€é€šè·¯å¯Œé›†ç­‰</li>
                        </ul>
                    </li>
                    <li><strong>æ„å»ºæç¤ºè¯</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ç²¾ç®€æ­¥éª¤ä¿¡æ¯ï¼ˆåªä¿ç•™æ ¸å¿ƒå­—æ®µï¼Œè¿‡æ»¤å†—ä½™æ•°æ®ï¼‰</li>
                            <li>é™åˆ¶åˆ—è¡¨é•¿åº¦ï¼ˆå¦‚åªä¿ç•™ top 3-5 ä¸ªæ ‡è®°åŸºå› /é€šè·¯ï¼‰</li>
                            <li>æ£€æŸ¥æç¤ºè¯é•¿åº¦ï¼Œé˜²æ­¢è¶…å‡º LLM ä¸Šä¸‹æ–‡çª—å£</li>
                        </ul>
                    </li>
                    <li><strong>LLM ç”ŸæˆæŠ¥å‘Š</strong>ï¼šè°ƒç”¨ LLM ç”Ÿæˆ Markdown æ ¼å¼çš„ä¸“å®¶åˆ†ææŠ¥å‘Š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>åŒ…å«åˆ†æç»“æœæ‘˜è¦</li>
                            <li>å…³é”®å‘ç°å’Œç”Ÿç‰©å­¦è§£é‡Š</li>
                            <li>æ•°æ®è´¨é‡è¯„ä¼°</li>
                            <li>å»ºè®®å’Œä¸‹ä¸€æ­¥åˆ†ææ–¹å‘</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›æŠ¥å‘Š</strong>ï¼šé€šè¿‡ SSE äº‹ä»¶ <code>diagnosis</code> å‘é€ AI ä¸“å®¶åˆ†ææŠ¥å‘Šåˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šAI ä¸“å®¶åˆ†ææŠ¥å‘Š</h4>
                    <div class="code-block">{
  "type": "diagnosis",
  "report_data": {
    "diagnosis": "## AI ä¸“å®¶åˆ†ææŠ¥å‘Š\n\n### åˆ†æç»“æœæ‘˜è¦\n\næœ¬æ¬¡åˆ†æå®Œæˆäº† 5 ä¸ªæ­¥éª¤...\n\n### å…³é”®å‘ç°\n\n- æˆåŠŸæ­¥éª¤: 5/5\n- ç»†èƒæ•°é‡: 2,700\n- åŸºå› æ•°é‡: 3,274\n..."
  }
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 8: SSE æµå¼è¾“å‡º -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 8: SSE æµå¼è¾“å‡ºä¸å‰ç«¯æ¸²æŸ“</h3>
                <ol>
                    <li><strong>SSE äº‹ä»¶æµ</strong>ï¼š<code>AgentOrchestrator</code> é€šè¿‡ <code>yield</code> ç”Ÿæˆ SSE äº‹ä»¶
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>status</code>ï¼šçŠ¶æ€æ›´æ–°ï¼ˆ"æ­£åœ¨æ‰§è¡Œæ­¥éª¤...", "æ­£åœ¨ç”ŸæˆæŠ¥å‘Š..."ï¼‰</li>
                            <li><code>workflow</code>ï¼šå·¥ä½œæµé…ç½®</li>
                            <li><code>step_result</code>ï¼šæ­¥éª¤æ‰§è¡Œç»“æœ</li>
                            <li><code>diagnosis</code>ï¼šAI ä¸“å®¶åˆ†ææŠ¥å‘Š</li>
                            <li><code>result</code>ï¼šæœ€ç»ˆç»“æœ</li>
                            <li><code>done</code>ï¼šå®Œæˆä¿¡å·</li>
                            <li><code>error</code>ï¼šé”™è¯¯ä¿¡æ¯</li>
                        </ul>
                    </li>
                    <li><strong>å‰ç«¯æ¥æ”¶</strong>ï¼šå‰ç«¯ä½¿ç”¨ <code>ReadableStream</code> è¯»å– SSE æµ
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è§£æ SSE æ ¼å¼ï¼ˆ<code>event: {type}\ndata: {json}\n\n</code>ï¼‰</li>
                            <li>æ ¹æ®äº‹ä»¶ç±»å‹è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°</li>
                        </ul>
                    </li>
                    <li><strong>å®æ—¶æ¸²æŸ“</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>status</code> â†’ æ›´æ–°çŠ¶æ€æ </li>
                            <li><code>workflow</code> â†’ æ¸²æŸ“å·¥ä½œæµé…ç½®å¡ç‰‡</li>
                            <li><code>step_result</code> â†’ æ¸²æŸ“æ­¥éª¤æ‰§è¡Œç»“æœï¼ˆå›¾è¡¨ã€è¡¨æ ¼ï¼‰</li>
                            <li><code>diagnosis</code> â†’ æ¸²æŸ“ AI ä¸“å®¶åˆ†ææŠ¥å‘Šï¼ˆMarkdownï¼‰</li>
                            <li><code>result</code> â†’ æ¸²æŸ“æœ€ç»ˆåˆ†ææŠ¥å‘Š</li>
                        </ul>
                    </li>
                </ol>
                <div class="data-format">
                    <h4>SSE äº‹ä»¶æ ¼å¼ç¤ºä¾‹</h4>
                    <div class="code-block">event: status
data: {"content": "æ­£åœ¨æ‰§è¡Œæ­¥éª¤: æ•°æ®æ£€æŸ¥...", "state": "running"}

event: step_result
data: {"report_data": {...}}

event: diagnosis
data: {"report_data": {"diagnosis": "## AI ä¸“å®¶åˆ†ææŠ¥å‘Š\n\n..."}}

event: done
data: {"status": "success"}</div>
                </div>
            </div>
        </div>
        
        <!-- å…³é”®æŠ€æœ¯ç‚¹ -->
        <div class="section">
            <h2>ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹</h2>
            
            <div class="flow-step">
                <h3>1. å·¥å…·è‡ªåŠ¨å‘ç°ä¸æ³¨å†Œ</h3>
                <p>ç³»ç»Ÿé€šè¿‡ Python è£…é¥°å™¨å’Œåå°„æœºåˆ¶ï¼Œè‡ªåŠ¨å‘ç°å’Œæ³¨å†Œå·¥å…·åˆ° <code>ToolRegistry</code>ã€‚æ–°å¢å·¥å…·åªéœ€åˆ›å»ºæ–‡ä»¶å¹¶æ·»åŠ  <code>@registry.register</code> è£…é¥°å™¨ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>2. è¯­ä¹‰å·¥å…·æ£€ç´¢</h3>
                <p>ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“å’Œ Ollama Embeddingsï¼Œå®ç°åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„å·¥å…·æ¨èã€‚ç”¨æˆ·å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¨èç›¸å…³å·¥å…·ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>3. LLM é©±åŠ¨çš„å·¥ä½œæµè§„åˆ’</h3>
                <p>å°†å·¥å…· Schema æ³¨å…¥åˆ° LLM æç¤ºè¯ä¸­ï¼ŒLLM æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œå¯ç”¨å·¥å…·ï¼ŒåŠ¨æ€ç”Ÿæˆå¯æ‰§è¡Œçš„å·¥ä½œæµè®¡åˆ’ã€‚æ— éœ€ç¡¬ç¼–ç æ¨¡æ¿ï¼Œæ”¯æŒçµæ´»çš„åˆ†ææµç¨‹ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>4. é€šç”¨æ‰§è¡Œå¼•æ“</h3>
                <p>åŸºäºç­–ç•¥æ¨¡å¼å’Œä¾èµ–æ³¨å…¥ï¼Œå®ç°å·¥å…·æ— å…³çš„æ‰§è¡Œæ¡†æ¶ã€‚æ”¯æŒåŠ¨æ€å·¥å…·æŸ¥æ‰¾ã€å‚æ•°éªŒè¯ï¼ˆPydanticï¼‰å’Œç»“æœèšåˆï¼Œæ— éœ€ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™ç‰¹å®šçš„æ‰§è¡Œé€»è¾‘ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>5. SSE æµå¼è¾“å‡º</h3>
                <p>ä½¿ç”¨ Server-Sent Events (SSE) å®ç°å®æ—¶æµå¼è¾“å‡ºï¼Œå‰ç«¯å¯ä»¥å®æ—¶æ¥æ”¶å’Œæ¸²æŸ“åˆ†æè¿›åº¦ã€æ­¥éª¤ç»“æœå’Œ AI æŠ¥å‘Šï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>6. å¤šç”¨æˆ·éš”ç¦»</h3>
                <p>æ”¯æŒå¤šç”¨æˆ·å¹¶å‘ä½¿ç”¨ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç›®å½•ï¼ˆ<code>{user_id}/{session_id}/</code>ï¼‰ï¼Œå·¥ä½œæµå’Œä»»åŠ¡å†å²æŒ‰ç”¨æˆ·éš”ç¦»ã€‚</p>
            </div>
        </div>
        
        <!-- æ•°æ®æµæ€»ç»“ -->
        <div class="section">
            <h2>ğŸ“Š æ•°æ®æµæ€»ç»“</h2>
            <div class="flow-step">
                <h3>å®Œæ•´æ•°æ®æµå‘</h3>
                <ol>
                    <li><strong>å‰ç«¯ â†’ API æœåŠ¡å™¨</strong>ï¼šHTTP POST è¯·æ±‚ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€èŠå¤©è¯·æ±‚ï¼‰</li>
                    <li><strong>API æœåŠ¡å™¨ â†’ ç¼–æ’å™¨</strong>ï¼šåˆ›å»º <code>AgentOrchestrator</code>ï¼Œè°ƒç”¨ <code>stream_process()</code></li>
                    <li><strong>ç¼–æ’å™¨ â†’ æ™ºèƒ½ä½“</strong>ï¼šæ„å›¾åˆ†ç±»ã€è·¯ç”±åˆ°é¢†åŸŸæ™ºèƒ½ä½“ã€è°ƒç”¨è§„åˆ’å™¨</li>
                    <li><strong>è§„åˆ’å™¨ â†’ å·¥å…·æ£€ç´¢å™¨/LLM</strong>ï¼šè¯­ä¹‰æ£€ç´¢å·¥å…·ã€LLM ç”Ÿæˆå·¥ä½œæµ</li>
                    <li><strong>é¢†åŸŸæ™ºèƒ½ä½“ â†’ æ‰§è¡Œå™¨</strong>ï¼šåˆ›å»º <code>WorkflowExecutor</code>ï¼Œæ‰§è¡Œå·¥ä½œæµ</li>
                    <li><strong>æ‰§è¡Œå™¨ â†’ å·¥å…·</strong>ï¼šåŠ¨æ€æŸ¥æ‰¾å·¥å…·ã€éªŒè¯å‚æ•°ã€è°ƒç”¨å·¥å…·å‡½æ•°</li>
                    <li><strong>å·¥å…· â†’ æ‰§è¡Œå™¨</strong>ï¼šè¿”å›æ‰§è¡Œç»“æœï¼ˆæ•°æ®ã€å›¾è¡¨è·¯å¾„ã€ç»Ÿè®¡ä¿¡æ¯ï¼‰</li>
                    <li><strong>æ‰§è¡Œå™¨ â†’ é¢†åŸŸæ™ºèƒ½ä½“</strong>ï¼šèšåˆæ­¥éª¤ç»“æœã€ç”Ÿæˆ AI æŠ¥å‘Š</li>
                    <li><strong>é¢†åŸŸæ™ºèƒ½ä½“ â†’ ç¼–æ’å™¨</strong>ï¼šè¿”å›å®Œæ•´åˆ†ææŠ¥å‘Š</li>
                    <li><strong>ç¼–æ’å™¨ â†’ API æœåŠ¡å™¨</strong>ï¼šé€šè¿‡ SSE æµå¼è¾“å‡ºäº‹ä»¶</li>
                    <li><strong>API æœåŠ¡å™¨ â†’ å‰ç«¯</strong>ï¼šSSE äº‹ä»¶æµï¼ˆstatus, workflow, step_result, diagnosis, result, doneï¼‰</li>
                    <li><strong>å‰ç«¯æ¸²æŸ“</strong>ï¼šå®æ—¶è§£æ SSE äº‹ä»¶ï¼Œæ¸²æŸ“å·¥ä½œæµå¡ç‰‡ã€æ­¥éª¤ç»“æœã€AI æŠ¥å‘Š</li>
                </ol>
            </div>
        </div>
    </div>
</body>
</html>

</html>
