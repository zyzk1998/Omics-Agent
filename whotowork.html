<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omics Agent - How to Work å…¨æµç¨‹æ•°æ®æµå‘å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
            margin: 0;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        /* Master-Detail å¸ƒå±€ */
        .main-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .diagram-section {
            flex: 0 0 65%;
            display: flex;
            flex-direction: column;
        }
        
        .detail-panel {
            flex: 0 0 35%;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        /* æ§åˆ¶æ  */
        .control-bar {
            background: #ffffff;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-bar h3 {
            margin: 0;
            font-size: 14px;
            color: #495057;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .scenario-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .scenario-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }
        
        .scenario-btn.active {
            background: #764ba2;
            box-shadow: 0 2px 8px rgba(118, 75, 162, 0.3);
        }
        
        .scenario-btn:active {
            transform: translateY(0);
        }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        .detail-panel h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .detail-panel .default-state {
            color: #6c757d;
            font-style: italic;
            text-align: center;
            padding: 40px 20px;
        }
        
        .detail-content {
            display: none;
        }
        
        .detail-content.active {
            display: block;
        }
        
        .detail-item {
            margin-bottom: 20px;
        }
        
        .detail-item-label {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-item-value {
            color: #212529;
            font-size: 14px;
            line-height: 1.6;
            background: white;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #667eea;
        }
        
        .detail-item-value code {
            background: #f1f3f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #d63384;
        }
        
        /* SVG è¦†ç›–å±‚ç”¨äºåŠ¨æ€è¿æ¥çº¿ */
        .svg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            overflow: visible;
        }
        
        .svg-overlay path {
            stroke: #ff6b35;
            stroke-width: 3;
            fill: none;
            stroke-dasharray: 10,5;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .svg-overlay path.active {
            opacity: 1;
            animation: flowAnimation 2s linear infinite;
        }
        
        .svg-overlay path.flow-anim {
            stroke-dasharray: 10,5;
            stroke-dashoffset: 0;
            animation: flowAnimation 2s linear infinite;
        }
        
        @keyframes flowAnimation {
            0% {
                stroke-dashoffset: 0;
            }
            100% {
                stroke-dashoffset: -15;
            }
        }
        
        /* æ•°æ®åŒ…åŠ¨ç”»ï¼ˆæ²¿è·¯å¾„ç§»åŠ¨çš„ç‚¹ï¼‰ */
        .svg-overlay circle {
            fill: #ff6b35;
            r: 4;
            opacity: 0;
        }
        
        .svg-overlay circle.active {
            opacity: 1;
            animation: moveAlongPath 2s linear infinite;
        }
        
        @keyframes moveAlongPath {
            0% {
                offset-distance: 0%;
            }
            100% {
                offset-distance: 100%;
            }
        }
        
        /* é«˜äº®å’Œæš—æ·¡æ•ˆæœ */
        .flow-step-card.dimmed {
            opacity: 0.3;
            filter: grayscale(0.7);
        }
        
        .flow-step-card.active-flow {
            border-width: 5px;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }
        
        .flow-step-card.clickable {
            cursor: pointer;
        }
        
        .flow-step-card.clickable:hover {
            border-width: 4px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }
        
        .flow-diagram {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 40px;
            margin: 0;
            overflow-x: auto;
            position: relative;
        }
        
        /* CSS Grid 2D æµç¨‹å›¾å¸ƒå±€ */
        .flow-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: auto;
            gap: 30px 20px;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            padding: 20px 0;
        }
        
        /* è¿æ¥çº¿ - ä½¿ç”¨ä¼ªå…ƒç´ åˆ›å»ºè§†è§‰è¿æ¥ */
        .flow-step-card::after {
            content: '';
            position: absolute;
            width: 3px;
            height: 30px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            opacity: 0.6;
        }
        
        /* å…¨å®½å¡ç‰‡æ˜¾ç¤ºå‘ä¸‹çš„è¿æ¥çº¿ */
        .flow-step-card.user-layer::after,
        .flow-step-card.orchestrator-layer::after,
        .flow-step-card.agent-layer::after,
        .flow-step-card.executor-layer::after {
            display: block;
        }
        
        /* æœ€ç»ˆè¾“å‡ºå±‚ä¸æ˜¾ç¤ºè¿æ¥çº¿ */
        .flow-step-card.output-layer::after {
            display: none;
        }
        
        /* å¹¶æ’å¡ç‰‡ï¼ˆå¤§è„‘å±‚ï¼‰ä¸æ˜¾ç¤ºå‘ä¸‹çš„è¿æ¥çº¿ï¼Œæ˜¾ç¤ºæ°´å¹³è¿æ¥ */
        .flow-step-card.router-planner::after {
            display: none;
        }
        
        .flow-step-card.tool-retriever::after {
            display: none;
        }
        
        /* è¿æ¥çº¿ç®­å¤´ */
        .flow-step-card::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid #667eea;
            bottom: -38px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            opacity: 0.8;
        }
        
        .flow-step-card.user-layer::before,
        .flow-step-card.orchestrator-layer::before,
        .flow-step-card.agent-layer::before,
        .flow-step-card.executor-layer::before {
            display: block;
        }
        
        .flow-step-card.router-planner::before,
        .flow-step-card.tool-retriever::before,
        .flow-step-card.output-layer::before {
            display: none;
        }
        
        /* æ°´å¹³è¿æ¥çº¿ï¼ˆç”¨äºå¹¶æ’å¡ç‰‡ - å¤§è„‘å±‚ï¼‰ */
        .flow-step-card.router-planner::after {
            content: '';
            display: block;
            position: absolute;
            width: 20px;
            height: 3px;
            background: linear-gradient(to right, #667eea, #764ba2);
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
            opacity: 0.6;
        }
        
        .flow-step-card.router-planner::before {
            content: '';
            display: block;
            position: absolute;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 8px solid #667eea;
            right: -28px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            opacity: 0.8;
        }
        
        /* æµç¨‹å¡ç‰‡åŸºç¡€æ ·å¼ */
        .flow-step-card {
            background: white;
            border: 3px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .flow-step-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border-width: 4px;
        }
        
        /* å­¦æœ¯è®ºæ–‡å¼•ç”¨å¾½ç«  */
        .academic-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            margin-top: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            letter-spacing: 0.3px;
            line-height: 1.4;
        }
        
        .academic-badge::before {
            content: 'ğŸ“„ ';
            font-size: 11px;
        }
        
        .academic-badge.small {
            font-size: 9px;
            padding: 3px 8px;
        }
        
        /* ç”¨æˆ·å±‚ - é¡¶éƒ¨å…¨å®½ */
        .flow-step-card.user-layer {
            grid-column: 1 / -1;
            border-color: #4CAF50;
            background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        }
        
        /* API å±‚ */
        .flow-step-card.api-layer {
            grid-column: 1 / -1;
            border-color: #2196F3;
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
        }
        
        /* ç¼–æ’å±‚ */
        .flow-step-card.orchestrator-layer {
            grid-column: 1 / -1;
            border-color: #9C27B0;
            background: linear-gradient(135deg, #f3e5f5 0%, #ffffff 100%);
            border-width: 4px;
        }
        
        /* æ ¸å¿ƒé€»è¾‘å±‚ - å¹¶æ’æ˜¾ç¤º */
        .flow-step-card.brain-layer {
            border-color: #FF6B35;
            background: linear-gradient(135deg, #fff5f0 0%, #ffffff 100%);
            border-width: 4px;
            position: relative;
        }
        
        .flow-step-card.brain-layer::before {
            content: 'ğŸ§ ';
            position: absolute;
            top: -15px;
            right: -15px;
            font-size: 32px;
            background: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            border: 3px solid #FF6B35;
        }
        
        .flow-step-card.router-planner {
            grid-column: 1 / 2;
        }
        
        .flow-step-card.tool-retriever {
            grid-column: 2 / 3;
        }
        
        /* æ‰§è¡Œå±‚ */
        .flow-step-card.executor-layer {
            grid-column: 1 / -1;
            border-color: #F44336;
            background: linear-gradient(135deg, #ffebee 0%, #ffffff 100%);
        }
        
        /* å·¥å…·å±‚ - å›¾ä¹¦é¦†æ ·å¼ */
        .flow-step-card.tool-layer {
            grid-column: 1 / 2;
            border-color: #F44336;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 20px,
                    rgba(244, 67, 54, 0.1) 20px,
                    rgba(244, 67, 54, 0.1) 22px
                ),
                linear-gradient(135deg, #ffebee 0%, #ffffff 100%);
            position: relative;
        }
        
        .flow-step-card.tool-layer::after {
            content: 'ğŸ“š';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            opacity: 0.3;
        }
        
        /* é¢†åŸŸæ™ºèƒ½ä½“å±‚ */
        .flow-step-card.agent-layer {
            grid-column: 2 / 3;
            border-color: #FF9800;
            background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%);
        }
        
        /* ç»“æœå±‚ */
        .flow-step-card.result-layer {
            grid-column: 3 / 4;
            border-color: #00BCD4;
            background: linear-gradient(135deg, #e0f7fa 0%, #ffffff 100%);
        }
        
        /* æœ€ç»ˆè¾“å‡ºå±‚ */
        .flow-step-card.output-layer {
            grid-column: 1 / -1;
            border-color: #4CAF50;
            background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        }
        
        .step-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .step-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
            margin-top: 6px;
        }
        
        .step-components {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
            margin-top: 10px;
        }
        
        .component-tag {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 11px;
            color: #667eea;
            font-weight: 500;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .flow-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .flow-step-card.user-layer,
            .flow-step-card.orchestrator-layer,
            .flow-step-card.agent-layer,
            .flow-step-card.executor-layer,
            .flow-step-card.output-layer {
                grid-column: 1 / -1;
            }
            
            .flow-step-card.router-planner {
                grid-column: 1 / 2;
            }
            
            .flow-step-card.tool-retriever {
                grid-column: 2 / 3;
            }
        }
        
        @media (max-width: 768px) {
            .flow-grid {
                grid-template-columns: 1fr;
            }
            
            .flow-step-card {
                grid-column: 1 / -1 !important;
            }
            
            .academic-badge {
                font-size: 9px;
                padding: 3px 8px;
            }
        }
        
        .download-section {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin: 40px 0;
            text-align: center;
        }
        
        .download-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            border: none;
            padding: 0;
        }
        
        .architecture-image {
            max-width: 100%;
            height: auto;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .download-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .download-btn:hover {
            background: #5568d3;
        }
        
        .download-btn:active {
            transform: scale(0.98);
        }
        
        .image-placeholder {
            background: #e9ecef;
            border: 2px dashed #adb5bd;
            border-radius: 8px;
            padding: 60px 20px;
            color: #6c757d;
            font-size: 14px;
            margin: 20px 0;
        }
        
        .flow-step {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .flow-step h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .flow-step ol {
            margin-left: 20px;
        }
        
        .flow-step li {
            margin: 8px 0;
            color: #333;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .section {
            margin: 40px 0;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .data-format {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .data-format h4 {
            color: #1976D2;
            margin-bottom: 8px;
        }
        
        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .print-btn:hover {
            background: #5568d3;
        }
        
        @media print {
            /* é¡µé¢è®¾ç½® */
            @page {
                size: A4 landscape;
                margin: 1cm;
            }
            
            /* å¼ºåˆ¶æ‰“å°èƒŒæ™¯é¢œè‰² */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body {
                background: white !important;
                padding: 0;
                margin: 0;
            }
            
            /* éšè— UI å…ƒç´  */
            .print-btn,
            .download-btn,
            .download-section,
            .control-bar,
            .detail-panel {
                display: none !important;
            }
            
            /* å®¹å™¨æ ·å¼ */
            .container {
                box-shadow: none !important;
                padding: 20px !important;
                background: white !important;
                border-radius: 0 !important;
            }
            
            /* Master-Detail å¸ƒå±€åœ¨æ‰“å°æ—¶å˜ä¸ºå•åˆ— */
            .main-layout {
                display: block !important;
            }
            
            .diagram-section {
                width: 100% !important;
            }
            
            /* éšè— SVG è¦†ç›–å±‚ */
            .svg-overlay {
                display: none !important;
            }
            
            /* æµç¨‹å›¾æ ·å¼ */
            .flow-diagram {
                page-break-inside: avoid !important;
                background: #f8f9fa !important;
                border: 2px solid #dee2e6 !important;
                padding: 30px !important;
                margin: 20px 0 !important;
            }
            
            .flow-grid {
                gap: 25px 15px !important;
            }
            
            /* å¡ç‰‡æ ·å¼ - ç¡®ä¿èƒŒæ™¯å’Œè¾¹æ¡†æ‰“å° */
            .flow-step-card {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                background: white !important;
                border: 3px solid !important;
                box-shadow: 0 2px 6px rgba(0,0,0,0.1) !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* ç¡®ä¿æ¸å˜èƒŒæ™¯æ‰“å° */
            .flow-step-card.user-layer {
                background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%) !important;
                border-color: #4CAF50 !important;
            }
            
            .flow-step-card.orchestrator-layer {
                background: linear-gradient(135deg, #f3e5f5 0%, #ffffff 100%) !important;
                border-color: #9C27B0 !important;
            }
            
            .flow-step-card.brain-layer {
                background: linear-gradient(135deg, #fff5f0 0%, #ffffff 100%) !important;
                border-color: #FF6B35 !important;
            }
            
            .flow-step-card.agent-layer {
                background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%) !important;
                border-color: #FF9800 !important;
            }
            
            .flow-step-card.executor-layer {
                background: linear-gradient(135deg, #ffebee 0%, #ffffff 100%) !important;
                border-color: #F44336 !important;
            }
            
            /* å­¦æœ¯å¾½ç« æ ·å¼ */
            .academic-badge {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* è¿æ¥çº¿ */
            .flow-step-card::after,
            .flow-step-card::before {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* æ ‡é¢˜å’Œæ–‡æœ¬ */
            h1, h2, h3 {
                color: #333 !important;
                page-break-after: avoid !important;
            }
            
            .section {
                page-break-inside: avoid !important;
            }
            
            /* ä»£ç å— */
            .code-block {
                background: #1e1e1e !important;
                color: #d4d4d4 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* æ•°æ®æ ¼å¼æ¡† */
            .data-format {
                background: #e7f3ff !important;
                border-left: 4px solid #2196F3 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
    </style>
</head>
<body>
    <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°/å¯¼å‡º PDF</button>
    
    <div class="container">
        <h1>ğŸš€ Omics Agent - Interactive Architecture Dashboard</h1>
        <p class="subtitle">äº¤äº’å¼ç™½ç›’æ¶æ„ä»ªè¡¨æ¿ï¼šä»ç”¨æˆ·éœ€æ±‚åˆ°åˆ†æç»“æœçš„å®Œæ•´æµç¨‹</p>
        
        <!-- Master-Detail å¸ƒå±€ -->
        <div class="main-layout">
            <!-- ä¸»åŒºåŸŸï¼šæ¶æ„å›¾ -->
            <div class="diagram-section">
                <!-- æ§åˆ¶æ ï¼šåœºæ™¯æ¨¡å¼ -->
                <div class="control-bar">
                    <h3>ğŸ“Š åœºæ™¯æ¨¡å¼ (Scenario Mode):</h3>
                    <button class="scenario-btn" onclick="renderScenario('planning', this)">è§„åˆ’æµç¨‹ (Planning Flow)</button>
                    <button class="scenario-btn" onclick="renderScenario('execution', this)">æ‰§è¡Œæµç¨‹ (Execution Flow)</button>
                    <button class="scenario-btn" onclick="renderScenario('error', this)">é”™è¯¯å¾ªç¯ (Error Loop)</button>
                    <button class="scenario-btn" onclick="renderScenario('chat', this)">ç›´æ¥èŠå¤© (Direct Chat)</button>
                    <button class="scenario-btn" onclick="renderScenario('reset', this)">é‡ç½® (Reset)</button>
                </div>
                
                <!-- æµç¨‹å›¾ - æ•°å­—å®éªŒå®¤ç±»æ¯” (CSS Grid 2D å¸ƒå±€) -->
                <div class="flow-diagram">
                    <div class="flow-grid">
                        <!-- ç¬¬1è¡Œ: ç”¨æˆ· (å…¨å®½) -->
                        <div class="flow-step-card user-layer clickable" data-module="user" onclick="showModuleDetails('user')">
                            <div class="step-title">ğŸ‘©â€ğŸ”¬ ç”¨æˆ· (User)</div>
                            <div class="step-desc">æå‡ºéœ€æ±‚ï¼š"å¸®æˆ‘åˆ†æè¿™ä¸ªæ•°æ®"</div>
                            <div class="step-components">
                                <span class="component-tag">Web UI</span>
                                <span class="component-tag">æ–‡ä»¶ä¸Šä¼ </span>
                                <span class="component-tag">è‡ªç„¶è¯­è¨€æŸ¥è¯¢</span>
                            </div>
                        </div>
                        
                        <!-- ç¬¬2è¡Œ: æ€»æ§ç¼–æ’ (å…¨å®½) -->
                        <div class="flow-step-card orchestrator-layer clickable" data-module="orchestrator" onclick="showModuleDetails('orchestrator')">
                            <div class="step-title">ğŸ¤– æ€»æ§ç¼–æ’ (Orchestrator)</div>
                            <div class="step-desc">è´Ÿè´£ç†è§£æ„å›¾ï¼Œåˆ†å‘ä»»åŠ¡ï¼Œåè°ƒå¯¹è¯æµç¨‹</div>
                            <div class="step-components">
                                <span class="component-tag">æ„å›¾åˆ†ç±»</span>
                                <span class="component-tag">ä»»åŠ¡åˆ†å‘</span>
                                <span class="component-tag">æµç¨‹åè°ƒ</span>
                            </div>
                            <div class="academic-badge">MetaGPT: Meta Programming for Multi-Agent Collaboration</div>
                        </div>
                        
                        <!-- ç¬¬3è¡Œ: å¤§è„‘å±‚ (å¹¶æ’) -->
                        <div class="flow-step-card brain-layer router-planner clickable" data-module="planner" onclick="showModuleDetails('planner')">
                            <div class="step-title">ğŸ§  é¦–å¸­ç§‘å­¦å®¶ (Lead Scientist)</div>
                            <div class="step-desc">æ‹†è§£ç§‘å­¦é—®é¢˜ï¼Œç”Ÿæˆå®éªŒæ­¥éª¤ï¼Œè§„åˆ’åˆ†ææµç¨‹</div>
                            <div class="step-components">
                                <span class="component-tag">Workflow Planner</span>
                                <span class="component-tag">ç§‘å­¦æ¨ç†</span>
                                <span class="component-tag">æ­¥éª¤ç”Ÿæˆ</span>
                            </div>
                            <div class="academic-badge">SciAgents: Automating Scientific Discovery</div>
                        </div>
                        
                        <div class="flow-step-card brain-layer tool-retriever clickable" data-module="retriever" onclick="showModuleDetails('retriever')">
                            <div class="step-title">ğŸ“š å›¾ä¹¦é¦†å‘˜ (Librarian)</div>
                            <div class="step-desc">åœ¨å·¥å…·åº“ä¸­å¯»æ‰¾åˆé€‚çš„å·¥å…·ï¼Œè¯­ä¹‰æ£€ç´¢åŒ¹é…</div>
                            <div class="step-components">
                                <span class="component-tag">Tool Retriever</span>
                                <span class="component-tag">ChromaDB</span>
                                <span class="component-tag">è¯­ä¹‰æ£€ç´¢</span>
                            </div>
                            <div class="academic-badge">Gorilla: LLM Connected with Massive APIs</div>
                        </div>
                        
                        <!-- ç¬¬4è¡Œ: é¢†åŸŸä¸“å®¶ (å…¨å®½) -->
                        <div class="flow-step-card agent-layer clickable" data-module="agent" onclick="showModuleDetails('agent')">
                            <div class="step-title">ğŸ§¬ é¢†åŸŸä¸“å®¶ (Domain Agents)</div>
                            <div class="step-desc">æ‹¥æœ‰ RNA/ä»£è°¢ç»„å­¦çš„ä¸“ä¸šçŸ¥è¯†ï¼Œæ‰§è¡Œé¢†åŸŸç‰¹å®šåˆ†æ</div>
                            <div class="step-components">
                                <span class="component-tag">RNA Agent</span>
                                <span class="component-tag">Metabolomics Agent</span>
                                <span class="component-tag">é¢†åŸŸçŸ¥è¯†</span>
                            </div>
                            <div class="academic-badge">ChemCrow: Augmenting LLMs with Domain Tools</div>
                        </div>
                        
                        <!-- ç¬¬5è¡Œ: æ‰§è¡Œå¼•æ“ (å…¨å®½) -->
                        <div class="flow-step-card executor-layer clickable" data-module="executor" onclick="showModuleDetails('executor')">
                            <div class="step-title">ğŸ¦¾ æ‰§è¡Œå¼•æ“ (Executor)</div>
                            <div class="step-desc">ç¼–å†™ä»£ç ï¼Œæ“ä½œè½¯ä»¶ï¼Œç”Ÿæˆå›¾è¡¨ï¼Œæ‰§è¡Œå…·ä½“åˆ†ææ­¥éª¤</div>
                            <div class="step-components">
                                <span class="component-tag">WorkflowExecutor</span>
                                <span class="component-tag">å‚æ•°éªŒè¯</span>
                                <span class="component-tag">å·¥å…·è°ƒç”¨</span>
                                <span class="component-tag">ç»“æœç”Ÿæˆ</span>
                            </div>
                            <div class="academic-badge">SheetCopilot: Programmatic Data Manipulation</div>
                        </div>
                        
                        <!-- ç¬¬6è¡Œ: æœ€ç»ˆè¾“å‡º (å…¨å®½) -->
                        <div class="flow-step-card output-layer clickable" data-module="output" onclick="showModuleDetails('output')">
                            <div class="step-title">ğŸ“Š åˆ†æç»“æœ (Analysis Results)</div>
                            <div class="step-desc">é€šè¿‡ Server-Sent Events å®æ—¶æ¨é€åˆ†æè¿›åº¦å’Œç»“æœï¼Œå‰ç«¯å®æ—¶æ¸²æŸ“</div>
                            <div class="step-components">
                                <span class="component-tag">SSE æµå¼è¾“å‡º</span>
                                <span class="component-tag">å·¥ä½œæµå¡ç‰‡</span>
                                <span class="component-tag">æ­¥éª¤ç»“æœ</span>
                                <span class="component-tag">AI è¯Šæ–­æŠ¥å‘Š</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SVG è¦†ç›–å±‚ç”¨äºåŠ¨æ€è¿æ¥çº¿ -->
                    <svg class="svg-overlay" id="flow-svg">
                        <!-- åŠ¨æ€è·¯å¾„å°†é€šè¿‡ JavaScript æ·»åŠ  -->
                    </svg>
                </div>
            </div>
            
            <!-- ä¾§è¾¹æ ï¼šç³»ç»Ÿè§£å‰–ä¸é€»è¾‘è¿½è¸ªé¢æ¿ -->
            <div class="detail-panel">
                <h2>ğŸ”¬ System Anatomy & Logic Trace<br><span style="font-size: 14px; color: #666;">ç³»ç»Ÿè§£å‰–ä¸é€»è¾‘è¿½è¸ª</span></h2>
                <div class="default-state" id="default-state">
                    Select a module to view internal logic and design rationale.
                </div>
                <div class="detail-content" id="detail-content">
                    <!-- å†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€å¡«å…… -->
                </div>
            </div>
        </div>
        
        <!-- å¯ä¸‹è½½æ¶æ„å›¾éƒ¨åˆ† -->
        <!-- TODO: Take a screenshot of this HTML diagram and save as assets/architecture_v2.png -->
        <div class="download-section">
            <h2>ğŸ“¥ Download Architecture</h2>
            <p style="color: #666; margin-bottom: 20px;">ä¸‹è½½é«˜åˆ†è¾¨ç‡æ¶æ„å›¾ç”¨äºæ¼”ç¤ºå’Œæ–‡æ¡£</p>
            <p style="color: #ff9800; font-size: 13px; margin-bottom: 15px; padding: 10px; background: #fff3cd; border-radius: 6px;">
                <strong>ğŸ“¸ æç¤ºï¼š</strong>è¯·å¯¹ä¸Šé¢çš„ HTML æ¶æ„å›¾è¿›è¡Œæˆªå›¾ï¼Œä¿å­˜ä¸º <code>assets/architecture_v2.png</code> ä»¥ä¿®å¤ç¼ºå¤±çš„å›¾ç‰‡ã€‚
            </p>
            
            <div id="architecture-image-container">
                <img src="assets/architecture_v2.png" 
                     alt="Architecture Diagram Snapshot - Omics Agent System Design" 
                     class="architecture-image"
                     onerror="this.style.display='none'; document.getElementById('image-placeholder').style.display='block';">
                <div id="image-placeholder" class="image-placeholder" style="display: block;">
                    <p>ğŸ“· æ¶æ„å›¾æ–‡ä»¶æœªæ‰¾åˆ°</p>
                    <p style="font-size: 12px; margin-top: 10px;">è¯·å¯¹ä¸Šé¢çš„ HTML æ¶æ„å›¾è¿›è¡Œæˆªå›¾ï¼Œä¿å­˜ä¸º <code>assets/architecture_v2.png</code></p>
                    <p style="font-size: 11px; margin-top: 8px; color: #999;">æˆ–è€…ä½¿ç”¨æµè§ˆå™¨çš„æ‰“å°åŠŸèƒ½å¯¼å‡ºä¸º PDF/PNG</p>
                </div>
            </div>
            
            <button class="download-btn" onclick="downloadArchitecture()">
                <span>â¬‡ï¸</span>
                <span>Download High-Res PNG</span>
            </button>
        </div>
        
        <script>
            function downloadArchitecture() {
                const img = document.querySelector('.architecture-image');
                if (img && img.src && !img.src.includes('placeholder')) {
                    const link = document.createElement('a');
                    link.href = img.src;
                    link.download = 'omics_agent_architecture_v2.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    alert('æ¶æ„å›¾æ–‡ä»¶æœªæ‰¾åˆ°ã€‚è¯·ç¡®ä¿ assets/architecture_v2.png æ–‡ä»¶å­˜åœ¨ã€‚');
                }
            }
            
            // æ¨¡å—æŠ€æœ¯è§„æ ¼æ•°æ®å¯¹è±¡
            const moduleDetails = {
                user: {
                    component: "ç”¨æˆ· (User)",
                    coreFunction: "ç”¨æˆ·äº¤äº’æ¥å£",
                    dataIO: "Input: è‡ªç„¶è¯­è¨€æŸ¥è¯¢ + æ–‡ä»¶ä¸Šä¼  â†’ Output: HTTP POST è¯·æ±‚",
                    keyLogic: "ç”¨æˆ·åœ¨ Web UI ä¸­è¾“å…¥æŸ¥è¯¢æ–‡æœ¬æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œå‰ç«¯æ”¶é›†ç”¨æˆ·è¾“å…¥å¹¶å‘é€åˆ°åç«¯ APIã€‚",
                    designRationale: "åˆ†ç¦»ç”¨æˆ·ç•Œé¢å±‚ä¸ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå®ç°å‰åç«¯è§£è€¦ã€‚å‰ç«¯è´Ÿè´£äº¤äº’å’Œå±•ç¤ºï¼Œåç«¯è´Ÿè´£è®¡ç®—å’Œå†³ç­–ã€‚",
                    upstreamDownstream: "Upstream: N/A (ç”¨æˆ·å…¥å£) | Downstream: Orchestrator (æ¥æ”¶ç”¨æˆ·è¯·æ±‚)",
                    academicBasis: "N/A - User Interface Layer (æ ‡å‡† Web æ¶æ„æ¨¡å¼)"
                },
                orchestrator: {
                    component: "æ€»æ§ç¼–æ’ (Orchestrator)",
                    coreFunction: "core.orchestrator.AgentOrchestrator.stream_process()",
                    dataIO: "Input: UserQuery + ConversationHistory + UploadedFiles â†’ Output: SSE Events (status, workflow, step_result, diagnosis, result)",
                    keyLogic: "ç®¡ç†å¯¹è¯å†å²ï¼Œè¿›è¡Œæ„å›¾åˆ†ç±»ï¼ˆChat vs Taskï¼‰ï¼Œåè°ƒå¤šæ™ºèƒ½ä½“åä½œã€‚ä½¿ç”¨ LLM è¿›è¡Œå…¨å±€æ„å›¾åˆ¤æ–­ï¼Œæ ¹æ®ç»“æœè·¯ç”±åˆ°è§„åˆ’æµç¨‹æˆ–ç›´æ¥èŠå¤©ã€‚ç»´æŠ¤ä¼šè¯çŠ¶æ€å’Œä¸Šä¸‹æ–‡ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆéœ€è¦ Orchestratorï¼Ÿå®ç°å•ä¸€å…¥å£ç‚¹ï¼Œç»Ÿä¸€ç®¡ç†å¤šæ™ºèƒ½ä½“åä½œã€‚åˆ†ç¦»æ„å›¾åˆ†ç±»ä¸å…·ä½“æ‰§è¡Œï¼Œå…è®¸åœ¨è§„åˆ’å‰è¿›è¡Œ Human-in-the-loop éªŒè¯ã€‚æ”¯æŒæµå¼è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚",
                    upstreamDownstream: "Upstream: User (æ¥æ”¶ç”¨æˆ·è¯·æ±‚) | Downstream: Planner (ä»»åŠ¡æ¨¡å¼) / LLM (èŠå¤©æ¨¡å¼) / Executor (æ‰§è¡Œæ¨¡å¼)",
                    academicBasis: "MetaGPT: Meta Programming for A Multi-Agent Collaborative Framework (SOPs-based coordination) / AutoGen (Multi-agent conversation framework)"
                },
                planner: {
                    component: "é¦–å¸­ç§‘å­¦å®¶ (Lead Scientist / Planner)",
                    coreFunction: "core.planner.SOPPlanner.plan_workflow()",
                    dataIO: "Input: UserQuery + FileMetadata + ToolSchemas â†’ Output: JSON_Workflow: {workflow_name, steps: [{step_id, tool_id, name, params}]}",
                    keyLogic: "ä½¿ç”¨ Chain-of-Thought (CoT) æ¨ç†æ‹†è§£ç§‘å­¦é—®é¢˜ã€‚å°†ç”¨æˆ·éœ€æ±‚åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„æ­¥éª¤åºåˆ—ã€‚æ¯ä¸ªæ­¥éª¤åŒ…å«å·¥å…·IDå’Œå‚æ•°é…ç½®ã€‚æ”¯æŒå‚æ•°æ¨èå’ŒåŠ¨æ€è°ƒæ•´ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆåˆ†ç¦» Planner å’Œ Executorï¼Ÿå…è®¸åœ¨æ˜‚è´µæ‰§è¡Œå‰è¿›è¡Œ Human-in-the-loop éªŒè¯ã€‚æ”¯æŒå·¥ä½œæµçš„é¢„è§ˆã€ä¿®æ”¹å’Œä¼˜åŒ–ã€‚å®ç°è§„åˆ’ä¸æ‰§è¡Œçš„è§£è€¦ï¼Œæé«˜ç³»ç»Ÿçµæ´»æ€§ã€‚",
                    upstreamDownstream: "Upstream: Orchestrator (æ¥æ”¶ä»»åŠ¡æ„å›¾) + Retriever (è·å–å·¥å…· Schema) | Downstream: Executor (å‘é€å·¥ä½œæµé…ç½®) / Frontend (é¢„è§ˆæ¨¡å¼)",
                    academicBasis: "SciAgents: Automating Scientific Discovery with Large Language Models (Scientific reasoning) / Tree of Thoughts (CoT reasoning)"
                },
                retriever: {
                    component: "å›¾ä¹¦é¦†å‘˜ (Librarian / Tool Retriever)",
                    coreFunction: "core.tool_retriever.ToolRetriever.query_tools()",
                    dataIO: "Input: UserQuery (è‡ªç„¶è¯­è¨€æè¿°) â†’ Output: List[ToolSchema] - å·¥å…· JSON Schema åˆ—è¡¨",
                    keyLogic: "ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“è¿›è¡Œè¯­ä¹‰æ£€ç´¢ã€‚å°†ç”¨æˆ·æŸ¥è¯¢è½¬æ¢ä¸º embeddingï¼Œåœ¨å·¥å…·åº“ä¸­æŸ¥æ‰¾ç›¸ä¼¼åº¦æœ€é«˜çš„å·¥å…·ã€‚è¿”å›å·¥å…·çš„å®Œæ•´ Schemaï¼ˆå‚æ•°å®šä¹‰ã€æè¿°ã€ç¤ºä¾‹ï¼‰ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆä½¿ç”¨è¯­ä¹‰æ£€ç´¢è€Œéå…³é”®è¯åŒ¹é…ï¼Ÿæ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œç”¨æˆ·æ— éœ€äº†è§£å…·ä½“å·¥å…·åç§°ã€‚é€šè¿‡ embedding ç›¸ä¼¼åº¦åŒ¹é…ï¼Œæé«˜å·¥å…·æ¨èçš„å‡†ç¡®æ€§ã€‚",
                    upstreamDownstream: "Upstream: Planner (æ¥æ”¶å·¥å…·æŸ¥è¯¢è¯·æ±‚) | Downstream: Planner (è¿”å›å·¥å…· Schema)",
                    academicBasis: "Gorilla: Large Language Model Connected with Massive APIs (API retrieval) / ToolLLM: Facilitating Large Language Models to Master 16000+ Real-world APIs (Tool learning)"
                },
                agent: {
                    component: "é¢†åŸŸä¸“å®¶ (Domain Agents)",
                    coreFunction: "agents.rna.RNAAgent.execute_workflow() / agents.metabolomics.MetabolomicsAgent.execute_workflow()",
                    dataIO: "Input: WorkflowConfig + FilePaths â†’ Output: AnalysisResults: {steps_details, steps_results, summary}",
                    keyLogic: "æ‹¥æœ‰ç‰¹å®šç»„å­¦é¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†ï¼ˆRNA-seq, Metabolomicsï¼‰ã€‚æ ¹æ®å·¥ä½œæµé…ç½®åˆ›å»º WorkflowExecutorï¼Œæ‰§è¡Œåˆ†ææ­¥éª¤ã€‚èšåˆæ­¥éª¤ç»“æœï¼Œç”Ÿæˆé¢†åŸŸç‰¹å®šçš„è¯Šæ–­æŠ¥å‘Šã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆéœ€è¦é¢†åŸŸç‰¹å®šçš„ Agentï¼Ÿä¸åŒç»„å­¦é¢†åŸŸæœ‰ä¸åŒçš„åˆ†ææµç¨‹å’Œä¸“ä¸šçŸ¥è¯†ã€‚é€šè¿‡é¢†åŸŸ Agent å°è£…é¢†åŸŸçŸ¥è¯†ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚æ”¯æŒé¢†åŸŸç‰¹å®šçš„é”™è¯¯å¤„ç†å’Œå‚æ•°æ¨èã€‚",
                    upstreamDownstream: "Upstream: Orchestrator (æ¥æ”¶å·¥ä½œæµé…ç½®) | Downstream: Executor (å§”æ‰˜æ‰§è¡Œ) + Output (è¿”å›åˆ†æç»“æœ)",
                    academicBasis: "ChemCrow: Augmenting large language models with chemistry tools (Domain-specific tool integration) / GeneGPT (Domain knowledge augmentation)"
                },
                executor: {
                    component: "æ‰§è¡Œå¼•æ“ (Executor)",
                    coreFunction: "core.executor.WorkflowExecutor.execute_step()",
                    dataIO: "Input: StepConfig: {step_id, tool_id, params} â†’ Output: StepResult: {status, logs, data, images}",
                    keyLogic: "ä» ToolRegistry åŠ¨æ€æŸ¥æ‰¾å·¥å…·å‡½æ•°ã€‚ä½¿ç”¨ Pydantic éªŒè¯å‚æ•°ã€‚è°ƒç”¨å·¥å…·å‡½æ•°ï¼ˆå¯èƒ½æ¶‰åŠ Subprocess æˆ– Celery å¼‚æ­¥ä»»åŠ¡ï¼‰ã€‚å¤„ç†æ­¥éª¤é—´çš„æ•°æ®æµï¼ˆå‰ä¸€æ­¥è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥è¾“å…¥ï¼‰ã€‚æ”¶é›†æ‰§è¡Œç»“æœå’Œé”™è¯¯ä¿¡æ¯ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆåˆ†ç¦» Executor å’Œ Plannerï¼Ÿå…è®¸åœ¨è§„åˆ’åã€æ‰§è¡Œå‰è¿›è¡ŒéªŒè¯ã€‚æ”¯æŒé”™è¯¯æ¢å¤å’Œé‡è¯•æœºåˆ¶ï¼ˆExecutor â†’ Planner åé¦ˆå¾ªç¯ï¼‰ã€‚å®ç°æ‰§è¡Œé€»è¾‘çš„é€šç”¨åŒ–ï¼Œæ— éœ€ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™ç‰¹å®šä»£ç ã€‚",
                    upstreamDownstream: "Upstream: Agent (æ¥æ”¶å·¥ä½œæµé…ç½®) | Downstream: Tools (è°ƒç”¨å·¥å…·å‡½æ•°) / Planner (é”™è¯¯åé¦ˆå¾ªç¯) / Output (è¿”å›æ‰§è¡Œç»“æœ)",
                    academicBasis: "SheetCopilot: Unleashing the Power of Large Language Models to Transform Spreadsheets (Programmatic data manipulation) / Voyager: An Open-Ended Embodied Agent with Large Language Models (Iterative execution)"
                },
                output: {
                    component: "åˆ†æç»“æœ (Analysis Results)",
                    coreFunction: "SSE Streaming + Frontend Rendering",
                    dataIO: "Input: AnalysisResults + AI Report â†’ Output: Rendered UI: Workflow Cards + Step Results + AI Diagnosis",
                    keyLogic: "é€šè¿‡ Server-Sent Events (SSE) å®æ—¶æ¨é€åˆ†æè¿›åº¦ã€‚å‰ç«¯è§£æ SSE äº‹ä»¶æµï¼Œå®æ—¶æ¸²æŸ“å·¥ä½œæµå¡ç‰‡ã€æ­¥éª¤ç»“æœã€å›¾è¡¨å’Œ AI è¯Šæ–­æŠ¥å‘Šã€‚æ”¯æŒæµå¼æ–‡æœ¬è¾“å‡ºå’Œå¢é‡æ›´æ–°ã€‚",
                    designRationale: "ä¸ºä»€ä¹ˆä½¿ç”¨ SSE è€Œéè½®è¯¢ï¼Ÿå®æ—¶æ¨é€ï¼Œé™ä½å»¶è¿Ÿã€‚å•å‘é€šä¿¡ï¼Œç®€åŒ–å®ç°ã€‚æ”¯æŒæµå¼è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚",
                    upstreamDownstream: "Upstream: Executor (æ¥æ”¶æ‰§è¡Œç»“æœ) + Agent (æ¥æ”¶åˆ†ææŠ¥å‘Š) | Downstream: User (æœ€ç»ˆå±•ç¤º)",
                    academicBasis: "N/A - Frontend Rendering Layer (æ ‡å‡† Web å®æ—¶é€šä¿¡æ¨¡å¼)"
                }
            };
            
            // æ˜¾ç¤ºæ¨¡å—è¯¦æƒ…
            function showModuleDetails(moduleId) {
                const detail = moduleDetails[moduleId];
                if (!detail) return;
                
                const defaultState = document.getElementById('default-state');
                const detailContent = document.getElementById('detail-content');
                
                defaultState.style.display = 'none';
                detailContent.classList.add('active');
                
                detailContent.innerHTML = `
                    <div class="detail-item">
                        <div class="detail-item-label">Component</div>
                        <div class="detail-item-value">${detail.component}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Core Function</div>
                        <div class="detail-item-value"><code>${detail.coreFunction}</code></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Data I/O</div>
                        <div class="detail-item-value">${detail.dataIO}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Key Logic</div>
                        <div class="detail-item-value">${detail.keyLogic}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Design Rationale (Why?)</div>
                        <div class="detail-item-value">${detail.designRationale}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Upstream / Downstream</div>
                        <div class="detail-item-value">${detail.upstreamDownstream}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-item-label">Academic Basis</div>
                        <div class="detail-item-value">${detail.academicBasis}</div>
                    </div>
                `;
                
                // é«˜äº®é€‰ä¸­çš„å¡ç‰‡
                document.querySelectorAll('.flow-step-card').forEach(card => {
                    card.classList.remove('active-flow');
                });
                document.querySelector(`[data-module="${moduleId}"]`).classList.add('active-flow');
            }
            
            // åœºæ™¯æ¨¡å¼æ¸²æŸ“
            let currentScenario = null;
            let animationTimeout = null;
            
            // è¾…åŠ©å‡½æ•°ï¼šç»˜åˆ¶ SVG è¿æ¥çº¿
            function drawConnection(startElem, endElem, color = '#ff6b35', delay = 0) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const svg = document.getElementById('flow-svg');
                        if (!svg) return resolve();
                        
                        const startPos = getCardCenter(startElem);
                        const endPos = getCardCenter(endElem);
                        
                        if (!startPos || !endPos) return resolve();
                        
                        // è®¡ç®—æ§åˆ¶ç‚¹ï¼ˆç”¨äºè´å¡å°”æ›²çº¿ï¼‰
                        const dx = endPos.x - startPos.x;
                        const dy = endPos.y - startPos.y;
                        const midX = (startPos.x + endPos.x) / 2;
                        const midY = (startPos.y + endPos.y) / 2;
                        
                        // åˆ›å»ºè·¯å¾„
                        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        const pathId = `path-${Date.now()}-${Math.random()}`;
                        path.setAttribute('id', pathId);
                        
                        // æ ¹æ®æ–¹å‘é€‰æ‹©è·¯å¾„ç±»å‹
                        if (Math.abs(dy) > Math.abs(dx)) {
                            // å‚ç›´è¿æ¥
                            path.setAttribute('d', `M ${startPos.x} ${startPos.y} L ${endPos.x} ${endPos.y}`);
                        } else {
                            // æ°´å¹³æˆ–æ–œå‘è¿æ¥ï¼Œä½¿ç”¨è´å¡å°”æ›²çº¿
                            const controlY = midY - (Math.abs(dx) * 0.3);
                            path.setAttribute('d', `M ${startPos.x} ${startPos.y} Q ${midX} ${controlY} ${endPos.x} ${endPos.y}`);
                        }
                        
                        path.setAttribute('stroke', color);
                        path.setAttribute('stroke-width', '3');
                        path.setAttribute('fill', 'none');
                        path.setAttribute('marker-end', 'url(#arrowhead)');
                        path.setAttribute('class', 'flow-anim');
                        path.style.opacity = '0';
                        
                        svg.appendChild(path);
                        
                        // åŠ¨ç”»ï¼šè·¯å¾„æ·¡å…¥
                        requestAnimationFrame(() => {
                            path.style.transition = 'opacity 0.5s';
                            path.style.opacity = '1';
                        });
                        
                        resolve();
                    }, delay);
                });
            }
            
            // è·å–å¡ç‰‡ä¸­å¿ƒä½ç½®
            function getCardCenter(card) {
                if (!card) return null;
                const rect = card.getBoundingClientRect();
                const diagramRect = document.querySelector('.flow-diagram');
                if (!diagramRect) return null;
                const diagramRectBounds = diagramRect.getBoundingClientRect();
                return {
                    x: rect.left - diagramRectBounds.left + rect.width / 2,
                    y: rect.top - diagramRectBounds.top + rect.height / 2
                };
            }
            
            // é¡ºåºé«˜äº®æ¨¡å—
            async function highlightModuleSequence(modules, delay = 500) {
                for (let i = 0; i < modules.length; i++) {
                    const module = modules[i];
                    if (module.card) {
                        module.card.classList.add('active-flow');
                        if (module.card.scrollIntoView) {
                            module.card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    }
                    
                    // å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ªï¼Œç»˜åˆ¶è¿æ¥çº¿
                    if (i < modules.length - 1 && modules[i + 1]) {
                        await drawConnection(module.card, modules[i + 1].card, module.color || '#ff6b35', delay);
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            
            function renderScenario(mode, buttonElement) {
                // æ¸…é™¤ä¹‹å‰çš„åŠ¨ç”»
                if (animationTimeout) {
                    clearTimeout(animationTimeout);
                }
                
                // é‡ç½®æ‰€æœ‰çŠ¶æ€
                document.querySelectorAll('.flow-step-card').forEach(card => {
                    card.classList.remove('active-flow', 'dimmed');
                });
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // æ¸…é™¤ SVG è·¯å¾„ï¼ˆä¿ç•™ defsï¼‰
                const svg = document.getElementById('flow-svg');
                const defs = svg.querySelector('defs');
                svg.innerHTML = '';
                if (defs) svg.appendChild(defs);
                
                if (mode === 'reset') {
                    currentScenario = null;
                    return;
                }
                
                // æ¿€æ´»å½“å‰æŒ‰é’®
                if (buttonElement) {
                    buttonElement.classList.add('active');
                }
                currentScenario = mode;
                
                const cards = {
                    user: document.querySelector('[data-module="user"]'),
                    orchestrator: document.querySelector('[data-module="orchestrator"]'),
                    planner: document.querySelector('[data-module="planner"]'),
                    retriever: document.querySelector('[data-module="retriever"]'),
                    agent: document.querySelector('[data-module="agent"]'),
                    executor: document.querySelector('[data-module="executor"]'),
                    output: document.querySelector('[data-module="output"]')
                };
                
                // æš—æ·¡éæ´»åŠ¨æ¨¡å—
                const allCards = Object.values(cards).filter(c => c);
                const activeCards = [];
                
                if (mode === 'planning') {
                    // è§„åˆ’æµç¨‹ï¼šUser -> Orchestrator -> Planner <-> Retriever -> Planner -> Frontend
                    activeCards.push(
                        { card: cards.user, color: '#4CAF50' },
                        { card: cards.orchestrator, color: '#9C27B0' },
                        { card: cards.planner, color: '#FF6B35' },
                        { card: cards.retriever, color: '#FF6B35' },
                        { card: cards.planner, color: '#FF6B35' },
                        { card: cards.output, color: '#4CAF50' }
                    );
                    [cards.agent, cards.executor].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    // é¡ºåºåŠ¨ç”»
                    highlightModuleSequence(activeCards, 600);
                    
                } else if (mode === 'execution') {
                    // æ‰§è¡Œæµç¨‹ï¼šUser -> Orchestrator -> Executor <-> Tools -> Executor -> Output
                    activeCards.push(
                        { card: cards.user, color: '#4CAF50' },
                        { card: cards.orchestrator, color: '#9C27B0' },
                        { card: cards.executor, color: '#F44336' },
                        { card: cards.executor, color: '#F44336' }, // å·¥å…·è°ƒç”¨ï¼ˆè‡ªå¾ªç¯è¡¨ç¤ºï¼‰
                        { card: cards.output, color: '#4CAF50' }
                    );
                    [cards.planner, cards.retriever, cards.agent].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    // é¡ºåºåŠ¨ç”»
                    highlightModuleSequence(activeCards, 600);
                    
                } else if (mode === 'error') {
                    // é”™è¯¯å¾ªç¯ï¼šExecutor -> (Error) -> Planner -> (New Plan) -> Executor
                    [cards.executor, cards.planner].forEach(card => {
                        if (card) card.classList.add('active-flow');
                    });
                    [cards.user, cards.orchestrator, cards.retriever, cards.agent, cards.output].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    // ç»˜åˆ¶é”™è¯¯å¾ªç¯è·¯å¾„ï¼ˆExecutor -> Planner -> Executorï¼‰
                    const execPos = getCardCenter(cards.executor);
                    const planPos = getCardCenter(cards.planner);
                    
                    if (execPos && planPos) {
                        // ä½¿ç”¨è´å¡å°”æ›²çº¿ç»˜åˆ¶å¾ªç¯è·¯å¾„
                        const path1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        const midX = (execPos.x + planPos.x) / 2;
                        const midY = Math.min(execPos.y, planPos.y) - 80;
                        
                        // Executor -> Planner (å‘ä¸Š)
                        path1.setAttribute('d', `M ${execPos.x} ${execPos.y} Q ${midX} ${midY} ${planPos.x} ${planPos.y}`);
                        path1.setAttribute('class', 'active flow-anim');
                        path1.setAttribute('marker-end', 'url(#arrowhead)');
                        path1.style.opacity = '0';
                        svg.appendChild(path1);
                        requestAnimationFrame(() => {
                            path1.style.transition = 'opacity 0.5s';
                            path1.style.opacity = '1';
                        });
                        
                        // Planner -> Executor (å‘ä¸‹ï¼Œå½¢æˆå¾ªç¯)
                        const path2 = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        const midY2 = Math.max(execPos.y, planPos.y) + 80;
                        path2.setAttribute('d', `M ${planPos.x} ${planPos.y} Q ${midX} ${midY2} ${execPos.x} ${execPos.y}`);
                        path2.setAttribute('class', 'active flow-anim');
                        path2.setAttribute('marker-end', 'url(#arrowhead)');
                        path2.style.opacity = '0';
                        svg.appendChild(path2);
                        setTimeout(() => {
                            requestAnimationFrame(() => {
                                path2.style.transition = 'opacity 0.5s';
                                path2.style.opacity = '1';
                            });
                        }, 500);
                    }
                    
                } else if (mode === 'chat') {
                    // ç›´æ¥èŠå¤©ï¼šUser -> Orchestrator -> LLM (è·³è¿‡ Planner)
                    activeCards.push(
                        { card: cards.user, color: '#4CAF50' },
                        { card: cards.orchestrator, color: '#9C27B0' },
                        { card: cards.output, color: '#4CAF50' }
                    );
                    [cards.planner, cards.retriever, cards.agent, cards.executor].forEach(card => {
                        if (card) card.classList.add('dimmed');
                    });
                    
                    // é¡ºåºåŠ¨ç”»
                    highlightModuleSequence(activeCards, 600);
                }
            }
            
            // åˆå§‹åŒ– SVG ç®­å¤´æ ‡è®°å’Œå¤§å°
            function initSVG() {
                const svg = document.getElementById('flow-svg');
                const diagram = document.querySelector('.flow-diagram');
                
                // è®¾ç½® SVG å¤§å°
                if (diagram && svg) {
                    const rect = diagram.getBoundingClientRect();
                    svg.setAttribute('width', rect.width);
                    svg.setAttribute('height', rect.height);
                }
                
                // åˆ›å»ºç®­å¤´æ ‡è®°
                if (!svg.querySelector('defs')) {
                    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                    const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                    marker.setAttribute('id', 'arrowhead');
                    marker.setAttribute('markerWidth', '10');
                    marker.setAttribute('markerHeight', '10');
                    marker.setAttribute('refX', '9');
                    marker.setAttribute('refY', '3');
                    marker.setAttribute('orient', 'auto');
                    const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    polygon.setAttribute('points', '0 0, 10 3, 0 6');
                    polygon.setAttribute('fill', '#ff6b35');
                    marker.appendChild(polygon);
                    defs.appendChild(marker);
                    svg.appendChild(defs);
                }
            }
            
            // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
            document.addEventListener('DOMContentLoaded', initSVG);
            
            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°åˆå§‹åŒ–
            window.addEventListener('resize', initSVG);
        </script>
        
        <!-- è¯¦ç»†æµç¨‹è¯´æ˜ -->
        <div class="section">
            <h2>ğŸ“‹ å…¨æµç¨‹æ•°æ®æµå‘è¯¦è§£</h2>
            
            <!-- æ­¥éª¤ 1: ç”¨æˆ·äº¤äº’ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 1: ç”¨æˆ·äº¤äº’ä¸æ–‡ä»¶ä¸Šä¼ </h3>
                <ol>
                    <li><strong>ç”¨æˆ·æ“ä½œ</strong>ï¼šç”¨æˆ·åœ¨ Web UI ä¸­é€‰æ‹©æ–‡ä»¶æˆ–è¾“å…¥æŸ¥è¯¢æ–‡æœ¬</li>
                    <li><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šå‰ç«¯è°ƒç”¨ <code>POST /api/upload</code>ï¼Œä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨</li>
                    <li><strong>æ–‡ä»¶å¤„ç†</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>æœåŠ¡å™¨è‡ªåŠ¨è¯†åˆ« 10x Genomics æ•°æ®ï¼ˆmatrix.mtx, barcodes.tsv, features.tsvï¼‰</li>
                            <li>æ–‡ä»¶ä¿å­˜åˆ° <code>{user_id}/{session_id}/</code> ç›®å½•</li>
                            <li>ç”Ÿæˆæ–‡ä»¶å…ƒæ•°æ®ï¼ˆæ–‡ä»¶ç±»å‹ã€æ ·æœ¬æ•°ã€ç‰¹å¾æ•°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›è·¯å¾„</strong>ï¼šæœåŠ¡å™¨è¿”å› <code>file_paths</code> æ•°ç»„å’Œ <code>session_id</code></li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šæ–‡ä»¶ä¸Šä¼ å“åº”</h4>
                    <div class="code-block">{
  "status": "success",
  "file_paths": ["guest/20250128_120000/example.csv"],
  "file_info": [{"name": "example.csv", "size": 1024000, "path": "..."}],
  "session_id": "20250128_120000",
  "user_id": "guest"
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 2: èŠå¤©è¯·æ±‚ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 2: èŠå¤©è¯·æ±‚ä¸æ„å›¾åˆ†ç±»</h3>
                <ol>
                    <li><strong>å‘é€è¯·æ±‚</strong>ï¼šå‰ç«¯è°ƒç”¨ <code>POST /api/chat</code>ï¼ŒåŒ…å«ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>message</code>ï¼šç”¨æˆ·æŸ¥è¯¢æ–‡æœ¬</li>
                            <li><code>uploaded_files</code>ï¼šå·²ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆname, pathï¼‰</li>
                            <li><code>stream: true</code>ï¼šå¯ç”¨ SSE æµå¼å“åº”</li>
                            <li><code>user_id</code> å’Œ <code>session_id</code>ï¼šç”¨æˆ·å’Œä¼šè¯æ ‡è¯†</li>
                        </ul>
                    </li>
                    <li><strong>API è·¯ç”±</strong>ï¼šFastAPI æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œåˆ›å»º <code>AgentOrchestrator</code> å®ä¾‹</li>
                    <li><strong>æ„å›¾åˆ†ç±»</strong>ï¼š<code>AgentOrchestrator.stream_process()</code> é¦–å…ˆè¿›è¡Œå…¨å±€æ„å›¾åˆ†ç±»ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><strong>Chat æ¨¡å¼</strong>ï¼šå¦‚æœæŸ¥è¯¢æ˜¯æ™®é€šå¯¹è¯ï¼ˆæ— æ–‡ä»¶ã€æ— åˆ†æå…³é”®è¯ï¼‰ï¼Œç›´æ¥è°ƒç”¨ LLM è¿”å›å›ç­”</li>
                            <li><strong>Task æ¨¡å¼</strong>ï¼šå¦‚æœæŸ¥è¯¢åŒ…å«åˆ†æä»»åŠ¡ï¼Œè¿›å…¥å·¥ä½œæµè§„åˆ’å’Œæ‰§è¡Œæµç¨‹</li>
                        </ul>
                    </li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šèŠå¤©è¯·æ±‚</h4>
                    <div class="code-block">{
  "message": "åˆ†æè¿™ä¸ªæ–‡ä»¶",
  "uploaded_files": [
    {"name": "example.csv", "path": "guest/20250128_120000/example.csv"}
  ],
  "stream": true,
  "user_id": "guest",
  "session_id": "20250128_120000"
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 3: æ–‡ä»¶æ£€æŸ¥ä¸æ•°æ®è¯Šæ–­ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 3: æ–‡ä»¶æ£€æŸ¥ä¸æ•°æ®è¯Šæ–­ï¼ˆTask æ¨¡å¼ï¼‰</h3>
                <ol>
                    <li><strong>æ–‡ä»¶æ£€æŸ¥</strong>ï¼šè°ƒç”¨ <code>FileInspector</code> å·¥å…·æ£€æŸ¥ä¸Šä¼ çš„æ–‡ä»¶
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼ˆCSV, H5AD, MTX ç­‰ï¼‰</li>
                            <li>æå–åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ ·æœ¬æ•°ã€ç‰¹å¾æ•°ã€ç¼ºå¤±å€¼æ¯”ä¾‹ç­‰ï¼‰</li>
                            <li>ç”Ÿæˆæ•°æ®é¢„è§ˆ</li>
                        </ul>
                    </li>
                    <li><strong>æ•°æ®è¯Šæ–­</strong>ï¼šå¯é€‰çš„æ•°æ®è´¨é‡è¯„ä¼°
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è°ƒç”¨ LLM ç”Ÿæˆæ•°æ®è¯Šæ–­æŠ¥å‘Š</li>
                            <li>è¯†åˆ«æ½œåœ¨é—®é¢˜ï¼ˆç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ã€æ•°æ®åˆ†å¸ƒç­‰ï¼‰</li>
                            <li>é€šè¿‡ SSE äº‹ä»¶ <code>diagnosis</code> å‘é€åˆ°å‰ç«¯</li>
                        </ul>
                    </li>
                </ol>
            </div>
            
            <!-- æ­¥éª¤ 4: å·¥ä½œæµè§„åˆ’ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 4: åŠ¨æ€å·¥ä½œæµè§„åˆ’</h3>
                <ol>
                    <li><strong>å·¥å…·æ£€ç´¢</strong>ï¼š<code>WorkflowPlanner</code> è°ƒç”¨ <code>ToolRetriever</code>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“è¿›è¡Œè¯­ä¹‰æ£€ç´¢</li>
                            <li>æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œæ–‡ä»¶ç±»å‹ï¼Œæ£€ç´¢ç›¸å…³çš„åˆ†æå·¥å…·</li>
                            <li>è¿”å›å·¥å…·çš„ JSON Schemaï¼ˆå‚æ•°å®šä¹‰ã€æè¿°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>LLM è§„åˆ’</strong>ï¼šå°†å·¥å…· Schema æ³¨å…¥åˆ° LLM æç¤ºè¯ä¸­
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>LLM æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œå¯ç”¨å·¥å…·ï¼Œç”Ÿæˆå·¥ä½œæµè®¡åˆ’</li>
                            <li>è¾“å‡º JSON æ ¼å¼çš„å·¥ä½œæµé…ç½®ï¼š<code>{workflow_name, steps: [{step_id, tool_id, name, params}]}</code></li>
                            <li>æ¯ä¸ªæ­¥éª¤åŒ…å«å·¥å…·IDå’Œå‚æ•°é…ç½®</li>
                        </ul>
                    </li>
                    <li><strong>å‚æ•°æ¨è</strong>ï¼šå¯é€‰æ­¥éª¤ï¼ŒLLM æ ¹æ®æ•°æ®ç‰¹å¾æ¨èæœ€ä½³å‚æ•°
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>åˆ†ææ•°æ®ç»Ÿè®¡ä¿¡æ¯</li>
                            <li>ç”Ÿæˆå‚æ•°æ¨èï¼ˆå¦‚ç¼ºå¤±å€¼é˜ˆå€¼ã€æ ‡å‡†åŒ–æ–¹æ³•ç­‰ï¼‰</li>
                            <li>å¡«å……åˆ°å·¥ä½œæµæ­¥éª¤çš„ <code>params</code> ä¸­</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›å·¥ä½œæµ</strong>ï¼šé€šè¿‡ SSE äº‹ä»¶ <code>workflow</code> å‘é€å·¥ä½œæµé…ç½®åˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šå·¥ä½œæµé…ç½®</h4>
                    <div class="code-block">{
  "type": "workflow",
  "workflow_config": {
    "workflow_name": "Metabolomics Analysis Pipeline",
    "steps": [
      {
        "step_id": "inspect_data",
        "tool_id": "inspect_data",
        "name": "æ•°æ®æ£€æŸ¥",
        "params": {"file_path": "example.csv"}
      },
      {
        "step_id": "preprocess_data",
        "tool_id": "preprocess_data",
        "name": "æ•°æ®é¢„å¤„ç†",
        "params": {
          "file_path": "example.csv",
          "missing_threshold": "0.5",
          "normalization": "log2"
        }
      }
    ]
  },
  "template_mode": false
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 5: å·¥ä½œæµæ‰§è¡Œ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 5: å·¥ä½œæµæ‰§è¡Œä¸å·¥å…·è°ƒç”¨</h3>
                <ol>
                    <li><strong>ç”¨æˆ·ç¡®è®¤</strong>ï¼šå‰ç«¯æ˜¾ç¤ºå·¥ä½œæµé…ç½®å¡ç‰‡ï¼Œç”¨æˆ·ç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®</li>
                    <li><strong>æ‰§è¡Œè¯·æ±‚</strong>ï¼šå‰ç«¯å‘é€ <code>workflow_data</code> åˆ° <code>/api/chat</code> æˆ– <code>/api/execute</code></li>
                    <li><strong>è·¯ç”±åˆ°é¢†åŸŸæ™ºèƒ½ä½“</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>RouterAgent</code> æ ¹æ® <code>workflow_name</code> æˆ–æ–‡ä»¶ç±»å‹ï¼Œè·¯ç”±åˆ°å¯¹åº”çš„é¢†åŸŸæ™ºèƒ½ä½“ï¼ˆRNA Agent æˆ– Metabolomics Agentï¼‰</li>
                            <li>é¢†åŸŸæ™ºèƒ½ä½“è´Ÿè´£æ‰§è¡Œç‰¹å®šç»„å­¦ç±»å‹çš„åˆ†æ</li>
                        </ul>
                    </li>
                    <li><strong>åˆ›å»ºæ‰§è¡Œå™¨</strong>ï¼šé¢†åŸŸæ™ºèƒ½ä½“åˆ›å»º <code>WorkflowExecutor</code> å®ä¾‹</li>
                    <li><strong>é€æ­¥æ‰§è¡Œ</strong>ï¼š<code>WorkflowExecutor</code> æŒ‰é¡ºåºæ‰§è¡Œæ¯ä¸ªæ­¥éª¤
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ä» <code>ToolRegistry</code> æŸ¥æ‰¾å·¥å…·ï¼ˆé€šè¿‡ <code>tool_id</code>ï¼‰</li>
                            <li>ä½¿ç”¨ Pydantic éªŒè¯æ­¥éª¤å‚æ•°</li>
                            <li>è°ƒç”¨å·¥å…·å‡½æ•°ï¼Œä¼ å…¥å‚æ•°</li>
                            <li>æ”¶é›†å·¥å…·è¿”å›çš„ç»“æœ</li>
                            <li>å¤„ç†æ­¥éª¤é—´çš„æ•°æ®æµï¼ˆå¦‚å°†å‰ä¸€æ­¥çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>å®æ—¶æ›´æ–°</strong>ï¼šæ¯ä¸ªæ­¥éª¤æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡ SSE äº‹ä»¶ <code>step_result</code> å‘é€ç»“æœåˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šæ­¥éª¤æ‰§è¡Œç»“æœ</h4>
                    <div class="code-block">{
  "type": "step_result",
  "report_data": {
    "step_id": "inspect_data",
    "tool_id": "inspect_data",
    "name": "æ•°æ®æ£€æŸ¥",
    "summary": "æ£€æŸ¥å®Œæˆ: 77 ä¸ªæ ·æœ¬, 50 ä¸ªä»£è°¢ç‰©",
    "status": "success",
    "plot": "/results/run_20250128_120000/inspect_plot.png",
    "step_result": {
      "step_name": "æ•°æ®æ£€æŸ¥",
      "status": "success",
      "logs": "æ£€æŸ¥å®Œæˆ: 77 ä¸ªæ ·æœ¬, 50 ä¸ªä»£è°¢ç‰©",
      "data": {
        "summary": {
          "n_samples": 77,
          "n_metabolites": 50,
          "missing_percentage": 2.5
        },
        "preview": [...],
        "images": ["/results/run_20250128_120000/inspect_plot.png"]
      }
    }
  }
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 6: ç»“æœèšåˆ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 6: ç»“æœèšåˆä¸æ ¼å¼åŒ–</h3>
                <ol>
                    <li><strong>ç»“æœæ”¶é›†</strong>ï¼š<code>WorkflowExecutor</code> æ”¶é›†æ‰€æœ‰æ­¥éª¤çš„æ‰§è¡Œç»“æœ</li>
                    <li><strong>æ•°æ®æ ¼å¼åŒ–</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ç»Ÿä¸€ç»“æœæ ¼å¼ï¼ˆ<code>steps_details</code>, <code>steps_results</code>ï¼‰</li>
                            <li>å¤„ç†å›¾ç‰‡è·¯å¾„ï¼ˆè½¬æ¢ä¸ºå¯è®¿é—®çš„ URLï¼Œå¦‚ <code>/results/run_xxx/plot.png</code>ï¼‰</li>
                            <li>æå–å…³é”®æŒ‡æ ‡ï¼ˆæ ·æœ¬æ•°ã€ç‰¹å¾æ•°ã€èšç±»æ•°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š</strong>ï¼šæ„å»ºå®Œæ•´çš„åˆ†ææŠ¥å‘Šæ•°æ®ç»“æ„</li>
                </ol>
            </div>
            
            <!-- æ­¥éª¤ 7: AI ä¸“å®¶åˆ†ææŠ¥å‘Š -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 7: AI ä¸“å®¶åˆ†ææŠ¥å‘Šç”Ÿæˆ</h3>
                <ol>
                    <li><strong>æå–å…³é”®æŒ‡æ ‡</strong>ï¼š<code>BaseAgent._generate_analysis_summary()</code> ä»æ­¥éª¤ç»“æœä¸­æå–å…³é”®æŒ‡æ ‡
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>RNA åˆ†æï¼šç»†èƒæ•°ã€åŸºå› æ•°ã€çº¿ç²’ä½“æ¯”ä¾‹ã€æ ‡è®°åŸºå› ã€èšç±»æ•°ã€ç»†èƒç±»å‹ç­‰</li>
                            <li>ä»£è°¢ç»„å­¦ï¼šæ ·æœ¬æ•°ã€ä»£è°¢ç‰©æ•°ã€å·®å¼‚ä»£è°¢ç‰©ã€VIP å€¼ã€é€šè·¯å¯Œé›†ç­‰</li>
                        </ul>
                    </li>
                    <li><strong>æ„å»ºæç¤ºè¯</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ç²¾ç®€æ­¥éª¤ä¿¡æ¯ï¼ˆåªä¿ç•™æ ¸å¿ƒå­—æ®µï¼Œè¿‡æ»¤å†—ä½™æ•°æ®ï¼‰</li>
                            <li>é™åˆ¶åˆ—è¡¨é•¿åº¦ï¼ˆå¦‚åªä¿ç•™ top 3-5 ä¸ªæ ‡è®°åŸºå› /é€šè·¯ï¼‰</li>
                            <li>æ£€æŸ¥æç¤ºè¯é•¿åº¦ï¼Œé˜²æ­¢è¶…å‡º LLM ä¸Šä¸‹æ–‡çª—å£</li>
                        </ul>
                    </li>
                    <li><strong>LLM ç”ŸæˆæŠ¥å‘Š</strong>ï¼šè°ƒç”¨ LLM ç”Ÿæˆ Markdown æ ¼å¼çš„ä¸“å®¶åˆ†ææŠ¥å‘Š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>åŒ…å«åˆ†æç»“æœæ‘˜è¦</li>
                            <li>å…³é”®å‘ç°å’Œç”Ÿç‰©å­¦è§£é‡Š</li>
                            <li>æ•°æ®è´¨é‡è¯„ä¼°</li>
                            <li>å»ºè®®å’Œä¸‹ä¸€æ­¥åˆ†ææ–¹å‘</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›æŠ¥å‘Š</strong>ï¼šé€šè¿‡ SSE äº‹ä»¶ <code>diagnosis</code> å‘é€ AI ä¸“å®¶åˆ†ææŠ¥å‘Šåˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šAI ä¸“å®¶åˆ†ææŠ¥å‘Š</h4>
                    <div class="code-block">{
  "type": "diagnosis",
  "report_data": {
    "diagnosis": "## AI ä¸“å®¶åˆ†ææŠ¥å‘Š\n\n### åˆ†æç»“æœæ‘˜è¦\n\næœ¬æ¬¡åˆ†æå®Œæˆäº† 5 ä¸ªæ­¥éª¤...\n\n### å…³é”®å‘ç°\n\n- æˆåŠŸæ­¥éª¤: 5/5\n- ç»†èƒæ•°é‡: 2,700\n- åŸºå› æ•°é‡: 3,274\n..."
  }
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 8: SSE æµå¼è¾“å‡º -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 8: SSE æµå¼è¾“å‡ºä¸å‰ç«¯æ¸²æŸ“</h3>
                <ol>
                    <li><strong>SSE äº‹ä»¶æµ</strong>ï¼š<code>AgentOrchestrator</code> é€šè¿‡ <code>yield</code> ç”Ÿæˆ SSE äº‹ä»¶
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>status</code>ï¼šçŠ¶æ€æ›´æ–°ï¼ˆ"æ­£åœ¨æ‰§è¡Œæ­¥éª¤...", "æ­£åœ¨ç”ŸæˆæŠ¥å‘Š..."ï¼‰</li>
                            <li><code>workflow</code>ï¼šå·¥ä½œæµé…ç½®</li>
                            <li><code>step_result</code>ï¼šæ­¥éª¤æ‰§è¡Œç»“æœ</li>
                            <li><code>diagnosis</code>ï¼šAI ä¸“å®¶åˆ†ææŠ¥å‘Š</li>
                            <li><code>result</code>ï¼šæœ€ç»ˆç»“æœ</li>
                            <li><code>done</code>ï¼šå®Œæˆä¿¡å·</li>
                            <li><code>error</code>ï¼šé”™è¯¯ä¿¡æ¯</li>
                        </ul>
                    </li>
                    <li><strong>å‰ç«¯æ¥æ”¶</strong>ï¼šå‰ç«¯ä½¿ç”¨ <code>ReadableStream</code> è¯»å– SSE æµ
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è§£æ SSE æ ¼å¼ï¼ˆ<code>event: {type}\ndata: {json}\n\n</code>ï¼‰</li>
                            <li>æ ¹æ®äº‹ä»¶ç±»å‹è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°</li>
                        </ul>
                    </li>
                    <li><strong>å®æ—¶æ¸²æŸ“</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>status</code> â†’ æ›´æ–°çŠ¶æ€æ </li>
                            <li><code>workflow</code> â†’ æ¸²æŸ“å·¥ä½œæµé…ç½®å¡ç‰‡</li>
                            <li><code>step_result</code> â†’ æ¸²æŸ“æ­¥éª¤æ‰§è¡Œç»“æœï¼ˆå›¾è¡¨ã€è¡¨æ ¼ï¼‰</li>
                            <li><code>diagnosis</code> â†’ æ¸²æŸ“ AI ä¸“å®¶åˆ†ææŠ¥å‘Šï¼ˆMarkdownï¼‰</li>
                            <li><code>result</code> â†’ æ¸²æŸ“æœ€ç»ˆåˆ†ææŠ¥å‘Š</li>
                        </ul>
                    </li>
                </ol>
                <div class="data-format">
                    <h4>SSE äº‹ä»¶æ ¼å¼ç¤ºä¾‹</h4>
                    <div class="code-block">event: status
data: {"content": "æ­£åœ¨æ‰§è¡Œæ­¥éª¤: æ•°æ®æ£€æŸ¥...", "state": "running"}

event: step_result
data: {"report_data": {...}}

event: diagnosis
data: {"report_data": {"diagnosis": "## AI ä¸“å®¶åˆ†ææŠ¥å‘Š\n\n..."}}

event: done
data: {"status": "success"}</div>
                </div>
            </div>
        </div>
        
        <!-- å…³é”®æŠ€æœ¯ç‚¹ -->
        <div class="section">
            <h2>ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹</h2>
            
            <div class="flow-step">
                <h3>1. å·¥å…·è‡ªåŠ¨å‘ç°ä¸æ³¨å†Œ</h3>
                <p>ç³»ç»Ÿé€šè¿‡ Python è£…é¥°å™¨å’Œåå°„æœºåˆ¶ï¼Œè‡ªåŠ¨å‘ç°å’Œæ³¨å†Œå·¥å…·åˆ° <code>ToolRegistry</code>ã€‚æ–°å¢å·¥å…·åªéœ€åˆ›å»ºæ–‡ä»¶å¹¶æ·»åŠ  <code>@registry.register</code> è£…é¥°å™¨ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>2. è¯­ä¹‰å·¥å…·æ£€ç´¢</h3>
                <p>ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“å’Œ Ollama Embeddingsï¼Œå®ç°åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„å·¥å…·æ¨èã€‚ç”¨æˆ·å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¨èç›¸å…³å·¥å…·ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>3. LLM é©±åŠ¨çš„å·¥ä½œæµè§„åˆ’</h3>
                <p>å°†å·¥å…· Schema æ³¨å…¥åˆ° LLM æç¤ºè¯ä¸­ï¼ŒLLM æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œå¯ç”¨å·¥å…·ï¼ŒåŠ¨æ€ç”Ÿæˆå¯æ‰§è¡Œçš„å·¥ä½œæµè®¡åˆ’ã€‚æ— éœ€ç¡¬ç¼–ç æ¨¡æ¿ï¼Œæ”¯æŒçµæ´»çš„åˆ†ææµç¨‹ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>4. é€šç”¨æ‰§è¡Œå¼•æ“</h3>
                <p>åŸºäºç­–ç•¥æ¨¡å¼å’Œä¾èµ–æ³¨å…¥ï¼Œå®ç°å·¥å…·æ— å…³çš„æ‰§è¡Œæ¡†æ¶ã€‚æ”¯æŒåŠ¨æ€å·¥å…·æŸ¥æ‰¾ã€å‚æ•°éªŒè¯ï¼ˆPydanticï¼‰å’Œç»“æœèšåˆï¼Œæ— éœ€ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™ç‰¹å®šçš„æ‰§è¡Œé€»è¾‘ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>5. SSE æµå¼è¾“å‡º</h3>
                <p>ä½¿ç”¨ Server-Sent Events (SSE) å®ç°å®æ—¶æµå¼è¾“å‡ºï¼Œå‰ç«¯å¯ä»¥å®æ—¶æ¥æ”¶å’Œæ¸²æŸ“åˆ†æè¿›åº¦ã€æ­¥éª¤ç»“æœå’Œ AI æŠ¥å‘Šï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>6. å¤šç”¨æˆ·éš”ç¦»</h3>
                <p>æ”¯æŒå¤šç”¨æˆ·å¹¶å‘ä½¿ç”¨ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç›®å½•ï¼ˆ<code>{user_id}/{session_id}/</code>ï¼‰ï¼Œå·¥ä½œæµå’Œä»»åŠ¡å†å²æŒ‰ç”¨æˆ·éš”ç¦»ã€‚</p>
            </div>
        </div>
        
        <!-- æ•°æ®æµæ€»ç»“ -->
        <div class="section">
            <h2>ğŸ“Š æ•°æ®æµæ€»ç»“</h2>
            <div class="flow-step">
                <h3>å®Œæ•´æ•°æ®æµå‘</h3>
                <ol>
                    <li><strong>å‰ç«¯ â†’ API æœåŠ¡å™¨</strong>ï¼šHTTP POST è¯·æ±‚ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€èŠå¤©è¯·æ±‚ï¼‰</li>
                    <li><strong>API æœåŠ¡å™¨ â†’ ç¼–æ’å™¨</strong>ï¼šåˆ›å»º <code>AgentOrchestrator</code>ï¼Œè°ƒç”¨ <code>stream_process()</code></li>
                    <li><strong>ç¼–æ’å™¨ â†’ æ™ºèƒ½ä½“</strong>ï¼šæ„å›¾åˆ†ç±»ã€è·¯ç”±åˆ°é¢†åŸŸæ™ºèƒ½ä½“ã€è°ƒç”¨è§„åˆ’å™¨</li>
                    <li><strong>è§„åˆ’å™¨ â†’ å·¥å…·æ£€ç´¢å™¨/LLM</strong>ï¼šè¯­ä¹‰æ£€ç´¢å·¥å…·ã€LLM ç”Ÿæˆå·¥ä½œæµ</li>
                    <li><strong>é¢†åŸŸæ™ºèƒ½ä½“ â†’ æ‰§è¡Œå™¨</strong>ï¼šåˆ›å»º <code>WorkflowExecutor</code>ï¼Œæ‰§è¡Œå·¥ä½œæµ</li>
                    <li><strong>æ‰§è¡Œå™¨ â†’ å·¥å…·</strong>ï¼šåŠ¨æ€æŸ¥æ‰¾å·¥å…·ã€éªŒè¯å‚æ•°ã€è°ƒç”¨å·¥å…·å‡½æ•°</li>
                    <li><strong>å·¥å…· â†’ æ‰§è¡Œå™¨</strong>ï¼šè¿”å›æ‰§è¡Œç»“æœï¼ˆæ•°æ®ã€å›¾è¡¨è·¯å¾„ã€ç»Ÿè®¡ä¿¡æ¯ï¼‰</li>
                    <li><strong>æ‰§è¡Œå™¨ â†’ é¢†åŸŸæ™ºèƒ½ä½“</strong>ï¼šèšåˆæ­¥éª¤ç»“æœã€ç”Ÿæˆ AI æŠ¥å‘Š</li>
                    <li><strong>é¢†åŸŸæ™ºèƒ½ä½“ â†’ ç¼–æ’å™¨</strong>ï¼šè¿”å›å®Œæ•´åˆ†ææŠ¥å‘Š</li>
                    <li><strong>ç¼–æ’å™¨ â†’ API æœåŠ¡å™¨</strong>ï¼šé€šè¿‡ SSE æµå¼è¾“å‡ºäº‹ä»¶</li>
                    <li><strong>API æœåŠ¡å™¨ â†’ å‰ç«¯</strong>ï¼šSSE äº‹ä»¶æµï¼ˆstatus, workflow, step_result, diagnosis, result, doneï¼‰</li>
                    <li><strong>å‰ç«¯æ¸²æŸ“</strong>ï¼šå®æ—¶è§£æ SSE äº‹ä»¶ï¼Œæ¸²æŸ“å·¥ä½œæµå¡ç‰‡ã€æ­¥éª¤ç»“æœã€AI æŠ¥å‘Š</li>
                </ol>
            </div>
        </div>
    </div>
</body>
</html>

</html>
