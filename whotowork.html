<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omics Agent - How to Work å…¨æµç¨‹æ•°æ®æµå‘å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }
        
        .flow-diagram {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 40px;
            margin: 40px 0;
            overflow-x: auto;
        }
        
        .flow-container {
            min-width: 1200px;
            position: relative;
        }
        
        .flow-layer {
            margin-bottom: 40px;
            position: relative;
        }
        
        .layer-title {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 20px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .component-box {
            display: inline-block;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 10px;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .component-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .component-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .component-desc {
            font-size: 12px;
            color: #666;
        }
        
        .arrow {
            stroke: #667eea;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .arrow-label {
            font-size: 11px;
            fill: #495057;
            background: white;
            padding: 2px 4px;
        }
        
        .data-flow {
            position: absolute;
            pointer-events: none;
        }
        
        .flow-step {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .flow-step h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .flow-step ol {
            margin-left: 20px;
        }
        
        .flow-step li {
            margin: 8px 0;
            color: #333;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .section {
            margin: 40px 0;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .data-format {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .data-format h4 {
            color: #1976D2;
            margin-bottom: 8px;
        }
        
        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .print-btn:hover {
            background: #5568d3;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .print-btn {
                display: none;
            }
            
            .container {
                box-shadow: none;
                padding: 20px;
            }
            
            .flow-diagram {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°/å¯¼å‡º PDF</button>
    
    <div class="container">
        <h1>ğŸš€ Omics Agent - How to Work</h1>
        <p class="subtitle">å…¨æµç¨‹æ•°æ®æµå‘ä¸å·¥å…·äº¤äº’æ¶æ„å›¾</p>
        
        <!-- æµç¨‹å›¾ -->
        <div class="flow-diagram">
            <div class="flow-container">
                <!-- SVG å®šä¹‰ -->
                <svg width="100%" height="100%" style="position: absolute; top: 0; left: 0; pointer-events: none;">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#667eea" />
                        </marker>
                    </defs>
                    
                    <!-- æ•°æ®æµç®­å¤´ -->
                    <!-- Frontend -> API Server -->
                    <line x1="200" y1="100" x2="200" y2="200" class="arrow" />
                    <text x="210" y="150" class="arrow-label">HTTP POST</text>
                    
                    <!-- API Server -> Orchestrator -->
                    <line x1="200" y1="250" x2="200" y2="350" class="arrow" />
                    <text x="210" y="300" class="arrow-label">stream_process()</text>
                    
                    <!-- Orchestrator -> Router Agent -->
                    <line x1="200" y1="400" x2="100" y2="500" class="arrow" />
                    <text x="120" y="450" class="arrow-label">è·¯ç”±å†³ç­–</text>
                    
                    <!-- Orchestrator -> Planner -->
                    <line x1="200" y1="400" x2="300" y2="500" class="arrow" />
                    <text x="280" y="450" class="arrow-label">å·¥ä½œæµè§„åˆ’</text>
                    
                    <!-- Planner -> Tool Retriever -->
                    <line x1="300" y1="550" x2="400" y2="600" class="arrow" />
                    <text x="320" y="580" class="arrow-label">è¯­ä¹‰æ£€ç´¢</text>
                    
                    <!-- Planner -> LLM -->
                    <line x1="300" y1="550" x2="500" y2="600" class="arrow" />
                    <text x="380" y="580" class="arrow-label">LLM è§„åˆ’</text>
                    
                    <!-- Orchestrator -> Domain Agent -->
                    <line x1="200" y1="400" x2="200" y2="700" class="arrow" />
                    <text x="210" y="550" class="arrow-label">æ‰§è¡Œå·¥ä½œæµ</text>
                    
                    <!-- Domain Agent -> Executor -->
                    <line x1="200" y1="750" x2="200" y2="850" class="arrow" />
                    <text x="210" y="800" class="arrow-label">execute_workflow()</text>
                    
                    <!-- Executor -> Tools -->
                    <line x1="200" y1="900" x2="100" y2="1000" class="arrow" />
                    <line x1="200" y1="900" x2="200" y2="1000" class="arrow" />
                    <line x1="200" y1="900" x2="300" y2="1000" class="arrow" />
                    <text x="150" y="950" class="arrow-label">å·¥å…·è°ƒç”¨</text>
                    
                    <!-- Tools -> Results -->
                    <line x1="100" y1="1050" x2="200" y2="1100" class="arrow" />
                    <line x1="200" y1="1050" x2="200" y2="1100" class="arrow" />
                    <line x1="300" y1="1050" x2="200" y2="1100" class="arrow" />
                    <text x="150" y="1080" class="arrow-label">ç»“æœèšåˆ</text>
                    
                    <!-- Results -> AI Report Generator -->
                    <line x1="200" y1="1150" x2="200" y2="1250" class="arrow" />
                    <text x="210" y="1200" class="arrow-label">ç”ŸæˆæŠ¥å‘Š</text>
                    
                    <!-- AI Report -> SSE Stream -->
                    <line x1="200" y1="1300" x2="200" y2="1400" class="arrow" />
                    <text x="210" y="1350" class="arrow-label">SSE æµå¼è¾“å‡º</text>
                    
                    <!-- SSE Stream -> Frontend -->
                    <line x1="200" y1="1450" x2="200" y2="1550" class="arrow" />
                    <text x="210" y="1500" class="arrow-label">å®æ—¶æ¸²æŸ“</text>
                </svg>
                
                <!-- å‰ç«¯å±‚ -->
                <div class="flow-layer" style="margin-top: 0;">
                    <div class="layer-title">ğŸŒ å‰ç«¯å±‚ (Frontend Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">Web UI</div>
                        <div class="component-desc">HTML + Bootstrap<br/>Markdown æ¸²æŸ“<br/>å®æ—¶æ›´æ–°</div>
                    </div>
                </div>
                
                <!-- API æœåŠ¡å±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ”Œ API æœåŠ¡å±‚ (API Service Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">FastAPI Server</div>
                        <div class="component-desc">/api/chat<br/>/api/upload<br/>/api/execute</div>
                    </div>
                </div>
                
                <!-- ç¼–æ’å±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ¯ ç¼–æ’å±‚ (Orchestration Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">AgentOrchestrator</div>
                        <div class="component-desc">æ„å›¾åˆ†ç±»<br/>æµç¨‹ç¼–æ’<br/>SSE æµå¼è¾“å‡º</div>
                    </div>
                </div>
                
                <!-- æ™ºèƒ½ä½“å±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ¤– æ™ºèƒ½ä½“å±‚ (Agent Layer)</div>
                    <div class="component-box" style="margin-left: 50px;">
                        <div class="component-title">Router Agent</div>
                        <div class="component-desc">ç»„å­¦ç±»å‹è¯†åˆ«<br/>æ™ºèƒ½è·¯ç”±</div>
                    </div>
                    <div class="component-box">
                        <div class="component-title">Workflow Planner</div>
                        <div class="component-desc">åŠ¨æ€å·¥ä½œæµè§„åˆ’<br/>LLM é©±åŠ¨</div>
                    </div>
                    <div class="component-box">
                        <div class="component-title">Domain Agents</div>
                        <div class="component-desc">RNA Agent<br/>Metabolomics Agent</div>
                    </div>
                </div>
                
                <!-- å·¥å…·æ£€ç´¢å±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ” å·¥å…·æ£€ç´¢å±‚ (Tool Retrieval Layer)</div>
                    <div class="component-box" style="margin-left: 350px;">
                        <div class="component-title">Tool Retriever</div>
                        <div class="component-desc">ChromaDB<br/>è¯­ä¹‰æ£€ç´¢<br/>Embeddings</div>
                    </div>
                    <div class="component-box">
                        <div class="component-title">LLM Client</div>
                        <div class="component-desc">DeepSeek-V3.2<br/>å·¥ä½œæµè§„åˆ’<br/>å‚æ•°æ¨è</div>
                    </div>
                </div>
                
                <!-- æ‰§è¡Œå±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">âš™ï¸ æ‰§è¡Œå±‚ (Execution Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">WorkflowExecutor</div>
                        <div class="component-desc">é€šç”¨æ‰§è¡Œå¼•æ“<br/>å‚æ•°éªŒè¯<br/>æ•°æ®æµå¤„ç†</div>
                    </div>
                </div>
                
                <!-- å·¥å…·å±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ› ï¸ å·¥å…·å±‚ (Tool Layer)</div>
                    <div class="component-box" style="margin-left: 50px;">
                        <div class="component-title">File Inspector</div>
                        <div class="component-desc">æ–‡ä»¶æ£€æŸ¥<br/>å…ƒæ•°æ®ç”Ÿæˆ</div>
                    </div>
                    <div class="component-box">
                        <div class="component-title">Analysis Tools</div>
                        <div class="component-desc">é¢„å¤„ç†<br/>ç»Ÿè®¡åˆ†æ<br/>å¯è§†åŒ–</div>
                    </div>
                    <div class="component-box">
                        <div class="component-title">Domain Tools</div>
                        <div class="component-desc">Scanpy<br/>Cell Ranger<br/>Metabolomics</div>
                    </div>
                </div>
                
                <!-- ç»“æœèšåˆå±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ“Š ç»“æœèšåˆå±‚ (Result Aggregation Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">Result Collector</div>
                        <div class="component-desc">æ­¥éª¤ç»“æœèšåˆ<br/>æ•°æ®æ ¼å¼åŒ–<br/>å›¾è¡¨è·¯å¾„å¤„ç†</div>
                    </div>
                </div>
                
                <!-- AI æŠ¥å‘Šç”Ÿæˆå±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ“ AI æŠ¥å‘Šç”Ÿæˆå±‚ (AI Report Generation Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">AI Expert Report</div>
                        <div class="component-desc">LLM åˆ†æ<br/>å…³é”®æŒ‡æ ‡æå–<br/>Markdown ç”Ÿæˆ</div>
                    </div>
                </div>
                
                <!-- SSE æµå¼è¾“å‡ºå±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ“¡ SSE æµå¼è¾“å‡ºå±‚ (SSE Streaming Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">SSE Event Stream</div>
                        <div class="component-desc">status<br/>workflow<br/>step_result<br/>diagnosis<br/>result</div>
                    </div>
                </div>
                
                <!-- å‰ç«¯æ¸²æŸ“å±‚ -->
                <div class="flow-layer" style="margin-top: 50px;">
                    <div class="layer-title">ğŸ¨ å‰ç«¯æ¸²æŸ“å±‚ (Frontend Rendering Layer)</div>
                    <div class="component-box" style="margin-left: 150px;">
                        <div class="component-title">Real-time Render</div>
                        <div class="component-desc">å·¥ä½œæµå¡ç‰‡<br/>æ‰§è¡Œæ­¥éª¤<br/>åˆ†ææŠ¥å‘Š<br/>AI è¯Šæ–­</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è¯¦ç»†æµç¨‹è¯´æ˜ -->
        <div class="section">
            <h2>ğŸ“‹ å…¨æµç¨‹æ•°æ®æµå‘è¯¦è§£</h2>
            
            <!-- æ­¥éª¤ 1: ç”¨æˆ·äº¤äº’ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 1: ç”¨æˆ·äº¤äº’ä¸æ–‡ä»¶ä¸Šä¼ </h3>
                <ol>
                    <li><strong>ç”¨æˆ·æ“ä½œ</strong>ï¼šç”¨æˆ·åœ¨ Web UI ä¸­é€‰æ‹©æ–‡ä»¶æˆ–è¾“å…¥æŸ¥è¯¢æ–‡æœ¬</li>
                    <li><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šå‰ç«¯è°ƒç”¨ <code>POST /api/upload</code>ï¼Œä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨</li>
                    <li><strong>æ–‡ä»¶å¤„ç†</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>æœåŠ¡å™¨è‡ªåŠ¨è¯†åˆ« 10x Genomics æ•°æ®ï¼ˆmatrix.mtx, barcodes.tsv, features.tsvï¼‰</li>
                            <li>æ–‡ä»¶ä¿å­˜åˆ° <code>{user_id}/{session_id}/</code> ç›®å½•</li>
                            <li>ç”Ÿæˆæ–‡ä»¶å…ƒæ•°æ®ï¼ˆæ–‡ä»¶ç±»å‹ã€æ ·æœ¬æ•°ã€ç‰¹å¾æ•°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›è·¯å¾„</strong>ï¼šæœåŠ¡å™¨è¿”å› <code>file_paths</code> æ•°ç»„å’Œ <code>session_id</code></li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šæ–‡ä»¶ä¸Šä¼ å“åº”</h4>
                    <div class="code-block">{
  "status": "success",
  "file_paths": ["guest/20250128_120000/example.csv"],
  "file_info": [{"name": "example.csv", "size": 1024000, "path": "..."}],
  "session_id": "20250128_120000",
  "user_id": "guest"
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 2: èŠå¤©è¯·æ±‚ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 2: èŠå¤©è¯·æ±‚ä¸æ„å›¾åˆ†ç±»</h3>
                <ol>
                    <li><strong>å‘é€è¯·æ±‚</strong>ï¼šå‰ç«¯è°ƒç”¨ <code>POST /api/chat</code>ï¼ŒåŒ…å«ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>message</code>ï¼šç”¨æˆ·æŸ¥è¯¢æ–‡æœ¬</li>
                            <li><code>uploaded_files</code>ï¼šå·²ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆname, pathï¼‰</li>
                            <li><code>stream: true</code>ï¼šå¯ç”¨ SSE æµå¼å“åº”</li>
                            <li><code>user_id</code> å’Œ <code>session_id</code>ï¼šç”¨æˆ·å’Œä¼šè¯æ ‡è¯†</li>
                        </ul>
                    </li>
                    <li><strong>API è·¯ç”±</strong>ï¼šFastAPI æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œåˆ›å»º <code>AgentOrchestrator</code> å®ä¾‹</li>
                    <li><strong>æ„å›¾åˆ†ç±»</strong>ï¼š<code>AgentOrchestrator.stream_process()</code> é¦–å…ˆè¿›è¡Œå…¨å±€æ„å›¾åˆ†ç±»ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><strong>Chat æ¨¡å¼</strong>ï¼šå¦‚æœæŸ¥è¯¢æ˜¯æ™®é€šå¯¹è¯ï¼ˆæ— æ–‡ä»¶ã€æ— åˆ†æå…³é”®è¯ï¼‰ï¼Œç›´æ¥è°ƒç”¨ LLM è¿”å›å›ç­”</li>
                            <li><strong>Task æ¨¡å¼</strong>ï¼šå¦‚æœæŸ¥è¯¢åŒ…å«åˆ†æä»»åŠ¡ï¼Œè¿›å…¥å·¥ä½œæµè§„åˆ’å’Œæ‰§è¡Œæµç¨‹</li>
                        </ul>
                    </li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šèŠå¤©è¯·æ±‚</h4>
                    <div class="code-block">{
  "message": "åˆ†æè¿™ä¸ªæ–‡ä»¶",
  "uploaded_files": [
    {"name": "example.csv", "path": "guest/20250128_120000/example.csv"}
  ],
  "stream": true,
  "user_id": "guest",
  "session_id": "20250128_120000"
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 3: æ–‡ä»¶æ£€æŸ¥ä¸æ•°æ®è¯Šæ–­ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 3: æ–‡ä»¶æ£€æŸ¥ä¸æ•°æ®è¯Šæ–­ï¼ˆTask æ¨¡å¼ï¼‰</h3>
                <ol>
                    <li><strong>æ–‡ä»¶æ£€æŸ¥</strong>ï¼šè°ƒç”¨ <code>FileInspector</code> å·¥å…·æ£€æŸ¥ä¸Šä¼ çš„æ–‡ä»¶
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼ˆCSV, H5AD, MTX ç­‰ï¼‰</li>
                            <li>æå–åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ ·æœ¬æ•°ã€ç‰¹å¾æ•°ã€ç¼ºå¤±å€¼æ¯”ä¾‹ç­‰ï¼‰</li>
                            <li>ç”Ÿæˆæ•°æ®é¢„è§ˆ</li>
                        </ul>
                    </li>
                    <li><strong>æ•°æ®è¯Šæ–­</strong>ï¼šå¯é€‰çš„æ•°æ®è´¨é‡è¯„ä¼°
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è°ƒç”¨ LLM ç”Ÿæˆæ•°æ®è¯Šæ–­æŠ¥å‘Š</li>
                            <li>è¯†åˆ«æ½œåœ¨é—®é¢˜ï¼ˆç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ã€æ•°æ®åˆ†å¸ƒç­‰ï¼‰</li>
                            <li>é€šè¿‡ SSE äº‹ä»¶ <code>diagnosis</code> å‘é€åˆ°å‰ç«¯</li>
                        </ul>
                    </li>
                </ol>
            </div>
            
            <!-- æ­¥éª¤ 4: å·¥ä½œæµè§„åˆ’ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 4: åŠ¨æ€å·¥ä½œæµè§„åˆ’</h3>
                <ol>
                    <li><strong>å·¥å…·æ£€ç´¢</strong>ï¼š<code>WorkflowPlanner</code> è°ƒç”¨ <code>ToolRetriever</code>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“è¿›è¡Œè¯­ä¹‰æ£€ç´¢</li>
                            <li>æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œæ–‡ä»¶ç±»å‹ï¼Œæ£€ç´¢ç›¸å…³çš„åˆ†æå·¥å…·</li>
                            <li>è¿”å›å·¥å…·çš„ JSON Schemaï¼ˆå‚æ•°å®šä¹‰ã€æè¿°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>LLM è§„åˆ’</strong>ï¼šå°†å·¥å…· Schema æ³¨å…¥åˆ° LLM æç¤ºè¯ä¸­
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>LLM æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œå¯ç”¨å·¥å…·ï¼Œç”Ÿæˆå·¥ä½œæµè®¡åˆ’</li>
                            <li>è¾“å‡º JSON æ ¼å¼çš„å·¥ä½œæµé…ç½®ï¼š<code>{workflow_name, steps: [{step_id, tool_id, name, params}]}</code></li>
                            <li>æ¯ä¸ªæ­¥éª¤åŒ…å«å·¥å…·IDå’Œå‚æ•°é…ç½®</li>
                        </ul>
                    </li>
                    <li><strong>å‚æ•°æ¨è</strong>ï¼šå¯é€‰æ­¥éª¤ï¼ŒLLM æ ¹æ®æ•°æ®ç‰¹å¾æ¨èæœ€ä½³å‚æ•°
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>åˆ†ææ•°æ®ç»Ÿè®¡ä¿¡æ¯</li>
                            <li>ç”Ÿæˆå‚æ•°æ¨èï¼ˆå¦‚ç¼ºå¤±å€¼é˜ˆå€¼ã€æ ‡å‡†åŒ–æ–¹æ³•ç­‰ï¼‰</li>
                            <li>å¡«å……åˆ°å·¥ä½œæµæ­¥éª¤çš„ <code>params</code> ä¸­</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›å·¥ä½œæµ</strong>ï¼šé€šè¿‡ SSE äº‹ä»¶ <code>workflow</code> å‘é€å·¥ä½œæµé…ç½®åˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šå·¥ä½œæµé…ç½®</h4>
                    <div class="code-block">{
  "type": "workflow",
  "workflow_config": {
    "workflow_name": "Metabolomics Analysis Pipeline",
    "steps": [
      {
        "step_id": "inspect_data",
        "tool_id": "inspect_data",
        "name": "æ•°æ®æ£€æŸ¥",
        "params": {"file_path": "example.csv"}
      },
      {
        "step_id": "preprocess_data",
        "tool_id": "preprocess_data",
        "name": "æ•°æ®é¢„å¤„ç†",
        "params": {
          "file_path": "example.csv",
          "missing_threshold": "0.5",
          "normalization": "log2"
        }
      }
    ]
  },
  "template_mode": false
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 5: å·¥ä½œæµæ‰§è¡Œ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 5: å·¥ä½œæµæ‰§è¡Œä¸å·¥å…·è°ƒç”¨</h3>
                <ol>
                    <li><strong>ç”¨æˆ·ç¡®è®¤</strong>ï¼šå‰ç«¯æ˜¾ç¤ºå·¥ä½œæµé…ç½®å¡ç‰‡ï¼Œç”¨æˆ·ç‚¹å‡»"æ‰§è¡Œ"æŒ‰é’®</li>
                    <li><strong>æ‰§è¡Œè¯·æ±‚</strong>ï¼šå‰ç«¯å‘é€ <code>workflow_data</code> åˆ° <code>/api/chat</code> æˆ– <code>/api/execute</code></li>
                    <li><strong>è·¯ç”±åˆ°é¢†åŸŸæ™ºèƒ½ä½“</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>RouterAgent</code> æ ¹æ® <code>workflow_name</code> æˆ–æ–‡ä»¶ç±»å‹ï¼Œè·¯ç”±åˆ°å¯¹åº”çš„é¢†åŸŸæ™ºèƒ½ä½“ï¼ˆRNA Agent æˆ– Metabolomics Agentï¼‰</li>
                            <li>é¢†åŸŸæ™ºèƒ½ä½“è´Ÿè´£æ‰§è¡Œç‰¹å®šç»„å­¦ç±»å‹çš„åˆ†æ</li>
                        </ul>
                    </li>
                    <li><strong>åˆ›å»ºæ‰§è¡Œå™¨</strong>ï¼šé¢†åŸŸæ™ºèƒ½ä½“åˆ›å»º <code>WorkflowExecutor</code> å®ä¾‹</li>
                    <li><strong>é€æ­¥æ‰§è¡Œ</strong>ï¼š<code>WorkflowExecutor</code> æŒ‰é¡ºåºæ‰§è¡Œæ¯ä¸ªæ­¥éª¤
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ä» <code>ToolRegistry</code> æŸ¥æ‰¾å·¥å…·ï¼ˆé€šè¿‡ <code>tool_id</code>ï¼‰</li>
                            <li>ä½¿ç”¨ Pydantic éªŒè¯æ­¥éª¤å‚æ•°</li>
                            <li>è°ƒç”¨å·¥å…·å‡½æ•°ï¼Œä¼ å…¥å‚æ•°</li>
                            <li>æ”¶é›†å·¥å…·è¿”å›çš„ç»“æœ</li>
                            <li>å¤„ç†æ­¥éª¤é—´çš„æ•°æ®æµï¼ˆå¦‚å°†å‰ä¸€æ­¥çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>å®æ—¶æ›´æ–°</strong>ï¼šæ¯ä¸ªæ­¥éª¤æ‰§è¡Œå®Œæˆåï¼Œé€šè¿‡ SSE äº‹ä»¶ <code>step_result</code> å‘é€ç»“æœåˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šæ­¥éª¤æ‰§è¡Œç»“æœ</h4>
                    <div class="code-block">{
  "type": "step_result",
  "report_data": {
    "step_id": "inspect_data",
    "tool_id": "inspect_data",
    "name": "æ•°æ®æ£€æŸ¥",
    "summary": "æ£€æŸ¥å®Œæˆ: 77 ä¸ªæ ·æœ¬, 50 ä¸ªä»£è°¢ç‰©",
    "status": "success",
    "plot": "/results/run_20250128_120000/inspect_plot.png",
    "step_result": {
      "step_name": "æ•°æ®æ£€æŸ¥",
      "status": "success",
      "logs": "æ£€æŸ¥å®Œæˆ: 77 ä¸ªæ ·æœ¬, 50 ä¸ªä»£è°¢ç‰©",
      "data": {
        "summary": {
          "n_samples": 77,
          "n_metabolites": 50,
          "missing_percentage": 2.5
        },
        "preview": [...],
        "images": ["/results/run_20250128_120000/inspect_plot.png"]
      }
    }
  }
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 6: ç»“æœèšåˆ -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 6: ç»“æœèšåˆä¸æ ¼å¼åŒ–</h3>
                <ol>
                    <li><strong>ç»“æœæ”¶é›†</strong>ï¼š<code>WorkflowExecutor</code> æ”¶é›†æ‰€æœ‰æ­¥éª¤çš„æ‰§è¡Œç»“æœ</li>
                    <li><strong>æ•°æ®æ ¼å¼åŒ–</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ç»Ÿä¸€ç»“æœæ ¼å¼ï¼ˆ<code>steps_details</code>, <code>steps_results</code>ï¼‰</li>
                            <li>å¤„ç†å›¾ç‰‡è·¯å¾„ï¼ˆè½¬æ¢ä¸ºå¯è®¿é—®çš„ URLï¼Œå¦‚ <code>/results/run_xxx/plot.png</code>ï¼‰</li>
                            <li>æå–å…³é”®æŒ‡æ ‡ï¼ˆæ ·æœ¬æ•°ã€ç‰¹å¾æ•°ã€èšç±»æ•°ç­‰ï¼‰</li>
                        </ul>
                    </li>
                    <li><strong>ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š</strong>ï¼šæ„å»ºå®Œæ•´çš„åˆ†ææŠ¥å‘Šæ•°æ®ç»“æ„</li>
                </ol>
            </div>
            
            <!-- æ­¥éª¤ 7: AI ä¸“å®¶åˆ†ææŠ¥å‘Š -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 7: AI ä¸“å®¶åˆ†ææŠ¥å‘Šç”Ÿæˆ</h3>
                <ol>
                    <li><strong>æå–å…³é”®æŒ‡æ ‡</strong>ï¼š<code>BaseAgent._generate_analysis_summary()</code> ä»æ­¥éª¤ç»“æœä¸­æå–å…³é”®æŒ‡æ ‡
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>RNA åˆ†æï¼šç»†èƒæ•°ã€åŸºå› æ•°ã€çº¿ç²’ä½“æ¯”ä¾‹ã€æ ‡è®°åŸºå› ã€èšç±»æ•°ã€ç»†èƒç±»å‹ç­‰</li>
                            <li>ä»£è°¢ç»„å­¦ï¼šæ ·æœ¬æ•°ã€ä»£è°¢ç‰©æ•°ã€å·®å¼‚ä»£è°¢ç‰©ã€VIP å€¼ã€é€šè·¯å¯Œé›†ç­‰</li>
                        </ul>
                    </li>
                    <li><strong>æ„å»ºæç¤ºè¯</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>ç²¾ç®€æ­¥éª¤ä¿¡æ¯ï¼ˆåªä¿ç•™æ ¸å¿ƒå­—æ®µï¼Œè¿‡æ»¤å†—ä½™æ•°æ®ï¼‰</li>
                            <li>é™åˆ¶åˆ—è¡¨é•¿åº¦ï¼ˆå¦‚åªä¿ç•™ top 3-5 ä¸ªæ ‡è®°åŸºå› /é€šè·¯ï¼‰</li>
                            <li>æ£€æŸ¥æç¤ºè¯é•¿åº¦ï¼Œé˜²æ­¢è¶…å‡º LLM ä¸Šä¸‹æ–‡çª—å£</li>
                        </ul>
                    </li>
                    <li><strong>LLM ç”ŸæˆæŠ¥å‘Š</strong>ï¼šè°ƒç”¨ LLM ç”Ÿæˆ Markdown æ ¼å¼çš„ä¸“å®¶åˆ†ææŠ¥å‘Š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>åŒ…å«åˆ†æç»“æœæ‘˜è¦</li>
                            <li>å…³é”®å‘ç°å’Œç”Ÿç‰©å­¦è§£é‡Š</li>
                            <li>æ•°æ®è´¨é‡è¯„ä¼°</li>
                            <li>å»ºè®®å’Œä¸‹ä¸€æ­¥åˆ†ææ–¹å‘</li>
                        </ul>
                    </li>
                    <li><strong>è¿”å›æŠ¥å‘Š</strong>ï¼šé€šè¿‡ SSE äº‹ä»¶ <code>diagnosis</code> å‘é€ AI ä¸“å®¶åˆ†ææŠ¥å‘Šåˆ°å‰ç«¯</li>
                </ol>
                <div class="data-format">
                    <h4>æ•°æ®æ ¼å¼ï¼šAI ä¸“å®¶åˆ†ææŠ¥å‘Š</h4>
                    <div class="code-block">{
  "type": "diagnosis",
  "report_data": {
    "diagnosis": "## AI ä¸“å®¶åˆ†ææŠ¥å‘Š\n\n### åˆ†æç»“æœæ‘˜è¦\n\næœ¬æ¬¡åˆ†æå®Œæˆäº† 5 ä¸ªæ­¥éª¤...\n\n### å…³é”®å‘ç°\n\n- æˆåŠŸæ­¥éª¤: 5/5\n- ç»†èƒæ•°é‡: 2,700\n- åŸºå› æ•°é‡: 3,274\n..."
  }
}</div>
                </div>
            </div>
            
            <!-- æ­¥éª¤ 8: SSE æµå¼è¾“å‡º -->
            <div class="flow-step">
                <h3>æ­¥éª¤ 8: SSE æµå¼è¾“å‡ºä¸å‰ç«¯æ¸²æŸ“</h3>
                <ol>
                    <li><strong>SSE äº‹ä»¶æµ</strong>ï¼š<code>AgentOrchestrator</code> é€šè¿‡ <code>yield</code> ç”Ÿæˆ SSE äº‹ä»¶
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>status</code>ï¼šçŠ¶æ€æ›´æ–°ï¼ˆ"æ­£åœ¨æ‰§è¡Œæ­¥éª¤...", "æ­£åœ¨ç”ŸæˆæŠ¥å‘Š..."ï¼‰</li>
                            <li><code>workflow</code>ï¼šå·¥ä½œæµé…ç½®</li>
                            <li><code>step_result</code>ï¼šæ­¥éª¤æ‰§è¡Œç»“æœ</li>
                            <li><code>diagnosis</code>ï¼šAI ä¸“å®¶åˆ†ææŠ¥å‘Š</li>
                            <li><code>result</code>ï¼šæœ€ç»ˆç»“æœ</li>
                            <li><code>done</code>ï¼šå®Œæˆä¿¡å·</li>
                            <li><code>error</code>ï¼šé”™è¯¯ä¿¡æ¯</li>
                        </ul>
                    </li>
                    <li><strong>å‰ç«¯æ¥æ”¶</strong>ï¼šå‰ç«¯ä½¿ç”¨ <code>ReadableStream</code> è¯»å– SSE æµ
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>è§£æ SSE æ ¼å¼ï¼ˆ<code>event: {type}\ndata: {json}\n\n</code>ï¼‰</li>
                            <li>æ ¹æ®äº‹ä»¶ç±»å‹è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°</li>
                        </ul>
                    </li>
                    <li><strong>å®æ—¶æ¸²æŸ“</strong>ï¼š
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><code>status</code> â†’ æ›´æ–°çŠ¶æ€æ </li>
                            <li><code>workflow</code> â†’ æ¸²æŸ“å·¥ä½œæµé…ç½®å¡ç‰‡</li>
                            <li><code>step_result</code> â†’ æ¸²æŸ“æ­¥éª¤æ‰§è¡Œç»“æœï¼ˆå›¾è¡¨ã€è¡¨æ ¼ï¼‰</li>
                            <li><code>diagnosis</code> â†’ æ¸²æŸ“ AI ä¸“å®¶åˆ†ææŠ¥å‘Šï¼ˆMarkdownï¼‰</li>
                            <li><code>result</code> â†’ æ¸²æŸ“æœ€ç»ˆåˆ†ææŠ¥å‘Š</li>
                        </ul>
                    </li>
                </ol>
                <div class="data-format">
                    <h4>SSE äº‹ä»¶æ ¼å¼ç¤ºä¾‹</h4>
                    <div class="code-block">event: status
data: {"content": "æ­£åœ¨æ‰§è¡Œæ­¥éª¤: æ•°æ®æ£€æŸ¥...", "state": "running"}

event: step_result
data: {"report_data": {...}}

event: diagnosis
data: {"report_data": {"diagnosis": "## AI ä¸“å®¶åˆ†ææŠ¥å‘Š\n\n..."}}

event: done
data: {"status": "success"}</div>
                </div>
            </div>
        </div>
        
        <!-- å…³é”®æŠ€æœ¯ç‚¹ -->
        <div class="section">
            <h2>ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹</h2>
            
            <div class="flow-step">
                <h3>1. å·¥å…·è‡ªåŠ¨å‘ç°ä¸æ³¨å†Œ</h3>
                <p>ç³»ç»Ÿé€šè¿‡ Python è£…é¥°å™¨å’Œåå°„æœºåˆ¶ï¼Œè‡ªåŠ¨å‘ç°å’Œæ³¨å†Œå·¥å…·åˆ° <code>ToolRegistry</code>ã€‚æ–°å¢å·¥å…·åªéœ€åˆ›å»ºæ–‡ä»¶å¹¶æ·»åŠ  <code>@registry.register</code> è£…é¥°å™¨ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>2. è¯­ä¹‰å·¥å…·æ£€ç´¢</h3>
                <p>ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“å’Œ Ollama Embeddingsï¼Œå®ç°åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„å·¥å…·æ¨èã€‚ç”¨æˆ·å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¨èç›¸å…³å·¥å…·ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>3. LLM é©±åŠ¨çš„å·¥ä½œæµè§„åˆ’</h3>
                <p>å°†å·¥å…· Schema æ³¨å…¥åˆ° LLM æç¤ºè¯ä¸­ï¼ŒLLM æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œå¯ç”¨å·¥å…·ï¼ŒåŠ¨æ€ç”Ÿæˆå¯æ‰§è¡Œçš„å·¥ä½œæµè®¡åˆ’ã€‚æ— éœ€ç¡¬ç¼–ç æ¨¡æ¿ï¼Œæ”¯æŒçµæ´»çš„åˆ†ææµç¨‹ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>4. é€šç”¨æ‰§è¡Œå¼•æ“</h3>
                <p>åŸºäºç­–ç•¥æ¨¡å¼å’Œä¾èµ–æ³¨å…¥ï¼Œå®ç°å·¥å…·æ— å…³çš„æ‰§è¡Œæ¡†æ¶ã€‚æ”¯æŒåŠ¨æ€å·¥å…·æŸ¥æ‰¾ã€å‚æ•°éªŒè¯ï¼ˆPydanticï¼‰å’Œç»“æœèšåˆï¼Œæ— éœ€ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™ç‰¹å®šçš„æ‰§è¡Œé€»è¾‘ã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>5. SSE æµå¼è¾“å‡º</h3>
                <p>ä½¿ç”¨ Server-Sent Events (SSE) å®ç°å®æ—¶æµå¼è¾“å‡ºï¼Œå‰ç«¯å¯ä»¥å®æ—¶æ¥æ”¶å’Œæ¸²æŸ“åˆ†æè¿›åº¦ã€æ­¥éª¤ç»“æœå’Œ AI æŠ¥å‘Šï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
            </div>
            
            <div class="flow-step">
                <h3>6. å¤šç”¨æˆ·éš”ç¦»</h3>
                <p>æ”¯æŒå¤šç”¨æˆ·å¹¶å‘ä½¿ç”¨ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç›®å½•ï¼ˆ<code>{user_id}/{session_id}/</code>ï¼‰ï¼Œå·¥ä½œæµå’Œä»»åŠ¡å†å²æŒ‰ç”¨æˆ·éš”ç¦»ã€‚</p>
            </div>
        </div>
        
        <!-- æ•°æ®æµæ€»ç»“ -->
        <div class="section">
            <h2>ğŸ“Š æ•°æ®æµæ€»ç»“</h2>
            <div class="flow-step">
                <h3>å®Œæ•´æ•°æ®æµå‘</h3>
                <ol>
                    <li><strong>å‰ç«¯ â†’ API æœåŠ¡å™¨</strong>ï¼šHTTP POST è¯·æ±‚ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€èŠå¤©è¯·æ±‚ï¼‰</li>
                    <li><strong>API æœåŠ¡å™¨ â†’ ç¼–æ’å™¨</strong>ï¼šåˆ›å»º <code>AgentOrchestrator</code>ï¼Œè°ƒç”¨ <code>stream_process()</code></li>
                    <li><strong>ç¼–æ’å™¨ â†’ æ™ºèƒ½ä½“</strong>ï¼šæ„å›¾åˆ†ç±»ã€è·¯ç”±åˆ°é¢†åŸŸæ™ºèƒ½ä½“ã€è°ƒç”¨è§„åˆ’å™¨</li>
                    <li><strong>è§„åˆ’å™¨ â†’ å·¥å…·æ£€ç´¢å™¨/LLM</strong>ï¼šè¯­ä¹‰æ£€ç´¢å·¥å…·ã€LLM ç”Ÿæˆå·¥ä½œæµ</li>
                    <li><strong>é¢†åŸŸæ™ºèƒ½ä½“ â†’ æ‰§è¡Œå™¨</strong>ï¼šåˆ›å»º <code>WorkflowExecutor</code>ï¼Œæ‰§è¡Œå·¥ä½œæµ</li>
                    <li><strong>æ‰§è¡Œå™¨ â†’ å·¥å…·</strong>ï¼šåŠ¨æ€æŸ¥æ‰¾å·¥å…·ã€éªŒè¯å‚æ•°ã€è°ƒç”¨å·¥å…·å‡½æ•°</li>
                    <li><strong>å·¥å…· â†’ æ‰§è¡Œå™¨</strong>ï¼šè¿”å›æ‰§è¡Œç»“æœï¼ˆæ•°æ®ã€å›¾è¡¨è·¯å¾„ã€ç»Ÿè®¡ä¿¡æ¯ï¼‰</li>
                    <li><strong>æ‰§è¡Œå™¨ â†’ é¢†åŸŸæ™ºèƒ½ä½“</strong>ï¼šèšåˆæ­¥éª¤ç»“æœã€ç”Ÿæˆ AI æŠ¥å‘Š</li>
                    <li><strong>é¢†åŸŸæ™ºèƒ½ä½“ â†’ ç¼–æ’å™¨</strong>ï¼šè¿”å›å®Œæ•´åˆ†ææŠ¥å‘Š</li>
                    <li><strong>ç¼–æ’å™¨ â†’ API æœåŠ¡å™¨</strong>ï¼šé€šè¿‡ SSE æµå¼è¾“å‡ºäº‹ä»¶</li>
                    <li><strong>API æœåŠ¡å™¨ â†’ å‰ç«¯</strong>ï¼šSSE äº‹ä»¶æµï¼ˆstatus, workflow, step_result, diagnosis, result, doneï¼‰</li>
                    <li><strong>å‰ç«¯æ¸²æŸ“</strong>ï¼šå®æ—¶è§£æ SSE äº‹ä»¶ï¼Œæ¸²æŸ“å·¥ä½œæµå¡ç‰‡ã€æ­¥éª¤ç»“æœã€AI æŠ¥å‘Š</li>
                </ol>
            </div>
        </div>
    </div>
</body>
</html>
