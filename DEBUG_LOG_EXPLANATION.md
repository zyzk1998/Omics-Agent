# debug.log æ–‡ä»¶è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

`debug.log` æ˜¯é¡¹ç›®ä¸­çš„è°ƒè¯•æ—¥å¿—æ–‡ä»¶ï¼Œä½äº `.cursor/debug.log`ï¼Œç”¨äºè®°å½•æœåŠ¡å™¨è¿è¡Œæ—¶çš„å…³é”®ä½ç½®å’Œæ•°æ®ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥ã€‚

## ğŸ“ æ—¥å¿—æ ¼å¼

æ¯æ¡è®°å½•éƒ½æ˜¯ JSON æ ¼å¼ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```json
{
  "location": "server.py:1161",
  "message": "Before process_query",
  "data": {
    "query": "æˆ‘è¦åšä»£è°¢ç»„åˆ†æ",
    "uploaded_files_count": 1,
    "test_dataset_id": null
  },
  "timestamp": 1767508267840,
  "sessionId": "debug-session",
  "runId": "run1",
  "hypothesisId": "A"
}
```

## ğŸ” å­—æ®µè¯´æ˜

### 1. `location` (ä½ç½®)
- **ç±»å‹**: å­—ç¬¦ä¸²
- **æ ¼å¼**: `æ–‡ä»¶å:è¡Œå·`
- **è¯´æ˜**: è®°å½•æ—¥å¿—çš„ä»£ç ä½ç½®
- **ç¤ºä¾‹**: `"server.py:1161"` è¡¨ç¤ºåœ¨ `server.py` æ–‡ä»¶çš„ç¬¬ 1161 è¡Œ

### 2. `message` (æ¶ˆæ¯)
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: è°ƒè¯•æ¶ˆæ¯ï¼Œæè¿°å½“å‰æ‰§è¡Œçš„æ“ä½œæˆ–çŠ¶æ€
- **å¸¸è§å€¼**:
  - `"Before process_query"`: å¤„ç†æŸ¥è¯¢ä¹‹å‰
  - `"After process_query"`: å¤„ç†æŸ¥è¯¢ä¹‹å
  - `"chat_endpoint entry"`: è¿›å…¥èŠå¤©ç«¯ç‚¹
  - `"Entering test_data_selection handler"`: è¿›å…¥æµ‹è¯•æ•°æ®é€‰æ‹©å¤„ç†å™¨
  - `"Before StreamingResponse"`: åˆ›å»ºæµå¼å“åº”ä¹‹å‰

### 3. `data` (æ•°æ®)
- **ç±»å‹**: å¯¹è±¡
- **è¯´æ˜**: ç›¸å…³çš„ä¸Šä¸‹æ–‡æ•°æ®ï¼ŒåŒ…æ‹¬å˜é‡å€¼ã€çŠ¶æ€ä¿¡æ¯ç­‰
- **å¸¸è§å­—æ®µ**:
  - `query`: ç”¨æˆ·æŸ¥è¯¢å†…å®¹
  - `uploaded_files_count`: ä¸Šä¼ æ–‡ä»¶æ•°é‡
  - `test_dataset_id`: æµ‹è¯•æ•°æ®é›† ID
  - `result_type`: ç»“æœç±»å‹
  - `result_keys`: ç»“æœå¯¹è±¡çš„é”®åˆ—è¡¨
  - `agent_is_none`: æ™ºèƒ½ä½“æ˜¯å¦ä¸º None
  - `has_message`, `has_options`: æ˜¯å¦æœ‰æ¶ˆæ¯/é€‰é¡¹
  - `message_type`, `options_type`: æ¶ˆæ¯/é€‰é¡¹çš„ç±»å‹

### 4. `timestamp` (æ—¶é—´æˆ³)
- **ç±»å‹**: æ•°å­—ï¼ˆæ•´æ•°ï¼‰
- **å•ä½**: æ¯«ç§’
- **è¯´æ˜**: è®°å½•æ—¥å¿—çš„æ—¶é—´æˆ³ï¼ˆUnix æ—¶é—´æˆ³ï¼Œæ¯«ç§’çº§ï¼‰
- **ç¤ºä¾‹**: `1767508267840` è¡¨ç¤º 2026-01-04 09:23:35.840

### 5. `sessionId` (ä¼šè¯ ID)
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: ä¼šè¯æ ‡è¯†ç¬¦ï¼Œç”¨äºå…³è”åŒä¸€ä¼šè¯çš„å¤šä¸ªæ—¥å¿—è®°å½•
- **ç¤ºä¾‹**: `"debug-session"`

### 6. `runId` (è¿è¡Œ ID)
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: è¿è¡Œæ ‡è¯†ç¬¦ï¼Œç”¨äºå…³è”åŒä¸€æ¬¡è¿è¡Œçš„å¤šä¸ªæ—¥å¿—è®°å½•
- **ç¤ºä¾‹**: `"run1"`

### 7. `hypothesisId` (å‡è®¾ ID)
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: å‡è®¾æ ‡è¯†ç¬¦ï¼Œç”¨äºè°ƒè¯•æµç¨‹ä¸­çš„ä¸åŒå‡è®¾æˆ–åˆ†æ”¯
- **å¸¸è§å€¼**: `"A"`, `"B"`, `"C"`, `"D"`, `"E"`, `"ENTRY"`

## ğŸ“Š å®é™…ç¤ºä¾‹è§£æ

### ç¤ºä¾‹ 1: æŸ¥è¯¢å¤„ç†å‰

```json
{
  "location": "server.py:1161",
  "message": "Before process_query",
  "data": {
    "query": "æˆ‘è¦åšä»£è°¢ç»„åˆ†æ",
    "uploaded_files_count": 1,
    "test_dataset_id": null
  },
  "timestamp": 1767508267840,
  "sessionId": "debug-session",
  "runId": "run1",
  "hypothesisId": "A"
}
```

**è§£è¯»**:
- åœ¨ `server.py:1161` è¡Œï¼Œå¤„ç†æŸ¥è¯¢ä¹‹å‰
- ç”¨æˆ·æŸ¥è¯¢: "æˆ‘è¦åšä»£è°¢ç»„åˆ†æ"
- ä¸Šä¼ äº† 1 ä¸ªæ–‡ä»¶
- æ²¡æœ‰ä½¿ç”¨æµ‹è¯•æ•°æ®é›†
- æ—¶é—´: 2026-01-04 09:23:35.840

### ç¤ºä¾‹ 2: æŸ¥è¯¢å¤„ç†å

```json
{
  "location": "server.py:1168",
  "message": "After process_query",
  "data": {
    "result_type": "dict",
    "result_keys": ["type", "workflow_data", "file_paths", "routing_info"],
    "result_type_value": "workflow_config"
  },
  "timestamp": 1767508294950,
  "sessionId": "debug-session",
  "runId": "run1",
  "hypothesisId": "A"
}
```

**è§£è¯»**:
- åœ¨ `server.py:1168` è¡Œï¼Œå¤„ç†æŸ¥è¯¢ä¹‹å
- è¿”å›ç»“æœæ˜¯å­—å…¸ç±»å‹
- åŒ…å«é”®: `type`, `workflow_data`, `file_paths`, `routing_info`
- ç»“æœç±»å‹å€¼: `"workflow_config"`ï¼ˆå·¥ä½œæµé…ç½®ï¼‰

### ç¤ºä¾‹ 3: æµ‹è¯•æ•°æ®é€‰æ‹©

```json
{
  "location": "server.py:1178",
  "message": "Entering test_data_selection handler",
  "data": {
    "has_message": true,
    "has_options": true,
    "has_datasets_display": true,
    "has_datasets_json": true
  },
  "timestamp": 1767496022712,
  "sessionId": "debug-session",
  "runId": "run1",
  "hypothesisId": "B"
}
```

**è§£è¯»**:
- åœ¨ `server.py:1178` è¡Œï¼Œè¿›å…¥æµ‹è¯•æ•°æ®é€‰æ‹©å¤„ç†å™¨
- æœ‰æ¶ˆæ¯ã€é€‰é¡¹ã€æ•°æ®é›†æ˜¾ç¤ºå’Œ JSON æ•°æ®

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. ä½¿ç”¨ monitor.sh æŸ¥çœ‹

```bash
./monitor.sh
# é€‰æ‹© 12 (æœ¬åœ°æ—¥å¿—æ–‡ä»¶)
# å½“æ˜¾ç¤º debug.log æ—¶ï¼Œé€‰æ‹© y æŸ¥çœ‹æ ¼å¼åŒ–çš„æœ€åä¸€æ¡è®°å½•
```

### 2. ç›´æ¥æŸ¥çœ‹æ–‡ä»¶

```bash
# æŸ¥çœ‹æœ€å 10 è¡Œ
tail -10 .cursor/debug.log

# æ ¼å¼åŒ–æŸ¥çœ‹æœ€åä¸€æ¡è®°å½•
tail -1 .cursor/debug.log | python3 -m json.tool

# æœç´¢ç‰¹å®šæ¶ˆæ¯
grep "Before process_query" .cursor/debug.log | python3 -m json.tool
```

### 3. åˆ†æç‰¹å®šä¼šè¯

```bash
# æŸ¥çœ‹ç‰¹å®šä¼šè¯çš„æ‰€æœ‰è®°å½•
grep "debug-session" .cursor/debug.log | python3 -m json.tool

# æŸ¥çœ‹ç‰¹å®šè¿è¡Œçš„æ‰€æœ‰è®°å½•
grep "run1" .cursor/debug.log | python3 -m json.tool
```

## ğŸ’¡ è°ƒè¯•æŠ€å·§

1. **æŒ‰æ—¶é—´é¡ºåºæŸ¥çœ‹**: ä½¿ç”¨ `timestamp` å­—æ®µæ’åºï¼Œäº†è§£æ‰§è¡Œæµç¨‹
2. **è¿½è¸ªä¼šè¯**: ä½¿ç”¨ `sessionId` å’Œ `runId` å…³è”ç›¸å…³è®°å½•
3. **åˆ†æå‡è®¾**: ä½¿ç”¨ `hypothesisId` äº†è§£ä»£ç æ‰§è¡Œçš„ä¸åŒåˆ†æ”¯
4. **æ£€æŸ¥æ•°æ®**: æŸ¥çœ‹ `data` å­—æ®µäº†è§£å˜é‡å€¼å’ŒçŠ¶æ€
5. **å®šä½é—®é¢˜**: ä½¿ç”¨ `location` å­—æ®µå¿«é€Ÿå®šä½ä»£ç ä½ç½®

## ğŸ“Œ æ³¨æ„äº‹é¡¹

- æ—¥å¿—æ–‡ä»¶å¯èƒ½ä¼šå˜å¾—å¾ˆå¤§ï¼Œå®šæœŸæ¸…ç†æˆ–å½’æ¡£
- æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ API å¯†é’¥ï¼‰ä¸åº”è®°å½•åœ¨æ—¥å¿—ä¸­
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­æˆ–é™åˆ¶è°ƒè¯•æ—¥å¿—
- ä½¿ç”¨ JSON å·¥å…·æ ¼å¼åŒ–æŸ¥çœ‹ï¼Œæ›´æ˜“è¯»

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `gibh_agent.log`: åº”ç”¨ä¸»æ—¥å¿—
- `server.log`: æœåŠ¡å™¨æ—¥å¿—
- `monitor.sh`: ç›‘æ§è„šæœ¬ï¼ˆå¯æŸ¥çœ‹å’Œè§£é‡Šæ—¥å¿—ï¼‰

